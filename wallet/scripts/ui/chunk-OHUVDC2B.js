import{d as Oe}from"./chunk-H7VNXVFH.js";import{a as K,b as xe}from"./chunk-E7VELZFV.js";import{a as Re,b as Ne}from"./chunk-VCB5OJ3D.js";import{b as Le}from"./chunk-RANKOJV5.js";import{a as Ie}from"./chunk-BVXKJJ4A.js";import{b as ye,c as Ae,d as Te,e as Pe,f as Ce,g as be,l as ke,m as Me,n as We,o as Se}from"./chunk-IXKCAKQY.js";import{x as Ee}from"./chunk-QEPBNPHF.js";import{a as ge}from"./chunk-W234FNSM.js";import{a as _e}from"./chunk-GVNVILUC.js";import{l as de,m as ue,n as fe,o as we}from"./chunk-DDO6HXRN.js";import{a as he}from"./chunk-J5ANWCEO.js";import{a as ae,o as ne}from"./chunk-6FOZGMAL.js";import{F as ie,Ra as me,a as L,ia as le}from"./chunk-2MV3WEYP.js";import{hb as se,pa as te,y as oe}from"./chunk-HPXM6RSK.js";import{a as Qe}from"./chunk-NJ5CWPUY.js";import{k as pe,l as Je}from"./chunk-YTJBYVBO.js";import{d as C,f as ee}from"./chunk-MAIAJ7GD.js";import{c as f,d as ce,e as O,g as b}from"./chunk-XCAARJ7Q.js";import{Nb as J,S as G,Wb as qe,Wc as re,Y as Q,Zb as X,jc as Ge,m as Z,za as Ze}from"./chunk-X7YMANPZ.js";import{C as A,G as q,p as S}from"./chunk-SOHTSUTI.js";import{I as je,w as u}from"./chunk-RPZQDAIQ.js";import{Y as P}from"./chunk-V4F2JFTP.js";import{a as j}from"./chunk-6DDC4Y2S.js";import{f as y,m as E,o as I}from"./chunk-EQYVU4XP.js";E();I();var a=y(j());var H=y(oe());je();E();I();var Fe=o=>{let{onboardingTabs:t}=o.metamask;if(!t||Object.keys(t).length!==1)return null;let r=Object.keys(t)[0],n=t[r];return{location:r,tabId:n}};var V=y(Z());ee();qe();Ge();E();I();var x=y(Z());ee();var $={[O.addAccount]({hardware:o,account:t,baseChain:r,walletId:n}){return C().addHardwareWalletAccount(o,t,r,n)},[O.addChain]({account:o,baseChain:t,walletId:r}){return C().addChainForHardwareWallet(o,t,r)},others({hardware:o,account:t,baseChain:r}){return C().importHardwareWalletAccount(o,t,r)}},Xe={async[f.ledger](o){let{otherInfo:t}=o,{ledgerInfo:r}=t;o.hardwareWalletModel=r.productName||b[f.ledger]},[f.trezor](o){o.hardwareWalletModel=b[f.trezor]},[f.keystone](o){let{otherInfo:t}=o,{keystoneInfo:r}=t;o.hardwareWalletModel=r.device||b[f.keystone]},[f.onekey](o){let{otherInfo:t}=o,{onekeyInfo:r}=t,n=r?.deviceType?`${ce[f.onekey]} ${(0,x.capitalize)(r?.deviceType)}`:"";o.hardwareWalletModel=n||b[f.onekey]}},He=({accounts:o,hardware:t,baseChain:r,walletId:n,type:_,...l})=>async()=>{let T;for(let i=0;i<o.length;i++){let p=(0,x.cloneDeep)(o[i]);p.otherInfo=l,await Xe[t](p),p.hardwareWalletType=b[t];let c=$[_];c||(T?.walletId?(_=O.addAccount,n=T.walletId,c=$[_]):c=$.others);let B=await c({hardware:t,account:p,baseChain:r,walletId:n});T??(T=B)}return T};Ze();E();I();var k=y(j()),F=y(oe()),Be=y(Qe());Je();function ve(){let o=(0,F.useDispatch)(),t=(0,Be.useHistory)(),r=(0,F.useSelector)(se),[n,_]=(0,k.useState)(!1);return(0,k.useEffect)(()=>{r&&!n&&(o(pe(!1)),t.push(L))},[r,n,t,o]),(0,k.useCallback)(()=>{_(!0)},[])}var h={SEED:"seed",KEY:"key",HARDWARE:"hardware",CREATE:"create",MPC:"mpc",BULK:"bulk"},Uo=({history:o})=>{let t=Ie(),r=A.useForm(),[n,{set:_}]=ne(!1),[l,T]=(0,a.useState)({}),i=(0,H.useDispatch)(),{seedPhrase:p,privateKey:c,mpcInfo:B,unlockHardwareWallets:R,chooseNetworkList:v,chainList:Ue,isTonMnemonic:De}=(0,H.useSelector)(e=>({seedPhrase:ye(e),privateKey:Ae(e),mpcInfo:Pe(e),unlockHardwareWallets:Te(e),chooseNetworkList:Ce(e),onboardingInitiator:Fe(e),chainList:te(e),isTonMnemonic:be(e)})),Ke=ve(),Y=t.get("from"),ze=Y===h.HARDWARE,N=Y===h.BULK,{setValue:$e}=Oe(),M=async(e,w)=>{try{i(Le(!0)).then(async()=>{if(Ke(),await i(_e()),e===h.CREATE){o.push({pathname:le,search:`?type=${re.INITIALIZE}`});return}let m=`${ie}/${e}`,{keyringName:d="",walletName:s=""}=w||{},g=`${d}-${s}`;if(e===h.HARDWARE&&X()===J){globalThis.platform.openExtensionInPopup(`${m}?anim=1`);return}o.push({pathname:m,state:{walletName:g,anim:"1",next:L}})}).catch(console.log)}catch(m){console.error(m.message)}},U=a.default.useMemo(()=>{let{password:e,confirmPassword:w}=l;return!(e?.length>=Re&&e===w)},[n,c,p,R,l]),Ve=ae(async()=>{if(!(n||U)){_(!0),Ee();try{if(p){let s=await i(ue(l.password,p?.trim().toLowerCase().match(/\w+/gu)?.join(" ")||"",{isTonMnemonic:De}));M(h.SEED,s),i(ke())}if(c){let s=await i(fe(l.password,v,c));M(h.KEY,s,v),i(Me())}if(N){$e(l.password),o.push(me);return}let{cipherText:e,privateKey:w,mpcId:m,userInfo:d}=B;if(e&&w&&m){let s=await i(we(l.password,{cipherText:e,privateKey:w},{mpcId:m,userInfo:d},!0)),g=Ue.filter(D=>D.factionType===G).map(D=>D.baseChain),W=[...Q,...g];M(h.MPC,s,W),i(Se())}if(!(0,V.isEmpty)(R)){await C().setPassword(l.password);let s=await i(He(R)),{hdPathMap:g}=s,W=Object.keys(g);M(h.HARDWARE,s,W),i(We())}if(!p&&!c&&!(e&&w&&m)&&(0,V.isEmpty)(R)){let s=await i(de(l.password));M(h.CREATE,s)}}catch(e){e.message===ge&&q.error(u("wallet_home_toast_network_error"))}finally{_(!1)}}},[U,l,p,c,v]);(0,a.useEffect)(()=>{if(N){let e=document.querySelector("#app");e&&(e.classList.remove("fullscreen"),e.classList.add("popup"))}return()=>{if(N){let e=document.querySelector("#app");e&&(e.classList.remove("popup"),e.classList.add("fullscreen"))}}},[]);let Ye=N?{width:360,position:"absolute",bottom:0,left:0}:{};return a.default.createElement(xe,{title:u("wallet_signup_maintitle_set_password"),desc:u(ze?"wallet_extension_signup_subtitle_set_password_hardware":"wallet_extension_subtitle_password_unlock")},({formClass:e,formErrorClass:w,itemClass:m})=>a.default.createElement(A,{form:r,size:P.SIZE.lg,onSubmit:Ve,validateTrigger:["onChange"],className:e,errorClassName:w,onValuesChange:(d,s)=>{T(s)}},a.default.createElement(A.Item,{name:"password",style:{marginBottom:0},className:m,label:u("wallet_set_password_subtitle_password")},a.default.createElement(S.Password,{autoFocus:!0,autoComplete:"off",inputClassName:K.passwordInput,size:S.SIZE.xl,placeholder:u("wallet_settings_reset_passord_placeholder_input_desc")})),a.default.createElement(A.Item,{noStyle:!0,shouldUpdate:(d,s)=>d.password!==s.password},({getFieldValue:d})=>{let s=d("password");return a.default.createElement(Ne,{password:s})}),a.default.createElement(A.Item,{name:"confirmPassword",style:{flex:1,marginTop:"32px"},dependencies:["password"],className:m,rules:[({getFieldValue:d})=>({validator:(s,g)=>{let W=d("password");return g&&W!==g?Promise.reject(u("wallet_set_password_errortip_password_not_match")):Promise.resolve()}})],label:u("wallet_set_password_subtitle_confirm_password")},a.default.createElement(S.Password,{autoComplete:"off",inputClassName:K.passwordInput,size:S.SIZE.xl,placeholder:u("wallet_settings_reset_passord_placeholder_input_desc")})),a.default.createElement(he.FooterActions,{affixStyle:Ye},a.default.createElement(A.Item,{noStyle:!0},a.default.createElement(P,{block:!0,htmlType:"submit",disabled:U,size:P.SIZE.lg,type:P.TYPE.highlight,loading:n,category:P.CATEGORY.fill},u("wallet_set_password_btn_confirm"))))))};export{He as a,h as b,Uo as c};

window.inOKXExtension = true;
window.ASSETS_BUILD_TYPE = "prepub";

//# sourceMappingURL=chunk-OHUVDC2B.js.map
