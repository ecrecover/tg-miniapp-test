import{f as j,g as N,h as i,l as nt}from"./chunk-YTJBYVBO.js";import{M as R,U as $,X as rt,b as S,c as O,i as w}from"./chunk-QO3243S4.js";import{a as v}from"./chunk-O5JCC6KG.js";import{c as l,d as p,f as et}from"./chunk-MAIAJ7GD.js";import{b as D,c as tt}from"./chunk-AOA7NX2Y.js";import{h as U,k as I,m as C}from"./chunk-HXZH2DHB.js";import{c as M}from"./chunk-MZG4RHXJ.js";import{Qa as B,f as g,h as X,hb as Z}from"./chunk-X7YMANPZ.js";import{a as V}from"./chunk-LDRI4AYU.js";import{b as k,d as Q,f as m,l as process,m as L,o as d}from"./chunk-EQYVU4XP.js";function W(t,e){return e===u.LOCALE_TYPE.default?t:`${e}_${t}`}async function c(t,e,r){c.cache||(c.cache={});let n=W(t,e);if(r&&c.cache[n])return c.cache[n];try{let{data:o}=await U(D.i18nConfigUrl(t,e)),a=e===u.LOCALE_TYPE.default?at(o):o,{local:s}=T.default.storage;return s.set({[n]:a}),c.cache[n]=a,a}catch(o){b.default.error(o)}return null}async function st(t,e){let{local:r}=T.default.storage,n=W(t,e);return new Promise((o,a)=>{r.get(n).then(s=>{o(s[t])}).catch(s=>{a(s)})})}async function ct(t,e=u.LOCALE_TYPE.default){try{let r={};return(process.env.ASSETS_BUILD_TYPE===g.PREPUB||process.env.ASSETS_BUILD_TYPE===g.PUBLISH)&&(r=await st(t,e)),{...await(await fetch(`/${e}/${t}/messages.json`)).json(),...r}}catch(r){return b.default.error(`failed to fetch ${t} locale because of`,r),{}}}async function E(t,e=u.LOCALE_TYPE.default,r=!0){if(process.env.ASSETS_BUILD_TYPE===g.PREPUB||process.env.ASSETS_BUILD_TYPE===g.PUBLISH){let n=await c(t,e,r);if(n)return n}return ct(t,e)}async function At(t){c(t,u.LOCALE_TYPE.default,!1),c(t,u.LOCALE_TYPE.dex,!1),c(t,u.LOCALE_TYPE.okd,!1)}var b,T,u,at,yt,Y=k(()=>{"use strict";L();d();b=m(v()),T=m(V());C();tt();X();u=m(M()),at=(t={})=>{let e={};return Object.entries(t).forEach(([r,n])=>{e[r]={message:n}}),e},yt=(t,e,r,n={})=>{if(!e||!e[r])return null;let a=e[r].message,s=Object.values(n);return Boolean(s&&s.length)&&(a=a.split(/(\$\d)|(\{\w+\})/gu).map(f=>{if(!f)return f;let h=f.match(/\$(\d)|\{(\w+)\}/u);if(!h)return f;let P=/\$(\d)/u.test(f),z=P?Number(h[1])-1:h[2];return(P?s:n)[z]}).join("")),a}});var dt={};Q(dt,{forceUpdateMetamaskState:()=>J,forceUpdateMetamaskStateLightly:()=>gt,getChainInfo:()=>ut,getCurrentWindowTab:()=>Lt,lockMetamask:()=>mt,setCurrentLocale:()=>F,setCurrentWindowTab:()=>q,setLastActiveTime:()=>lt,updateCurrentLocale:()=>A,updateMetamaskState:()=>_,updateMetamaskStateFromBackground:()=>H,updateMetamaskStatePartly:()=>G,updatePartialMetamaskState:()=>it});function F(t,e,r,n){return{type:R,value:{locale:t,messages:e,okdMessages:r,dexMessages:n}}}async function ut(){l().getChainFromServer()}function A(t){return async e=>{e(j());try{let r=await E(t),n=await E(t,y.LOCALE_TYPE.okd),o=await E(t,y.LOCALE_TYPE.dex);await p().setCurrentLocale(t),e(F(t,r,n,o)),I(t)}catch(r){e(i(r.message));return}finally{e(N())}}}function G(t){return(e,r)=>{let{metamask:n}=r();t={...n,...t};let{currentLocale:o,selectedAddress:a}=n,{currentLocale:s,selectedAddress:x}=t;o&&s&&o!==s&&e(A(s)),a!==x&&e({type:O}),e({type:S,value:t})}}function _(t){return(e,r)=>{let{metamask:n}=r(),{currentLocale:o}=n,{currentLocale:a}=t;o&&a&&o!==a&&e(A(a)),e({type:S,value:t})}}function it(t){return e=>{t.chainList&&B(t.chainList),e({type:S,value:t})}}function mt(){return K.default.debug("background.setLocked"),t=>ft().then(()=>H()).catch(e=>{throw t(i(e.message)),e}).then(e=>{t(_(e)),t({type:w})}).catch(()=>{t({type:w})})}async function J(t){let e;try{e=await p().getState()}catch(r){throw t(i(r.message)),r}return t(_(e)),e}async function gt(t){let e={};try{e=await p().getLightState()}catch(r){throw t(i(r.message)),r}try{J(t)}catch(r){console.log(r)}return t(G(e)),e}function lt(){return t=>{l().setLastActiveTime(e=>{e&&t(i(e.message))})}}function q(t){return{type:$,value:t}}function Lt(){return async t=>{let e=await globalThis.platform.currentTab();t(q(e))}}var K,y,H,ft,pt=k(()=>{"use strict";L();d();K=m(v());et();Y();C();y=m(M());nt();Z();rt();H=()=>new Promise((t,e)=>{l().getState((r,n)=>{if(r){e(r);return}t(n)})});ft=()=>new Promise((t,e)=>{l().setLocked(r=>{if(r){e(r);return}t()})})});export{yt as a,ct as b,At as c,Y as d,ut as e,A as f,H as g,_ as h,it as i,mt as j,J as k,gt as l,lt as m,Lt as n,dt as o,pt as p};

window.inOKXExtension = true;
window.ASSETS_BUILD_TYPE = "prepub";

//# sourceMappingURL=chunk-UMJMJOW4.js.map
