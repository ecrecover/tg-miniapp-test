import{a as Rs}from"./chunk-XWZOV7IH.js";import{a as iu,b as nu}from"./chunk-X5IVS2R5.js";import{a as zc,b as Jc}from"./chunk-F77WLA7B.js";import{a as xc}from"./chunk-XILOPSVM.js";import{a as su}from"./chunk-R37IPONJ.js";import"./chunk-G2V3XEUQ.js";import"./chunk-QR2WOQMM.js";import"./chunk-NYT3QVML.js";import"./chunk-2P6KMQ6R.js";import"./chunk-PVE3B4RU.js";import{a as eu}from"./chunk-GOPGSJ4H.js";import{k as Zc}from"./chunk-LLA56EXY.js";import{a as Qc,b as Kc,c as jc}from"./chunk-UR6DV4PE.js";import"./chunk-ZB7DRNAH.js";import"./chunk-FJ3SSUO7.js";import"./chunk-TH64D43G.js";import"./chunk-LE6IGNMO.js";import"./chunk-EEQBHLM7.js";import{a as $c}from"./chunk-37OBG2P3.js";import"./chunk-636MHS2Q.js";import"./chunk-XJ4IKVPR.js";import"./chunk-XE2F6LDQ.js";import"./chunk-REIQGNZB.js";import"./chunk-Q4CU3DV4.js";import"./chunk-DSYZP5KR.js";import{b as Yc}from"./chunk-EEHWVWD4.js";import"./chunk-36P2OA3A.js";import{h as Oc,l as Nc,p as Pc,r as Dc}from"./chunk-JMAKZZHS.js";import{a as vc,b as Ls,c as bc,d as Lc}from"./chunk-UOZDNCIX.js";import"./chunk-FA3U5YIB.js";import"./chunk-RNB3JHFL.js";import"./chunk-2XG4UAIK.js";import{f as wc}from"./chunk-2K7DYI6B.js";import"./chunk-UFQZJGJ2.js";import"./chunk-NZPUYPHL.js";import{b as Ec,d as kc}from"./chunk-4QAFBCO2.js";import"./chunk-B553FNEQ.js";import"./chunk-6QKWDR6X.js";import"./chunk-H3UB6HJY.js";import"./chunk-S2GMXONU.js";import"./chunk-7XFZKU6W.js";import{a as Mc}from"./chunk-ZJHJYBLR.js";import"./chunk-5DVBM2WJ.js";import"./chunk-2PABOPC7.js";import"./chunk-I3U7CKFC.js";import"./chunk-ZPDRUAGN.js";import{a as N,b,c as ws,d as $t,e as Za,h as tc,i as ec,j as oc,l as rc,p as ir,q as sc}from"./chunk-KHSWJYII.js";import{a as Ya,b as Xa,c as Kt,f as mc,i as ao,j as co,k as ar,l as cr,m as pc,n as ur,q as lr,r as jt}from"./chunk-4UQNTEAS.js";import{a as Xo,b as st,c as it,d as ga,g as xa,h as er,i as Ma,j as yt,k as Qt,l as k,n as ja,o as Me,p as za,q as Ja,u as Be}from"./chunk-UMIAWUMF.js";import{a as ic,b as nr,c as nc,d as ac,e as cc,f as uc,g as lc,h as dc}from"./chunk-F2V4TQ6C.js";import{$ as Pt,A as Ca,B as Jo,Ba as Da,C as Ia,Ca as Fa,D as so,Da as Ba,E as Zo,F as tr,G as Aa,H as _a,Ia as xe,J as ya,Ja as Ua,Ka as or,L as Y,La as Wa,N as Ea,O as ie,P as io,Pa as Es,S as ka,U as wa,V as va,W as ba,X as no,Xa as rr,Y as La,Za as ks,_a as Va,a as mn,aa as Is,ab as qa,b as xt,ba as Ra,bb as Ga,c as $e,ca as De,d as pn,da as As,db as sr,e as at,ea as _s,f as Ct,fb as Ha,g as Mt,ga as h,gb as Qa,h as hn,hb as Ka,i as M,ia as wt,ib as $a,j as ct,ja as Fe,k as F,kb as sd,l as kt,la as Oa,lb as U,m as Bt,ma as vt,n as fn,o as J,p as Sa,pa as Na,ra as G,s as z,ta as ys,v as Ta,w as zo,x as Ht,xa as Pa,y as _}from"./chunk-H33TTZT6.js";import{a as Hc}from"./chunk-SFWG2VJ6.js";import"./chunk-CCZSAALC.js";import{a as Vc}from"./chunk-WCH23YYN.js";import{b as Ic}from"./chunk-NZZFB6IS.js";import{a as Bc,b as Uc,d as Wc,e as qc,g as Gc}from"./chunk-35PGDXR7.js";import"./chunk-PUO23DIP.js";import"./chunk-O2J764NL.js";import{a as Ac,d as yc}from"./chunk-CDLW656Z.js";import"./chunk-L5SUUM6Z.js";import"./chunk-LI6XM372.js";import"./chunk-6X5S5KKW.js";import"./chunk-3K3KMGWB.js";import{b as Rc}from"./chunk-5EZVDCYS.js";import"./chunk-475E6NBR.js";import{a as Cc}from"./chunk-RC5IAFKK.js";import"./chunk-4VLUHY4K.js";import"./chunk-IHPHPUUG.js";import{a as _c}from"./chunk-ZEWK7OGU.js";import"./chunk-QVA4WXOQ.js";import"./chunk-EX22SDGB.js";import{$ as Qo,$a as qt,$b as ia,A as In,Aa as eo,Ab as xn,Ba as It,Bb as jo,C as x,Ca as L,Cb as Mn,D as be,Da as $o,Db as Bn,E as Le,Ea as fs,Eb as Un,F as An,Fa as Ss,Fb as Wn,G as Re,Ga as wn,Gb as Vn,H as re,Ha as _t,Hb as qn,I as as,Ia as et,Ib as Gn,J as Ze,Jb as Hn,K as _n,L as se,Lb as Qn,Mb as Kn,Nb as $n,O as lt,P as Ut,Pb as jn,Q as cs,Qb as Yn,R as Wt,Rb as Xn,S as Oe,Sa as oo,Sb as Yo,T as qo,Ta as B,Tb as zn,U as rt,Ua as C,Ub as Jn,V as Vt,Vb as Zn,Wa as vn,Wb as ta,X as us,Xb as ea,Y as Go,Yb as oa,Z as Ho,Za as ht,Zb as ra,_ as Ne,_a as ft,_b as sa,a as Mo,ab as gs,ac as na,b as Bo,bb as bn,bc as aa,c as je,ca as ls,cb as Ln,cc as ca,d as Ye,da as ds,dc as ua,e as Uo,ea as yn,ec as la,f as Xe,fa as Ko,fc as da,g as ss,ga as to,gb as Rn,h as Wo,hb as y,hc as ma,i as ze,ic as pa,j as Je,jb as Nt,k as is,ka as X,l as Sn,la as At,lc as ha,ma as Pe,mc as fa,n as ut,o as Z,oa as ms,oc as T,p as tt,pc as Cs,qc as Gt,r as gn,ra as ps,rc as ot,s as Tn,sa as hs,sc as j,ta as En,tc as ro,u as $,ua as kn,ub as Ts,v as ns,vb as On,w as Cn,wb as Nn,xb as Pn,yb as Dn,z as Vo,za as Ot,zb as Fn}from"./chunk-4RARGC4D.js";import"./chunk-OQOFXHGC.js";import"./chunk-3QA2SYRR.js";import"./chunk-3SC55VQ2.js";import{e as gc,g as Tc}from"./chunk-VTLNAOHG.js";import"./chunk-Y7YPG2EJ.js";import"./chunk-7R67VE77.js";import{a as bs}from"./chunk-NHGZUGLZ.js";import"./chunk-G5LEAVCY.js";import"./chunk-ACHWU2H6.js";import"./chunk-ZPFBKNRM.js";import{i as Sc}from"./chunk-7DP5LYUM.js";import"./chunk-BVXKJJ4A.js";import"./chunk-TBBE7OKY.js";import"./chunk-7HJDVUH5.js";import{b as di,c as mi,h as xi}from"./chunk-XWSNF46G.js";import{d as Xc}from"./chunk-IQKWUGIV.js";import{c as Fc}from"./chunk-TSR6RQYN.js";import{H as ou,J as ru}from"./chunk-Y6FCLKTO.js";import"./chunk-R53OLZPP.js";import"./chunk-ADKEXOTG.js";import{a as tu}from"./chunk-ZFLSYWWA.js";import"./chunk-7PVSIZ6H.js";import"./chunk-H7DITLB3.js";import"./chunk-5NXPDYL5.js";import"./chunk-2GMLPDYZ.js";import"./chunk-DY54SY5O.js";import{a as id}from"./chunk-3QMWMJVS.js";import"./chunk-REOQ3O2A.js";import"./chunk-VQBK6IHT.js";import"./chunk-CTT7GD4C.js";import"./chunk-LQAOHG2H.js";import"./chunk-WNQ6F6VV.js";import{d as an,e as cn}from"./chunk-LEADLFDQ.js";import"./chunk-DGK7TBBE.js";import"./chunk-6Y7ULJF6.js";import"./chunk-3YH3AGVS.js";import"./chunk-3LB7TUPB.js";import"./chunk-TK6JYPIW.js";import"./chunk-OS6E6KVM.js";import"./chunk-GZRBUDXF.js";import{b as rs}from"./chunk-WY46TT4P.js";import"./chunk-MTMUCMTY.js";import"./chunk-S6N4IJX7.js";import"./chunk-ZD4EJWX6.js";import"./chunk-WGCZSWYA.js";import"./chunk-IINHHLHP.js";import"./chunk-DY2YURLY.js";import"./chunk-KXZSXP3G.js";import"./chunk-6HXVFU7V.js";import"./chunk-D5FMQLJG.js";import"./chunk-3I7UBQEQ.js";import{h as dn}from"./chunk-DXRBY5MU.js";import"./chunk-6FR2UIE7.js";import{a as ln}from"./chunk-5GMHHIH5.js";import{c as vs,d as dr,e as mr,i as hc,m as fc}from"./chunk-7KCWBFQ2.js";import"./chunk-QLUP7GYN.js";import"./chunk-7Y44NCE5.js";import{d as od}from"./chunk-BKPOG6ZD.js";import"./chunk-OZMVWMFO.js";import"./chunk-KTO7CPX7.js";import"./chunk-P3XTPXPO.js";import"./chunk-S6TPD26J.js";import"./chunk-4IY6P5HR.js";import"./chunk-FQWGOLDH.js";import"./chunk-QEPBNPHF.js";import{a as rd}from"./chunk-3JLS3TGD.js";import"./chunk-KDP5Z4RF.js";import"./chunk-W234FNSM.js";import"./chunk-DDO6HXRN.js";import"./chunk-CLWWTOKP.js";import"./chunk-KZ2PCELG.js";import"./chunk-C7ZG4INB.js";import{a as un}from"./chunk-J5ANWCEO.js";import{e as Mi}from"./chunk-VMO2INN3.js";import"./chunk-J4TF3RT7.js";import{a as Xi,h as td,j as zi,t as Ji}from"./chunk-6FOZGMAL.js";import{a as Zi}from"./chunk-2MV3WEYP.js";import{Gb as Yi,Wa as Gi,db as Hi,fb as Qi,jb as Ki,lb as $i,pb as ji,q as Di,qb as Fo,y as Fi}from"./chunk-HPXM6RSK.js";import{W as nn}from"./chunk-NAI3K3VA.js";import"./chunk-56PELQWI.js";import{N as os,X as Vi,ha as qi,p as Ui,v as es,x as Wi}from"./chunk-IUIJ46C3.js";import"./chunk-KZ3ZU675.js";import{a as Ft}from"./chunk-NJ5CWPUY.js";import{a as ed}from"./chunk-UH5YBH76.js";import"./chunk-UMJMJOW4.js";import"./chunk-YTJBYVBO.js";import"./chunk-QO3243S4.js";import"./chunk-O5JCC6KG.js";import{d as pt,f as Zr}from"./chunk-MAIAJ7GD.js";import{a as tn}from"./chunk-4PGNX6E2.js";import"./chunk-DBHB6SUD.js";import"./chunk-6UYK5TIR.js";import"./chunk-I56VJWE4.js";import"./chunk-PS3S6BG3.js";import{b as rn}from"./chunk-RT4Y2U5N.js";import"./chunk-2VHH444P.js";import{a as sn,b as xo}from"./chunk-RIMU4JTV.js";import"./chunk-MGLVPWSV.js";import"./chunk-TXKWPME2.js";import"./chunk-LF5ATXQA.js";import"./chunk-4D3M2I6W.js";import"./chunk-AMVK42SC.js";import"./chunk-D6RIE45O.js";import{a as en,u as on}from"./chunk-XCAARJ7Q.js";import{c as Bi}from"./chunk-JXCCIV3J.js";import{b as Pi,c as Zl}from"./chunk-AOA7NX2Y.js";import{f as bi,m as Xl}from"./chunk-HXZH2DHB.js";import"./chunk-MZG4RHXJ.js";import{b as wi,f as vi,g as Yl}from"./chunk-VTST2UXT.js";import{E as Ii,F as Ai,H as Oo,Hc as oe,Ib as Oi,Jc as Do,Kb as Ni,N as ve,Nb as zr,Ta as Qe,Wb as zl,Zb as Jr,ba as _i,d as li,da as No,e as $l,ea as yi,hb as ki,ib as Ke,jb as Li,jc as Jl,kb as Po,la as Ei,lc as ts,m as jr,na as Xr,o as Yr,q as Ti,u as we,v as Et,yb as Ri,z as Ci,za as ee}from"./chunk-X7YMANPZ.js";import"./chunk-IRITFTWC.js";import{F as ke,G as P,j as gi}from"./chunk-SOHTSUTI.js";import{A as hi,D as O,I as D,a as pi,v,w as Rt,z as $r}from"./chunk-RPZQDAIQ.js";import"./chunk-LDRI4AYU.js";import"./chunk-WZLED2TE.js";import"./chunk-E24EBHFY.js";import{O as Si,Y as Ro,e as fi}from"./chunk-V4F2JFTP.js";import{a as V}from"./chunk-6DDC4Y2S.js";import"./chunk-TEY24VZN.js";import"./chunk-RKHQOOTU.js";import"./chunk-KJOC4LFM.js";import"./chunk-6FDO4Y56.js";import"./chunk-NNZ5SU5W.js";import"./chunk-F4JTGWJH.js";import"./chunk-ZALGQC7G.js";import"./chunk-4OUGL4WS.js";import"./chunk-YUXYCITH.js";import"./chunk-RMV3AS5X.js";import"./chunk-2WNGMZUB.js";import"./chunk-IYL2DA3V.js";import"./chunk-MYDAWE3K.js";import"./chunk-3NG42BBY.js";import"./chunk-QYTYSNLW.js";import"./chunk-QMAXXJCA.js";import"./chunk-HFBVRVPB.js";import"./chunk-SF2LTPAC.js";import{a as jl}from"./chunk-TEKDZ77C.js";import"./chunk-NC54RUAI.js";import"./chunk-YR74Q3QD.js";import{f as E,h as r,l as process,m as u,o as l}from"./chunk-EQYVU4XP.js";u();l();var Hr=E(V()),Lt=E(Fi()),Qr=E(Ft());var Kr=E(jr());D();u();l();var Gr=E(V()),_l=E(Ft());u();l();var cu=E(V());u();l();var pr=E(V());var au=({children:a,rootStore:t})=>{let e=fn(t),o=(0,pr.useMemo)(()=>(t.commonStore.rootStore=t,t.accountStore.rootStore=t,t),[t]);return pr.default.createElement(e.Provider,{value:o},a)};var uu=kt(({swapRootStore:a,bridgeRootStore:t,children:e,initTab:o})=>{let{commonStore:{currentTab:s}}=a.getInstance(),i=o||s,n=a.getInstance();return i===y.BRIDGE&&(n=t.getInstance()),cu.default.createElement(au,{rootStore:n},e)});u();l();var lu=E(V());D();function Os({children:a,...t}){return lu.default.createElement(hi,{fetchConfig:Sa.fetchConfig,...t},a)}u();l();u();l();u();l();u();l();var Ir=E(V());u();l();var fr=E(V());u();l();var hr=E(rd());async function nd(a,t){let{devid:e}=await a.get("devid");return(o,s)=>{hr.setDeviceId(e);let i=hr.newInstance({site:"okex",product:o});return i.setApiEndpoint(`${t}/amplitude`),i.setCommonParams(Ma()),s(i),i}}async function Ns(a,t){(await nd(a,t))("web3_trade",Ba)}var ad=()=>{let[a,t]=(0,fr.useState)(!1);return(0,fr.useEffect)(()=>{let{getApiHostname:e}=L.global;Ns(L.localStore,e()).then(()=>t(!0)).catch(()=>{})},[]),{initialized:a}},du=ad;u();l();u();l();var uo=E(V());var mu=a=>{let{params:t,replace:e}=Me(),{autoSwitch:o}=t,[s,i]=(0,uo.useState)(""),[n,c]=(0,uo.useState)(!0);return(0,uo.useEffect)(()=>{a&&(async()=>{if(a===y.SWAP&&o===Xa.BRIDGE){let m=await Kt.judgeTabTypeByParams(t?.from,t?.to);m===y.BRIDGE&&e({pathname:it,params:{...t,autoSwitch:void 0}}),i(m),c(!1)}else i(a),c(!1)})().catch(()=>{})},[a]),{tabType:s,autoSwitching:n}};u();l();var Sr=E(V()),pu=E(Ft());var hu=()=>{let{pathname:a}=(0,pu.useLocation)(),[t,e]=(0,Sr.useState)("");return(0,Sr.useEffect)(()=>{switch(a){case Xo:case st:e(y.SWAP);break;case it:e(y.BRIDGE);break;default:break}},[a]),t};u();l();var Ps=E(V());var fu=(a,t)=>{let{accountStore:e}=J(),{params:o}=Me(),{btcAddressType:s}=o;(0,Ps.useEffect)(()=>{e.setBtcAddressType(s)},[]);let i=za();(0,Ps.useEffect)(()=>{async function n(){let c=new Kt(a,o),{from:d,to:m,tab:p,inputAmount:f,error:g}=await c.initTokenPair(t);g||i(d,m,f,p)}a&&n().catch(()=>{})},[a])};u();l();var Su=E(V()),gu=E(Ft());var Tu=a=>{let{fromToStore:t}=J(),{from:e,to:o}=t,{params:s,replace:i}=Me(),{pathname:n}=(0,gu.useLocation)(),c=Ja();(0,Su.useEffect)(()=>{let d=c(e,o);d&&a&&[st,it].includes(n)&&(new Kt(a).writeTabInfoToLocalStorage(d),i({params:{...d,feeConfig:s.feeConfig}}))},[e?.chainId,e?.tokenContractAddress,o?.chainId,o?.tokenContractAddress,a,n])};var cd=a=>{let t=hu(),{tabType:e}=mu(t);fu(e,a),Tu(e)},Cu=cd;u();l();var _u=E(V());u();l();function ud(a){return new Promise(t=>setTimeout(t,a))}async function Iu(a,t=3,e=0){let o;for(let s=0;s<t;s++)try{return await a()}catch(i){o=i,e&&s<t-1&&await ud(e)}throw o}function ld(a,t,e){let o=yt();return{promise:a(t,{...e,signal:o.signal}),cancel:()=>o.abort()}}function dd(a,t,e){if(et())return ld(a,t,e);let o=new AbortController,s=o.signal;return{promise:a(t,{...e,signal:s}),cancel:()=>o.abort()}}function Au(a,t){return dd(k.get,a,t)}function yu(){let{accountStore:a,receiveAddressStore:t}=J(),{address:e,setUserForbiddenBridge:o}=a,{receiveAddrObj:s,computedSwapHighLight:i}=t,{specifiedAddress:n}=s||{};(0,_u.useEffect)(()=>{let c=()=>{};if(e&&i){let{promise:d,cancel:m}=Au(da,{params:{userWalletAddress:e,receiveWalletAddress:n}});c=m,d.then(p=>{o(p?.data.blackListTypes||se)}).catch(()=>{o(se)})}else o(se);return c},[e,o,n,i])}u();l();var Eu=E(V());function Ds(){let{accountStore:{address:a}}=J();(0,Eu.useEffect)(()=>{b.setTags({address:a})},[a])}u();l();var ku=E(V());var md=()=>{let{accountStore:a,fromToStore:t,approveStore:e,recentTransactionStore:o,tokenModalStore:s}=J();(0,ku.useEffect)(()=>{let{computedAccountWalletAddresses:i}=a;return i&&($t.addListen("error",()=>{e.onSocketError(),o.onSocketError(),t.setNeedBalanceLoading(!1),t.getSwapTokenBalance(),s.reloadTokenList()}),$t.addListen(ws.DEX_PUSH_ENGINE,n=>{o.onSocket(n),e.onSocket(n)}),$t.addListen(ws.WALLET_ASSET,n=>{n&&(s.updateAllTokenList(n),t.updateFromBalancePush(n))}),$t.init(i)),()=>{$t.removeAll(),$t.wsInstance&&i&&$t.logout(i)}},[a.computedAccountWalletAddresses,o.onSocket,s.updateAllTokenList,t.updateFromBalancePush,a,o,s])},wu=md;u();l();var Yt=E(V()),vu=E(Ft());var pd=({currency:a,currentWallet:t,walletInfo:e,keyringIdentityTypeEnum:o,addressBookList:s,walletList:i,t:n,dispatch:c,currentTab:d,onBack:m})=>{let{commonStore:p,accountStore:f,recentTransactionStore:g,reset:I}=J(),A=(0,vu.useHistory)();(0,Yt.useEffect)(()=>{L.setRuntimeContext({history:A,toLocale:n,dispatch:c,walletInfo:e,onBack:m})},[n,A,c,e,m]),(0,Yt.useEffect)(()=>{t&&f.setWalletConfig(t)},[t]),(0,Yt.useEffect)(()=>(p.getUserUnit(a),p.fetchChainList({businessLine:1,currentTab:d}).catch(()=>{p.setChainListLoadError(!0)}),()=>{I()}),[]),(0,Yt.useEffect)(()=>{f.setAddressBookList(s)},[s]),(0,Yt.useEffect)(()=>{f.setWalletList(i)},[i]),(0,Yt.useEffect)(()=>{f.setKeyringIdentityTypeEnum(o)},[o]),(0,Yt.useEffect)(()=>{t.walletId?g.updatePendingOrders(t.walletId):g.setPendingOrders([])},[t.walletId,d]),Za()},bu=pd;u();l();var St=E(V()),Xt=E(Ft());u();l();var lo=E(V()),Cr=E(Ft()),xu=E(sd());u();l();var Lu=E(V());var hd=({visible:a,onBack:t=()=>{},params:e})=>{let{useCoin:o}=L.hooks,{coinId:s,receiveOnly:i,chainId:n,tokenContractAddress:c}=e,d=o(n,c);return a&&Lu.default.createElement(L.components.SupplyGas,{visible:a,closeCallback:t,coinId:s||d.coinId,receiveOnly:i})},Ru=hd;u();l();var gr=E(V()),Du=E(Ft());u();l();var Ou=E(V());var fd=()=>{let{components:{Mev:a}}=L,{quoteStore:{quote:t},mevStore:e}=J(),{bestRoute:o}=t||{},{fromToken:s,toToken:i}=o||{},n=o?.isEnableMev,{computedIsMevOpen:c,setMevUserSwitchOpen:d,setMevInfo:m}=e,p=!c&&Number(n)===Qo.ON;return Ou.default.createElement(a,{isMev:c,chainId:s?.chainId,toChainId:i?.chainId,isShowBlockSwapMevTooltip:p,onMevChange:(f,g)=>{d(f),m(g)}})},Nu=kt(fd);var Sd=[It,Ot],Pu={[st]:"swaptrade_card_swap_title_swap",[it]:"swaptrade_card_swap_title_swap",[Ot]:"",[It]:"swaptrade_extension_cinteraction_contract_interaction",[eo]:"swaptrade_recent_transaction_detail_dialog_title"},gd=a=>{let t="",e=null,o=!1,s=!1,i=a.pathname,{type:n}=Fa(a.search),c=n===rt.INTENT_SWAP,d=p=>h(Pu[p]),m=Sd.find(p=>i.startsWith(p));return m===a.pathname?t=d(m):m===Ot&&m!==a.pathname?t=h(Pu[eo]):t=d(i),(i===st||i===it)&&(o=!0),i===st&&(s=!0),i===It&&!c&&(e=gr.default.createElement(Nu,null)),{title:t,rightIcon:e,settingIcon:o,isAllowShareBlinkPath:s}},Td=()=>{let a=(0,Du.useLocation)();return(0,gr.useMemo)(()=>gd(a),[a])},Fu=Td;u();l();var Tr={wrapper:"_wrapper_bmqyn_1",container:"_container_bmqyn_5"};var Cd=[st,it],Id=({children:a,onBack:t})=>{let{title:e,isGray:o,rightIcon:s,settingIcon:i,isAllowShareBlinkPath:n}=Fu(),c=(0,Cr.useLocation)(),d=(0,Cr.useHistory)(),{fromToStore:m,swapStore:p,tradeModeStore:f}=J(),{visibleAddFunds:g,addFundsParams:I,closeAddFunds:A}=m,{walletSnapSwitchVisible:R,setWalletSnapSwitchVisible:w}=f,q=ec(),K=()=>{w(!R)},nt=()=>{c.pathname===It&&xe({...p.getSaveOrderMonitorData(),button_name:"back"}),t?t(d.goBack,Cd.includes(c.pathname)):d.goBack()};return lo.default.createElement("div",{className:(0,xu.default)("universe-swap background-base-primary",Tr.wrapper,{[Tr.grey]:o})},lo.default.createElement(tc,{title:e,onBack:nt,rightIcon:s,settingIcon:i,settingIconClick:K,showShareBlinkIcon:q&&n}),lo.default.createElement("div",{className:Tr.container},a),lo.default.createElement(Ru,{visible:g,params:I,onBack:A}))},Mu=kt(Id);var Ad=(0,St.lazy)(()=>import("./Swap-KAUMIHGC.js")),_d=(0,St.lazy)(()=>import("./Bridge-5AOWYP6F.js")),yd=(0,St.lazy)(()=>import("./OrderDetail-WRCAKN6W.js")),Ed=(0,St.lazy)(()=>import("./Contract-SXEJB66C.js")),kd=({onBack:a})=>{let t=(0,Xt.useLocation)();return St.default.createElement(Mu,{onBack:a},St.default.createElement(St.Suspense,null,St.default.createElement(Xt.Switch,null,[{path:st,component:Ad,exact:!0},{path:it,component:_d,exact:!0},{path:eo,component:yd,exact:!0},{path:It,component:Ed,exact:!0}].map((o,s)=>St.default.createElement(Xt.Route,{key:s,path:o.path,component:o.component,exact:o.exact})),St.default.createElement(Xt.Redirect,{from:Xo,to:{pathname:st,search:t.search},strict:!0,exact:!0}))))},Bu=kd;var wd=({currency:a,currentWallet:t,keyringIdentityTypeEnum:e,addressBookList:o,walletList:s,walletInfo:i,onBack:n,t:c,dispatch:d,currentTab:m=y.SWAP})=>{Cu(i.chainId),bu({currency:a,currentWallet:t,walletInfo:i,keyringIdentityTypeEnum:e,addressBookList:o,walletList:s,t:c,dispatch:d,currentTab:m,onBack:n}),yu(),wu(),Ds();let{initialized:p}=du();return p?Ir.default.createElement(Bu,{onBack:n}):null},Uu=(0,Ir.memo)(kt(wd));u();l();D();u();l();u();l();u();l();u();l();var Wu=(a,t)=>{let e=a.split(".").map(Number),o=t.split(".").map(Number),s=Math.max(e.length,o.length);for(let i=0;i<s;i++){let n=e[i]||0,c=o[i]||0;if(n>c)return 1;if(n<c)return-1}return 0};var mo=class{constructor(){r(this,"btcAddressType","");r(this,"setBtcAddressType",t=>{this.btcAddressType=t});r(this,"commonStore",null);r(this,"userForbiddenWithBridge",se);r(this,"setUserForbiddenBridge",t=>{this.userForbiddenWithBridge=t});r(this,"defaultWalletConfig",Ln);r(this,"walletConfig",this.defaultWalletConfig);r(this,"hasInitWalletInfo",!1);r(this,"chainId",jt);r(this,"setChainId",t=>{this.chainId=t});r(this,"fromChainId",jt);r(this,"setFromChainId",t=>{this.fromChainId=t});r(this,"walletSupportMev",!1);r(this,"setWalletSupportMev",t=>{this.walletSupportMev=t});r(this,"checkOkxVersion",async()=>{let t="2.82.31",e=this.walletConfig.isOkxWallet;if(this.isConnectedWallet&&e&&window?.okxwallet?.getVersion){let o=await window.okxwallet.getVersion(),i=Wu(o,t)>=0;this.setWalletSupportMev(i)}else this.setWalletSupportMev(!1)})}getDeviceId(){}getChainId(){}get scanAppType(){throw new Error("scanAppType is not defined")}get walletType(){throw new Error("walletType is not defined")}get address(){return jt}get computedForbiddenBridge(){let{computedIsCrossChain:t}=this.rootStore.fromToStore;return t?this.userForbiddenWithBridge:se}get computedAccountId(){let{walletConfig:t}=this;return t.walletId}setWalletConfig(t={}){this.walletConfig=t}getAddressByChainId(){}get isConnectedWallet(){return!!this.walletConfig.walletId}get computedNonsupportChain(){return!this.isConnectedWallet||!G(this.fromChainId)?!1:!this.address}get computedAccountWalletAddresses(){return De(_(this,"walletConfig.address",[])).join(",")||this.address}get computedAccountWalletAddressesArray(){return De(_(this,"walletConfig.address",[]))||[this.address]}get computedSpecialWalletAddress(){return this.getAddressByChainId(B.BTC_MAINNET)}};u();l();u();l();function gt(a=[],t=[]){let e={};a.forEach(s=>{e[s]=$e});let o={};return t.forEach(s=>{o[s]=pn}),{...e,...o}}var Vu=gt(["walletConfig","chainId","hasInitWalletInfo","fromChainId","btcAddressType"],["computedAccountId","isConnectedWallet","computedNonsupportChain","computedAccountWalletAddresses","computedAccountWalletAddressesArray","address","computedSpecialWalletAddress"]);var Fs=class extends mo{constructor(e){super();r(this,"formatWalletType",()=>{let{walletInfo:e}=L,{isHARDWARE:o,isMNEMONIC:s,isMPC:i,isPRIVATE:n}=e?.walletType||{};return o?Wt.HARDWARE:s?Wt.MNEMONIC:i?Wt.MPC:n?Wt.PRIVATE_KEY:null});r(this,"formatWalletAccount",e=>{let o=Object.values(e.account);return{...e,OKXWalletType:this.formatWalletType(),address:o}});r(this,"keyringIdentityTypeEnum",{});r(this,"walletList",[]);r(this,"addressBookList",[]);r(this,"hasInitWalletInfo",!1);r(this,"getAddressByChainId",e=>{if(!G(e))return jt;let o=this.getWalletChainName(e);return this.walletConfig.account?.[o]||jt});this.rootStore=e,this.commonStore=e.commonStore,ct(this,Vu)}async getDeviceId(){let{devid:e}=await L.localStore.get("devid");return e}getCurrentChainAddress(e){let o=this.rootStore?.fromToStore.from.chainId;if(!G(o))return jt;let s=this.getWalletChainName(o);return e.account[s]}getWalletChainName(e){return L.getNetWorkName(e)}replaceBtcAddressByType(e){if(this.btcAddressType){let o=this.getWalletChainName(B.BTC_MAINNET);if(e.account?.[o]){let i=e.accountsMap?.bitcoin?.[this.btcAddressType]?.address;if(i)return{...e,account:{...e.account,[o]:i}}}}return e}setWalletConfig(e){this.walletConfig=this.formatWalletAccount(this.replaceBtcAddressByType(e)),this.hasInitWalletInfo=!0}webSwapHistoryDetailViewMore(){}setAddressBookList(e){this.addressBookList=e}setWalletList(e){this.walletList=e.map(o=>o.walletId===this.computedAccountId?this.replaceBtcAddressByType(o):o)}setKeyringIdentityTypeEnum(e){this.keyringIdentityTypeEnum=e}get address(){return this.getAddressByChainId(this.fromChainId)}},qu=Fs;u();l();u();l();D();u();l();var dt={COLLECT_LIST:"COLLECT_LIST",ALL_NETWORK:"ALL_NETWORK",CHAIN_LIST:"CHAIN_LIST",SEARCH:"SEARCH",ALL_TOKENS:"ALL_TOKENS"},vd={[dt.COLLECT_LIST]:{[y.SWAP]:Jn,[y.LIMIT_ORDER]:zn,[y.BRIDGE]:Zn},[dt.ALL_NETWORK]:{[y.SWAP]:Yn,[y.LIMIT_ORDER]:jn,[y.BRIDGE]:Xn},[dt.SEARCH]:{[y.SWAP]:ea,[y.LIMIT_ORDER]:ta,[y.BRIDGE]:oa},[dt.CHAIN_LIST]:{[y.SWAP]:Un,[y.LIMIT_ORDER]:Vn,[y.BRIDGE]:Wn},[dt.ALL_TOKENS]:{[y.SWAP]:Ts,[y.LIMIT_ORDER]:Ts,[y.BRIDGE]:On}},Dt=(a,t)=>vd[a]?.[t]??"";u();l();var xs=a=>!!(a?.isNativeToken===Sn.TRUE||a?.isBaseCoin),Ar=a=>a?G(a.chainId)&&a.tokenContractAddress:!1;var po=class{constructor(t){r(this,"rootStore",null);r(this,"userUniqueId",ja());r(this,"chainListFreshCount",0);r(this,"chainList",[]);r(this,"setChainList",t=>{this.chainList=t,this.chainListFreshCount+=1});r(this,"transactionLoading",!1);r(this,"setTransactionLoading",t=>{this.transactionLoading=t});r(this,"nowCurrencyUnit",{});r(this,"tokenModalVisible",!1);r(this,"safemoonSlippage",0);r(this,"fetchChainList",async({businessLine:t=1,isLimit:e=!1,isHistory:o=!1,currentTab:s,chainIdConfig:i={}})=>{if(pi())return[];let n=Dt(dt.CHAIN_LIST,this.currentTab||s),c=await k.get(n,{params:{businessLine:e?Nt.LIMIT_ORDER:t,...i}});return!o&&this.setChainList(c?.data),this.setCurrentTabChainList({[e?y.LIMIT_ORDER:y.SWAP]:c?.data}),c?.data});r(this,"currentTabChainList",{});r(this,"setCurrentTabChainList",t=>{this.currentTabChainList={...this.currentTabChainList,...t}});r(this,"getTradeType",()=>this.rootStore?.fromToStore?.computedIsCrossChain?gs.MULTI:gs.SINGLE);r(this,"globalMessages",null);r(this,"setGlobalMessage",t=>{this.globalMessages=t});r(this,"cleanGlobalMessage",()=>{this.globalMessages=null});r(this,"socketStatus",!1);r(this,"balancePushSocketStatus",!1);r(this,"resetFromToByTabChange",!1);r(this,"setResetFromToByTabChange",t=>{this.resetFromToByTabChange=t});r(this,"portal",_t.DEX);r(this,"setPortal",t=>{this.portal=t});r(this,"currencyConversion",t=>{let{usdToThisRate:e}=this.nowCurrencyUnit,o=T.BigNumber(t);return!e||o.isNaN()?"":o.multipliedBy(e)});r(this,"currencyReConversion",t=>{let{usdToThisRate:e}=this.nowCurrencyUnit,o=T.BigNumber(t);return!e||o.isNaN()?"":o.dividedBy(e).toString()});r(this,"isSensitiveChain",t=>this.computedSensitiveChainIds.some(e=>String(e)===String(t)));r(this,"getTokenAddress",t=>{let e=this.isSensitiveChain(t?.chainId),o=t?.tokenContractAddress||t?.tokenAddress;return e?o:Pt(o)});r(this,"equalsToken",(t,e)=>{let o=t!==null&&String(t?.chainId)===String(e?.chainId);return xs(t)&&xs(e)?o:o&&this.getTokenAddress(t)===this.getTokenAddress(e)});r(this,"fromFillToken",!1);r(this,"currentTab","");r(this,"setCurrentTab",(t,e)=>{this.currentTab!==t&&(this.setResetFromToByTabChange(!0),this.rootStore?.fromToStore?.clearFromTo()),this.currentTab=t,this.fromFillToken=!!e});r(this,"marketWsIsConnected",!1);r(this,"setMarketWsIsConnected",t=>{this.marketWsIsConnected=t});r(this,"forceUpdateFromToByHash",0);r(this,"forceUpdateFromTo",()=>{this.forceUpdateFromToByHash+=1});r(this,"isFirstInit",!0);this.rootStore=t,Be&&this.setPortal(_t.LEDGER)}setChainType(){}get computedReserveGas(){let{chainList:t}=this,e=this.rootStore.fromToStore.from.chainId;return t.find(s=>Number(s.chainId)===Number(e))?.reserveGas||""}getChainByID(t){return this.chainList.find(e=>(this.computedCurrentTabIsLimit||e.chainUsed)&&e.chainId===Number(t))}getUserUnit(){}get computedRealSlippageValue(){return _(this,"rootStore.slippageStore",{}).computedRealSlippageValue||0}setSocketStatus(t){this.socketStatus=t}setBalanceSocketStatus(t){this.balancePushSocketStatus=t}get computedIsWalletEnv(){return this.portal===_t.OKX_WALLET_EXTENSION}get computedIsWalletDashBoard(){return this.portal===_t.WALLET_DASHBOARD}get computedIsMarket(){return this.portal===_t.MARKET}get computedNotThirdBiz(){return this.portal===_t.OKX_WALLET_EXTENSION||this.portal===_t.DEX||this.portal===_t.MARKET}get computedNowCurrencySymbol(){return this.nowCurrencyUnit.symbol||""}get computedSensitiveChainIds(){return this.chainList.map(t=>Number(t.isSensitive)===In.YES?t.chainId:null).filter(Boolean)}get computedCurrentTabIsLimit(){return this.currentTab===y.LIMIT_ORDER}get computedIsUrlFillSwap(){return this.computedIsWalletDashBoard||this.computedIsWalletEnv}toBaseFormatUSD(t,e){let o=this.computedNowCurrencySymbol,s=this.nowCurrencyUnit?.usdToThisRate,i=T.BigNumber(t).multipliedBy(s).toString();return ot(i,o,{needPlaceholder:!0,...e})}setIsFirstInit(t){this.isFirstInit=t}};u();l();var Gu=gt(["userUniqueId","chainList","transactionLoading","nowCurrencyUnit","tokenModalVisible","safemoonSlippage","globalMessages","socketStatus","balancePushSocketStatus","portal","currentTab","currentTabChainList","forceUpdateFromToByHash","marketWsIsConnected","isFirstInit"],["computedReserveGas","computedNowCurrencySymbol","computedSensitiveChainIds","computedIsWalletEnv","computedCurrentTabIsLimit"]);var ho=class extends po{constructor(e){super(e);r(this,"swapCollapse",!1);r(this,"setSwapCollapse",e=>{this.swapCollapse=e});r(this,"chainListLoadError",!1);r(this,"setChainListLoadError",e=>{this.chainListLoadError=e});ct(this,{...Gu,swapCollapse:$e,chainListLoadError:$e}),this.setPortal(wn)}getUserUnit(e){this.nowCurrencyUnit=e}};u();l();var fo=class{constructor(){r(this,"snapModeSwitch",!er()&&!1);r(this,"setSnapModeSwitch",t=>{this.snapModeSwitch=t,this.resetTradingModeBySwitch(t)});r(this,"isSupportSnapChain",!1);r(this,"isMetSnap",Go.NOT_SUPPORT);r(this,"tradingModeType","");r(this,"walletSnapSwitchVisible",!1);r(this,"setWalletSnapSwitchVisible",t=>{this.walletSnapSwitchVisible=t});r(this,"bestPriceTag",us.NO_COMPARE);r(this,"setBestPriceTag",t=>{this.bestPriceTag=t});F(this,{},{autoBind:!0})}resetTradingModeBySwitch(t,e){e&&!this.tradingModeType||(this.setTradingModeType(t?Vt.COMPARE_MODE:Vt.AUTO),this.setBestPriceTag(us.NO_COMPARE))}setIsSupportSnapChain(t){this.isSupportSnapChain=t}setIsMetSnap(t){this.isMetSnap=t}setTradingModeType(t){this.tradingModeType=t}get computedIsSnapType(){return this.tradingModeType===Vt.SNAP_MODE}};u();l();D();var So=class{constructor(t){r(this,"showLimitDialog",!1);r(this,"setShowLimitDialog",t=>{this.showLimitDialog=t});r(this,"cancelRef",null);r(this,"callbackList",[]);r(this,"addToCallbackList",t=>{this.callbackList.push(t)});r(this,"removeFromCallbackList",t=>{this.callbackList=this.callbackList.filter(e=>e!==t)});r(this,"updateTokenCollectStatus",async({tokenInfo:t,callBack:e})=>{let{isConnectedWallet:o}=this.accountStore;if(!o){this.walletWarnInterceptor();return}this.cancelRef&&this.cancelRef.abort(),this.cancelRef=yt();let s={tokenContractAddress:t?.tokenContractAddress,chainId:Number(t?.chainId),symbol:t?.tokenSymbol,decimal:t?.decimals,walletAddress:this.accountStore.getAddressByChainId(Number(t?.chainId))||this.accountStore.computedAccountWalletAddresses,userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,mnemonicWallet:this.accountStore.computedAccountWalletAddresses,isCustomToken:t?.isCustomToken||t?.isSubscribe},[i,n]=await O(k.post(Yo,s,{signal:this.cancelRef.signal}));if(!Qt(i)&&i)P.error(h("swaptrade_pricechart_no_connection_desc"));else if(n){if(n?.data===-1)this.setShowLimitDialog(!0);else if(n?.data===0)P.success({title:h("swaptrade_selecttoken_toast_removed_from_favorite"),duration:At}),e({selected:!1,tokenInfo:t}),this.callbackList.forEach(c=>{c({selected:!1,tokenInfo:t})});else if(n?.data===1){let c=Ha(),{isMarketHomeUrl:d}=Qa();!d&&or({business_type:c?ms.LIMIT_ORDER:ms.SWAP}),P.success({title:h("swaptrade_selecttoken_toast_added_to_favorite"),duration:At}),e({selected:!0,tokenInfo:t}),this.callbackList.forEach(m=>{m({selected:!0,tokenInfo:t})})}}});r(this,"debounceUpdateTokenCollectStatus",Jo(this.updateTokenCollectStatus,500));r(this,"walletWarnInterceptor",()=>{P.error({title:h("swaptrade_selecttoken_toast_connect_wallet"),duration:At})});this.rootStore=t,this.commonStore=t.commonStore,this.accountStore=t.accountStore,F(this,{},{autoBind:!0})}};var ne=class{constructor(){ne.instance?(this.commonStore=ne.instance.commonStore,this.accountStore=ne.instance.accountStore,this.updateCollectionStore=ne.instance.updateCollectionStore):(this.commonStore=new ho(this),this.accountStore=new qu(this),this.updateCollectionStore=new So(this),ne.instance=this),this.tradeModeStore=new fo(this)}},ae=ne;r(ae,"instance",null);u();l();u();l();D();u();l();function _r(a){return[qt.USER_DENIED,qt.WC2Denied,qt.USER_DENIED_WC_RAINBOW,qt.WC_QR_DENIED].includes(a?.code)}var Ms=class{constructor(t){r(this,"approveTokenDefaultConfig",{status:x.Unknown,approvedAmount:"0"});r(this,"approveTokensConfig",{});r(this,"getApproveTokenMapKey",(t,e)=>{let o=this.commonStore.getTokenAddress(t);return`${t.chainId}_${o}_${e}`});r(this,"registerApproveToken",(t,e)=>{let o=this.getApproveTokenMapKey(t,e),s=_(this.approveTokensConfig,o);Y(s)&&(this.approveTokensConfig[o]={...this.approveTokenDefaultConfig})});r(this,"registerCurrentApproveToken",()=>{let{token:t,tradeModeCode:e}=this.computedTokenAndTradeModeCode;this.registerApproveToken(t,e)});r(this,"updateApproveTokenConfig",(t,e,o)=>{let s=this.getApproveTokenMapKey(t,e),i=_(this.approveTokensConfig,s);Y(i)?b.stuff("if you want to update approve token config, you should register it first."):this.approveTokensConfig[s]={...i,...o}});r(this,"removeApproveTokenConfig",(t,e)=>{let o=this.getApproveTokenMapKey(t,e);delete this.approveTokensConfig[o]});r(this,"updateCurrentApproveTokenConfig",t=>{let{token:e,tradeModeCode:o}=this.computedTokenAndTradeModeCode;this.updateApproveTokenConfig(e,o,t)});r(this,"getApproveTokenConfig",(t,e)=>{let o=this.getApproveTokenMapKey(t,e);return _(this.approveTokensConfig,o,this.approveTokenDefaultConfig)});r(this,"clearNonApprovingTokensConfig",()=>{let t=va(this.approveTokensConfig,e=>[x.Approving,x.CancelApproving].includes(e.status));this.approveTokensConfig={...t}});r(this,"isApprovalCheckRequired",()=>{let{computedIsSolanaChain:t,computedIsAptosChain:e}=this.fromToStore,{quote:{bestRoute:o}}=this.rootStore.quoteStore,s=this.commonStore.computedCurrentTabIsLimit,{token:i}=this.computedTokenAndTradeModeCode,{isNativeToken:n}=i;return(s?!0:o?.needApprove==="1")&&!n&&!t&&!e});r(this,"validApproveAmountLessSwapAmount",t=>{let{token:e}=this.computedTokenAndTradeModeCode;return T.BigNumber(t).isLessThan(e.amount||"0")});r(this,"isValidApprovalStatus",(t,e)=>{let o=Gt(t),s=this.validApproveAmountLessSwapAmount(t);return o?x.UnApproved:s&&e?x.CancelApprove:s?x.UnApproved:x.Approved});r(this,"generateApproveRequestParams",t=>{let{address:e}=this.accountStore,{token:o,tradeModeCode:s}=this.computedTokenAndTradeModeCode,{tokenContractAddress:i,chainId:n}=o,{computedIsDexQuote:c}=this.rootStore.quoteStore;return{userWalletAddress:e,tokenContractAddress:i,chainId:n,cancelApproveTag:t,...c?{}:{intentCode:s}}});r(this,"fetchApproveAllowance",()=>k.get(Qn,{params:this.generateApproveRequestParams()}).then(t=>t?.data));r(this,"fetchApproveData",t=>{let e=this.generateApproveRequestParams(t);return k.get(Kn,{params:e}).then(o=>{let{id:s,data:i,from:n,to:c,unsignedTx:d}=o?.data||{},m={data:i,from:n,to:c};return b.info(N.APPROVE_DATA,{id:s,data:i,from:n,to:c,unsignedTx:d,cancelApproveTag:t}),nr(e.chainId)&&(m=JSON.parse(d)),{transactionPayload:m,id:s}})});r(this,"approveStatusIsPending",()=>[x.Approving,x.CancelApproving].includes(this.computedApprovalStatus));r(this,"isPendingNeedCheck",async()=>{this.approveStatusIsPending()&&this.checkApprove().catch(()=>{})});r(this,"isPendingNotCheck",async()=>{this.approveStatusIsPending()||this.checkApprove().catch(()=>{})});r(this,"checkApprove",async()=>{let{token:t,tradeModeCode:e}=this.computedTokenAndTradeModeCode;if(this.registerApproveToken(t,e),!this.isApprovalCheckRequired()){this.updateApproveTokenConfig(t,e,{status:x.Approved});return}let{tokenContractAddress:o,decimals:s}=t,{address:i}=this.accountStore;if(o&&i){let[,n]=await O(this.fetchApproveAllowance());if(!n){this.updateApproveTokenConfig(t,e,{status:x.Unknown});return}let c=Number(n.status)===x.Approved?n.amount:"0",d=Fe(c,s)||"0",m=n?.needCancelApproveToken,p=this.isValidApprovalStatus(d,m);this.updateApproveTokenConfig(t,e,{status:p,approvedAmount:d})}});r(this,"fetchApproveDataErrorTips",(t,e)=>{this.updateCurrentApproveTokenConfig({status:x.UnApproved});let o=U(t?.tokenSymbol);cr({title:e?h("swaptrade_transfer_notification_title_ccy_unrevoked",{ccy:o}):h("swaptrade_toast_approve_fail",{tokenSymbol:o})})});r(this,"approveErrorTips",({error:t,chainId:e,transactionPayload:o,token:s,tradeModeCode:i,cancelApproveTag:n})=>{b.error(N.APPROVE_TOKEN_ERROR,{chainId:e,transactionPayload:o,error:t,token:s,tradeModeCode:i}),_r(t)||ke.error({title:h("swaptrade_home_toast_broadcast_failed")}),this.updateApproveTokenConfig(s,i,{status:this.isCancelApprove(n)?x.CancelApprove:x.UnApproved})});r(this,"isCancelApprove",t=>t===be.CANCEL_APPROVE);r(this,"setApprove",async t=>{let{token:e,tradeModeCode:o}=this.computedTokenAndTradeModeCode,{chainId:s}=e;this.updateApproveTokenConfig(e,o,{status:this.isCancelApprove(t)?x.CancelApproving:x.Approving});try{let{id:i,transactionPayload:n}=await this.fetchApproveData(t);await this.approveToken({chainId:s,transactionPayload:n}).then(({result:c})=>this.saveApprove({id:i,chainId:s,transactionHash:c,cancelApproveTag:t})).catch(c=>{this.approveErrorTips({error:c,chainId:s,transactionPayload:n,token:e,tradeModeCode:o,cancelApproveTag:t})})}catch{this.fetchApproveDataErrorTips(e,t)}});r(this,"saveApprove",async({id:t,chainId:e,transactionHash:o,cancelApproveTag:s})=>{if(!o)return;let{address:i}=this.accountStore;b.info(N.SAVE_APPROVE,{id:t,transactionHash:o,chainId:e,userWalletAddress:i,cancelApproveTag:s});try{await k.post($n,{id:t,transactionHash:o,chainId:e,userWalletAddress:i,cancelApproveTag:s})}catch(n){b.info(N.SAVE_APPROVE_ERROR,{error:n?.message,id:t,transactionHash:o,chainId:e,userWalletAddress:i,cancelApproveTag:s})}});r(this,"onSocket",async t=>{if(t?.type==="1"&&t?.dexData&&t.dexData.type==="approve"){let e=t.dexData,{status:o,transactionHash:s,fromTokenSymbol:i,fromTokenAddress:n,exploreUrl:c,solanaToast:d,intentCode:m=Ho}=e,p=et();if(d==="1"){if(p)return;let w=o===Le.CANCEL_APPROVE_SUBMITTED?"swaptrade_transfer_toast_ccy_unrevoke_submit":"swaptrade_transfer_notification_approval_submit";ar({title:h(w,{ccy:U(i)})});return}let{token:f,tradeModeCode:g}=this.computedTokenAndTradeModeCode,I={chainId:e.chainId,tokenContractAddress:n},A=this.commonStore.equalsToken(f,I),R=String(g)===String(m);if(A&&R&&await this.isPendingNeedCheck(),(!A||A&&!R)&&this.removeApproveTokenConfig(I,m),o===Le.APPROVE_SUCCESS){let w=h("swaptrade_toast_approve_success",{tokenSymbol:U(i)});!p&&ar({title:w,exploreUrl:c}),co.emit(ao.APPROVE,{data:s,status:0,message:w})}else if(o===Le.APPROVE_FAILED&&!p){let w=h("swaptrade_toast_approve_fail",{tokenSymbol:U(i)});cr({title:w,exploreUrl:c})}else if(o===Le.CANCEL_APPROVE_SUCCESS&&!p){let w=h("swaptrade_transfer_notification_title_ccy_revoked",{ccy:U(i)});ar({title:w,exploreUrl:c})}else if(o===Le.CANCEL_APPROVE_FAILED&&!p){let w=h("swaptrade_transfer_notification_title_ccy_unrevoked",{ccy:U(i)});cr({title:w,exploreUrl:c})}}});r(this,"onSocketError",()=>{this.isPendingNeedCheck().catch(()=>{})});this.rootStore=t,this.accountStore=t.accountStore,this.commonStore=t.commonStore,this.fromToStore=t.fromToStore}get computedApprovalStatus(){let{token:t,tradeModeCode:e}=this.computedTokenAndTradeModeCode;return this.getApproveTokenConfig(t,e).status}get computedTokenAndTradeModeCode(){let{from:t}=this.fromToStore,{tradingModeType:e}=this.rootStore.tradeModeStore;return{token:t,tradeModeCode:e}}get computedIsCancelApproveStatus(){return[x.CancelApprove,x.CancelApproving].includes(this.computedApprovalStatus)}approveToken(){}},Hu=Ms;u();l();var Qu=Symbol(),Ku=Object.prototype,Ld=(a,t,e)=>{if(hn(a))throw new Error("Target must not be observable");let o=a[Qu];if(o){let s={};for(let i in a)o[i]&&(s[i]=o[i]);o=s}else{o={};let s=a;for(;s&&s!==Ku;)Reflect.ownKeys(s).forEach(n=>{n===mn||n==="constructor"||(o[n]=t&&n in t?t[n]:!0)}),s=Object.getPrototypeOf(s);let i=Object.getPrototypeOf(a);i&&i!==Ku&&Object.defineProperty(i,Qu,{value:o})}return ct(a,o,e)},zt=Ld;var ce=class extends Hu{constructor(e){super(e);r(this,"visibleApprove",!1);r(this,"setVisibilityApprove",e=>{this.visibleApprove=e});r(this,"approveInfo",{});r(this,"setApproveInfo",e=>{this.approveInfo=e});r(this,"setApprove",async(e=be.APPROVE)=>{let{token:o,tradeModeCode:s}=this.computedTokenAndTradeModeCode,{chainId:i}=o;this.updateApproveTokenConfig(o,s,{status:this.isCancelApprove(e)?x.CancelApproving:x.Approving});try{let{id:n,transactionPayload:c}=await this.fetchApproveData(e);this.setApproveInfo({chainId:i,id:n,transactionPayload:c,token:o,tradeModeCode:s,cancelApproveTag:e}),this.setVisibilityApprove(!0)}catch{this.fetchApproveDataErrorTips(o,e)}});r(this,"approveCancel",()=>{let e=this.approveInfo.cancelApproveTag;this.setApproveInfo({}),this.setVisibilityApprove(!1),this.updateCurrentApproveTokenConfig({status:this.isCancelApprove(e)?x.CancelApprove:x.UnApproved})});r(this,"approveConfirm",async({txHash:e,error:o})=>{if(o){this.approveErrorTips({error:o,...this.approveInfo}),this.approveCancel();return}let{id:s,chainId:i,cancelApproveTag:n}=this.approveInfo;await this.saveApprove({id:s,chainId:i,transactionHash:e,cancelApproveTag:n}),this.setVisibilityApprove(!1),this.setApproveInfo({})});zt(this)}};u();l();D();u();l();var ue=()=>{let{fromToStore:a,gasDropStore:t,receiveAddressStore:e,outerStore:o,quoteStore:s,accountStore:i,tradeModeStore:n,liquidityChooseStore:c}=Bt(),{from:d,to:m}=a,{receiveAddrObj:p}=e,{computedForbiddenBridge:f,address:g}=i,{tradingModeType:I}=n,A=T.BigNumber(a.computedTypedValue).toString(10),w={...{chainId:d.chainId,toChainId:m.chainId,toTokenAddress:m.tokenContractAddress,fromTokenAddress:d.tokenContractAddress,amount:A,userWalletAddress:g},...s.computedSlippage,pmm:"1",gasDropType:t?.computedGasDropSelected?1:0,forbiddenBridgeTypes:ys(f),dexIds:ys(c?.computedIds),receiveWalletAddress:p?.specifiedAddress,tradingModeType:I};return o.extendFeeConfig(w)};u();l();u();l();u();l();var Q=class{constructor({orderData:t,extParams:e},o){r(this,"walletNoNeedExtParams",!1);r(this,"differentiatedEnvironment",t=>et()&&t.length>1&&!this.walletNoNeedExtParams&&!t[0].params?[{...t[0],extParams:t[1]}]:t);this.orderData=t,this.calldataType=t.calldataType,this.extParams=e||{},this.swapStore=o}get isTransferType(){return this.calldataType===_n.TRANSFER}};var le=class extends Q{constructor(){super(...arguments);r(this,"formatContractPayload",()=>{let{orderData:e}=this;return{...JSON.parse(e?.callData?.data)}});r(this,"formatTransferPayload",()=>{});r(this,"getSendTransactionParams",async()=>{let e=this.formatContractPayload();return this.differentiatedEnvironment([{...e,extParams:this.extParams}])});r(this,"preExecution",async()=>({payload:this.formatContractPayload()}))}};r(le,"chainId",B.APTOS_MAINNET);u();l();var de=class extends Q{constructor(e,o,s){super(e,o);r(this,"makeSendBtcCallParams",async e=>{let{preDataForSendBtc:o}=this.swapStore.rootStore.walletContractStore;if(!o)throw Error("preDataForSendBtc is not ready");let{satBytes:s,coinAmount:i,dustSize:n,fetchUtxoList:c,serviceCharge:d}=o,m=await c();return{...e,utxoList:m,satBytes:s,dustSize:n,coinAmount:i,serviceCharge:d}});r(this,"formatContractPayload",()=>{});r(this,"formatTransferPayload",async()=>{let{orderData:e}=this;return this.swapStore.transferBtcPayload(e.callData)});r(this,"extendExtParams",e=>({...e,extParams:this.extParams}));r(this,"getSendTransactionParams",async()=>{if(!this.token.isNativeToken)throw new Error("btc token is not native token");let e;if(this.isTransferType){let o=await this.formatTransferPayload();e=this.extendExtParams(o),et()&&(e=await this.makeSendBtcCallParams(e))}else throw Error("Not support contract call");return this.differentiatedEnvironment([e])});r(this,"preExecution",async()=>{if(!this.token.isNativeToken)throw new Error("btc token is not native token");let e;if(this.isTransferType)e=await this.formatTransferPayload();else throw Error("Not support contract call");return{payload:e}});this.token=s}};r(de,"chainId",B.BTC_MAINNET);u();l();var yr=class extends Q{constructor(){super(...arguments);r(this,"valueToHex",e=>T.BigNumber(e).toString(16));r(this,"formatContractPayload",()=>{let{orderData:e}=this,{priorityFee:o,maxFeePerGas:s,maxPriorityFeePerGas:i,gasPrice:n,gas:c,...d}=e?.callData||{};return d});r(this,"formatTransferPayload",()=>{let{orderData:e}=this;return e.callData});r(this,"getSendTransactionParams",async()=>{let{payload:e}=await this.preExecution();return Be&&e.value&&(e.value=this.valueToHex(e.value)),this.differentiatedEnvironment([e])});r(this,"preExecution",async()=>{let e;this.isTransferType?e=this.formatTransferPayload():e=this.formatContractPayload();let{extendEvmParams:o,extendsGas:s}=this.swapStore;return e.extParams=this.extParams,s&&(e=s(e)),e=o(e),{payload:e}})}};r(yr,"chainId",B.ETHEREUM_MAINNET);var Er=yr;u();l();var me=class extends Q{constructor(){super(...arguments);r(this,"importSolana",async()=>{let e=await import("./index.browser.esm-B4MIWVSP.js"),{default:o}=await import("./bs58-QZ67DCOC.js");return{SolanaWeb3:e,bs58:o}});r(this,"deserialize",async e=>{let o,{SolanaWeb3:s,bs58:i}=await this.importSolana();try{o=s.Transaction.from(i.decode(e))}catch{o=s.VersionedTransaction.deserialize(i.decode(e))}return o});r(this,"rentReserve",e=>{if(!e)return"0";let{BigNumber:o}=T,s=o("365.25").div(2).multipliedBy(2);return o("19.055441478439427").multipliedBy(e).multipliedBy(s).div(10**9).toFixed(9)});r(this,"formatContractPayload",async()=>{let{orderData:e}=this,{bizType:o,bizId:s,data:i,accountLength:n}=JSON.parse(e.unsignedTx),c=await this.deserialize(i);return{payload:{bizType:o,bizId:s,transaction:c},rent:this.rentReserve(n)}});r(this,"formatTransferPayload",async()=>{let{orderData:e}=this,{unsignedTx:o}=e,s=JSON.parse(o),{data:i,accountLength:n}=s;return{payload:{transaction:await this.deserialize(i)},rent:this.rentReserve(n)}});r(this,"getSendTransactionParams",async()=>{let{payload:e}=await this.preExecution();return this.differentiatedEnvironment([e,this.extParams])});r(this,"preExecution",async()=>{let e;return this.isTransferType?e=await this.formatTransferPayload():e=await this.formatContractPayload(),e})}};r(me,"chainId",B.SOLANA_MAINNET);u();l();var pe=class extends Q{constructor(){super(...arguments);r(this,"formatContractPayload",()=>{let{orderData:e}=this,{data:o,from:s}=e.callData,i=JSON.parse(o);return{...i,functionArgs:i.functionArgsEncode,txType:"contract_call",stxAddress:s}});r(this,"formatTransferPayload",()=>{});r(this,"getSendTransactionParams",async()=>this.differentiatedEnvironment([this.formatContractPayload(),this.extParams]));r(this,"preExecution",async()=>({payload:this.formatContractPayload()}))}};r(pe,"chainId",B.STACKS_MAINNET);u();l();var he=class extends Q{constructor(){super(...arguments);r(this,"walletNoNeedExtParams",!0);r(this,"formatContractPayload",()=>{let{orderData:e}=this,o=JSON.parse(e.unsignedTx),{executionRequest:s}=JSON.parse(o.data);return s.calls});r(this,"formatTransferPayload",()=>{});r(this,"getSendTransactionParams",async()=>this.differentiatedEnvironment([this.formatContractPayload()]));r(this,"preExecution",()=>({payload:this.formatContractPayload()}))}};r(he,"chainId",B.STARKNET_MAINNET);u();l();var kr=class extends Q{constructor(){super(...arguments);r(this,"formatContractPayload",()=>{let{orderData:e}=this,{txBytes:o}=JSON.parse(e.unsignedTx);return{transactionBlock:o}});r(this,"getSendTransactionParams",async()=>this.differentiatedEnvironment([this.formatContractPayload(),this.extParams]));r(this,"preExecution",async()=>({payload:this.formatContractPayload()}))}};r(kr,"chainId",B.SUI_MAINNET);var Bs=kr;u();l();var wr=class extends Q{constructor(){super(...arguments);r(this,"walletNoNeedExtParams",!0);r(this,"formatContractPayload",()=>{let{orderData:e}=this,{params:o}=JSON.parse(e.unsignedTx);return o});r(this,"formatTransferPayload",()=>{let{orderData:e}=this,{params:o}=JSON.parse(e.unsignedTx);return o});r(this,"getSendTransactionParams",async()=>{let e=this.isTransferType?this.formatTransferPayload():this.formatContractPayload();return this.differentiatedEnvironment([e,this.extParams])});r(this,"preExecution",async()=>({payload:this.isTransferType?this.formatTransferPayload():this.formatContractPayload()}))}};r(wr,"chainId",B.TON_MAINNET);var Us=wr;u();l();var fe=class extends Q{constructor(){super(...arguments);r(this,"formatContractPayload",()=>{let{orderData:e}=this;return JSON.parse(e.unsignedTx)});r(this,"formatTransferPayload",()=>{});r(this,"getSendTransactionParams",async()=>{let e=this.formatContractPayload();return this.differentiatedEnvironment([{...e,extParams:this.extParams}])});r(this,"preExecution",async()=>({payload:this.formatContractPayload()}))}};r(fe,"chainId",B.TRON_MAINNET);var Rd={[de.chainId]:de,[Er.chainId]:Er,[me.chainId]:me,[le.chainId]:le,[Bs.chainId]:Bs,[fe.chainId]:fe,[pe.chainId]:pe,[he.chainId]:he,[Us.chainId]:Us},Od=a=>Rd[a]||Er,Nd=(a,t,e)=>{let{chainId:o}=a,s=Od(o);return new s(t,e,a)},vr=Nd;u();l();function Pd({selector:a}){let t=document.querySelector(a);t&&t.scrollTo({top:0,behavior:"smooth"})}var Ws=Pd;var $u=20,Jt={CONFIRM:"confirm",UPDATE:"update",FILL_UP:"fill_up",SNAP_UPDATE:"snap_update"},Vs=class{constructor(t){r(this,"quoteData",null);r(this,"preDataForSendBtc",null);r(this,"setPreDataForSendBtc",t=>{this.preDataForSendBtc=t});r(this,"setQuoteData",t=>{this.quoteData=t});r(this,"quoteParams",()=>{let{accountStore:t,fromToStore:e,receiveAddressStore:o}=this.rootStore,i={...ue(),userWalletAddress:t.address};return e.computedDiffCrossChain&&(i.receiveWalletAddress=o.receiveAddrObj?.specifiedAddress),i});r(this,"updating",!1);r(this,"updateQuoteData",async()=>{let{quoteStore:{quote:t}}=this.rootStore,e=ue();this.updating=!0;let[o,s]=await O(k.post(na,{...e,bridgeId:t?.bestRoute?.bridge?.bridgeId}));if(this.updating=!1,Ws({selector:"#wallet_scroll"}),o){P.error({title:o?.data?.msg||h("swaptrade_top_notif_data_failed")});return}let{callDataResult:i,quoteResult:n}=s?.data||{};if(n&&this.rootStore.quoteStore.handleUpdateQuote({data:n}),i){let c=await this.getPreExecutionPayload(i);at(()=>{this.transactionPayload=c})}this.initCountDown(),this.startCountdown()});r(this,"updateSnapQuoteData",async()=>{let t=ue();this.updating=!0;let[e,o]=await O(k.get(ma,{params:t}));if(this.updating=!1,Ws({selector:"#wallet_scroll"}),e){P.error({title:e?.data?.msg||h("swaptrade_trading_mode_error_no_update")});return}let{quote:s,quoteResult:i,tradingModeType:n,unsignedTx:c}=o?.data||{};i&&this.rootStore.quoteStore.handleUpdateQuote({data:i}),this.rootStore.intentSwapStore.setCallDataInfo({quote:s,tradingModeType:n,unsignedTx:c}),this.initCountDown(),this.startCountdown()});r(this,"timer",null);r(this,"countdown",$u);r(this,"initCountDown",()=>{this.countdown=$u});r(this,"startCountdown",()=>{this.timer=setTimeout(()=>{let t=this.countdown;if(t===0){this.clearTimer();return}this.countdown=t-1,this.startCountdown()},1e3)});r(this,"clearTimer",()=>{this.timer&&clearTimeout(this.timer)});r(this,"initGasInfo",()=>({gasType:"normal",gasLimit:"0",gasPrice:"0",maxFeePerGas:"0",maxPriorityFeePerGas:"0",supportEip1559:!1,isNetworkFeeLoading:!0,isGasLimitLoading:!0}));r(this,"gasInfo",this.initGasInfo());r(this,"setGasInfo",t=>{this.gasInfo=t});r(this,"gasFee",0);r(this,"setGasFee",t=>{this.gasFee=t});r(this,"orderInfo",{});r(this,"transactionPayload",null);r(this,"solonaRent","");r(this,"getPreExecutionPayload",async t=>{let{swapStore:e,quoteStore:o}=this.rootStore,s=o?.quote?.bestRoute||{},{fromToken:i}=s,n=vr(i,{orderData:t},e),{payload:c,rent:d}=await n.preExecution();return i.chainId===B.SOLANA_MAINNET&&d&&(this.solonaRent=d),c});r(this,"setTransactionPayload",t=>{this.transactionPayload=t});r(this,"fetchCallData",async()=>{let t=this.rootStore.swapStore.saveOrderParams(),[e,o]=await O(k.post(ia,t));if(e){let i=[90002,10009].includes(Number(e?.code))?e?.error_message:e?.data?.msg;return P.error({title:i||h("swaptrade_top_notif_data_failed")}),!0}let s=await this.getPreExecutionPayload(o?.data||{});return this.transactionPayload=s,!1});r(this,"nativeCoin",null);r(this,"setNativeCoin",t=>{this.nativeCoin={...t}});r(this,"calcNativeCoinAmount",()=>{let{coinAmountInt:t,decimals:e}=this.nativeCoin,{from:o,computedIsFromBtcCoin:s}=this.rootStore.fromToStore;return T.BigNumber(s?o.availableBalance:Fe(t,e))});r(this,"calcNativeCoinAmountChange",()=>{let t;if(this.type===rt.SWAP){let{fromToStore:o}=this.rootStore;t=o.from}else{let{fromToken:o,fromTokenAmount:s}=this.rootStore.facetStore.facetOrderDetail;t={...o,amount:s}}let e=T.BigNumber(this.gasFee).isNaN()?"0":this.gasFee;return t.isNativeToken?T.BigNumber(t.amount).plus(e):T.BigNumber(e)});r(this,"gasFeeLoading",!0);r(this,"setGasFeeLoading",t=>{this.gasFeeLoading=t});r(this,"gasLimitError",null);r(this,"setGasLimitError",t=>{this.gasLimitError=t});r(this,"activityId",null);r(this,"setActivityId",t=>{this.activityId=t});r(this,"type",rt.SWAP);r(this,"setSwapType",t=>{this.type=t});r(this,"reset",()=>{this.gasInfo=this.initGasInfo(),this.setGasFeeLoading(!1),this.nativeCoin=null,this.transactionPayload=null,this.gasFee=0,this.setGasLimitError(null),this.setStarknetRegisterStatus(""),this.setVisibleStarknetRegister(!1),this.setActivityId(null),this.setSwapType(rt.SWAP),this.clearTimer(),this.solonaRent=""});r(this,"starknetRegisterStatus","");r(this,"setStarknetRegisterStatus",t=>{this.starknetRegisterStatus=t});r(this,"visibleStarknetRegister",!1);r(this,"setVisibleStarknetRegister",t=>{this.visibleStarknetRegister=t});r(this,"onSwap",()=>{xe({...this.rootStore.swapStore.getSaveOrderMonitorData(),button_name:"confirm"}),this.rootStore.swapStore.onSwap()});r(this,"onRedeem",()=>{this.rootStore.facetStore.walletSendRedeem()});r(this,"onIntentSwap",()=>{this.rootStore.intentSwapStore.onIntentSwap()});r(this,"confirmSwapMap",{[rt.SWAP]:this.onSwap,[rt.REDEEM]:this.onRedeem,[rt.INTENT_SWAP]:this.onIntentSwap});r(this,"onConfirm",t=>{this.confirmSwapMap[t]?.()});r(this,"getBtnProps",t=>{let{fromToStore:e}=this.rootStore,{symbol:o,coinId:s,chainId:i}=this.nativeCoin||{};return{[Jt.CONFIRM]:{disabled:this.computedConfirmBtnDisabled,onClick:c=>{this.onConfirm(c)},text:h("swaptrade_card_swap_btn_confirm_swap"),loading:this.computedIsConfirming},[Jt.UPDATE]:{onClick:()=>{xe({...this.rootStore.swapStore.getSaveOrderMonitorData(),button_name:"update"}),this.updateQuoteData().catch(()=>{})},loading:this.updating,text:h("swaptrade_confirmswap_btn_update_price")},[Jt.SNAP_UPDATE]:{onClick:()=>{xe({...this.rootStore.swapStore.getSaveOrderMonitorData(),button_name:"update"}),this.updateSnapQuoteData().catch(()=>{})},loading:this.updating,text:h("swaptrade_confirmswap_btn_update_price")},[Jt.FILL_UP]:{onClick:()=>{Va({wallet_address:this.rootStore.accountStore.address,button_name:"fill_up"}),e.baseAddFunds({coinId:s,chainId:i,receiveOnly:!1})},text:h("swaptrade_dialog_btn_supplement",{token:o})}}[t]});F(this),this.rootStore=t}get computedFormatTime(){return Na(this.countdown)}get computedPriceUpdate(){return this.countdown===0}get computedIsSufficientGas(){if(!this.nativeCoin)return!0;let t=this.calcNativeCoinAmount(),e=this.calcNativeCoinAmountChange();return t.gte(e)}get computedSolonaNativeTokenSufficientRent(){let{quoteStore:t}=this.rootStore,e=t?.quote?.bestRoute||{},{fromToken:o}=e||{};if(o?.chainId!==B.SOLANA_MAINNET||!this.nativeCoin||!this.solonaRent)return!0;let s=this.calcNativeCoinAmount(),i=this.calcNativeCoinAmountChange();return s.gte(i.plus(this.solonaRent))}get walletSendParams(){let{toLocale:t,dispatch:e}=L;return!t||!e?null:{t,dispatch:e}}get computedIsIntentSwap(){return this.type===rt.INTENT_SWAP}get computedConfirmBtnDisabled(){let{RegisterLocalStatusEnum:t}=L.global,{computedIsStarknetChain:e,computedIsFromBtcCoin:o,computedIsEvmChain:s}=this.rootStore.fromToStore;if(this.computedIsIntentSwap)return!1;if(e&&this.starknetRegisterStatus!==t?.COMPLETED)return!0;let i=this.computedPriceUpdate||!this.computedIsSufficientGas||!this.computedSolonaNativeTokenSufficientRent||this.gasFeeLoading||this.gasLimitError;return o||!s?i:i||this.gasInfo?.isGasLimitLoading||this.gasInfo?.gasLimitInfo?.queryGasLimitErrorUseDefault}get computedIsConfirming(){let{swapStore:t,intentSwapStore:e}=this.rootStore;return this.computedIsIntentSwap?!!e.isConfirmLoading:t.isConfirmLoading}get computedBtnProps(){let t=Jt.CONFIRM;return!this.computedIsSufficientGas||!this.computedSolonaNativeTokenSufficientRent?t=Jt.FILL_UP:this.computedPriceUpdate&&(t=this.computedIsIntentSwap?Jt.SNAP_UPDATE:Jt.UPDATE),this.getBtnProps(t)}get computedMonitorGasType(){return this.gasInfo?.gasType?{network_fee_details:{gas_level:this.gasInfo?.gasType}}:{}}},br=Vs;u();l();u();l();D();u();l();var Yu=(a,t)=>a.filter(({networks:e})=>e.findIndex(s=>s.name===t)>-1),Xu=(a,t)=>a.filter(({account:e})=>e[t]),zu=({recentAddrData:a,addressBookData:t,walletListData:e,chainName:o})=>{let s=[];if(a.length>0){let i=a.map(({specifiedAddress:n,...c})=>({specifiedAddress:n,...c}));s.push({group:h("swaptrade_extension_wallet_address_recent_address"),list:i})}if(t.length>0){let i=t.map(n=>({...n,specifiedAddress:n.address}));s.push({group:h("swaptrade_extension_wallet_address_connected_wallets"),list:i})}if(e.length){let i=e.map(c=>({specifiedAddress:c.account[o],group:c.keyringName,name:c.walletName,walletId:c.walletId}));Object.entries(Aa(i,"group")).forEach(([c,d])=>{s.push({group:c,list:d})})}return s},ju=a=>String(_(a,"isLeveraged"))==="1",Ju=(a,t)=>{let e=[null,null];return ju(a)&&(e[0]=a),ju(t)&&(e[1]=t),e};var{BigNumber:H,sub:Dd,div:Fd}=T,go=class{constructor(t){r(this,"defaultToken",{amount:"",prevAmount:"",balance:"",logoURI:"",coinId:"",decimals:"",usdPrice:"",tokenName:"",baseCoinId:"",tokenSymbol:"",tokenLogoUrl:"",isNativeToken:0,tokenContractAddress:"",isSafeMoonToken:"",isHoneypot:"",buyTaxes:"0",sellTaxes:"0",reverseReceiveAmount:""});r(this,"from",{...this.defaultToken,amount:"1"});r(this,"to",this.defaultToken);r(this,"fromBalanceState",Z.BALANCE_NOT_SHOW);r(this,"toBalanceState",Z.BALANCE_NOT_SHOW);r(this,"fromBalanceRequestError",!1);r(this,"toBalanceRequestError",!1);r(this,"isBalanceLoading",!1);r(this,"visibleAddFunds",!1);r(this,"setFrom",t=>{this.from=t});r(this,"setTo",t=>{this.to=t});r(this,"maxDialogType",Ze.enough);r(this,"setMaxDialogType",t=>{this.maxDialogType=t});r(this,"checkMaxDialogTypeIsEnough",t=>Ze.enough===t);r(this,"typedValue","1");r(this,"fromMax",!1);r(this,"independentField",C.FROM);r(this,"singleTypedValue","1");r(this,"singleFromMax",!1);r(this,"advanceSetTypedValue",(t,e,o="")=>{(o||this.commonStore.currentTab)===y.SWAP?(this.singleTypedValue=t,this.singleFromMax=e):this.setTypeInput(t,e)});r(this,"needCrossChainDoubleConfirm",!1);r(this,"setNeedCrossChainDoubleConfirm",t=>{this.needCrossChainDoubleConfirm=t});r(this,"updateBtcFromBalance",async()=>this.computedIsFromBtcCoin?(await this.getTokenBalanceByAccount(C.FROM,M(this.from)),!this.fromBalanceRequestError):!this.fromBalanceRequestError);r(this,"onClickMax",async()=>{Ua({button_name:"max"});let{isNativeToken:t}=this.from;this.setField(C.FROM);let e="",o="";if(t===1){let[s,i]=await Promise.all([this.rootStore.quoteStore.fetchGasTokenFee(),this.updateBtcFromBalance()]);if(!i)return;let{balance:n,availableBalance:c}=this.from,d=(this.computedIsFromBtcCoin?c:n)||"0";if(s===-1)return;o=H(d).minus(s);let m=o.isNegative();this.setMaxDialogType(m?Ze.insufficient:Ze.enough),m&&this.setShowAddFund(!0),this.showMaxDialog(),this.setShowMaxIcon(!0),e=m?"":o.toString()}else e=this.from.balance;this.advanceSetTypedValue(e,!0)});r(this,"setTypeInput",(t,e)=>{this.typedValue=t,this.fromMax=!!e});r(this,"setField",t=>{this.independentField=t});r(this,"quoteUpdateFromTo",t=>{let{receiveAmount:e="",fromTokenPrice:o="",toTokenPrice:s="",payAmount:i="",inputToTokenPrice:n=""}=t||{};!this.computedIsExactIn&&e?(this.from.amount=i,this.to.amount=this.computedTypedValue,this.to.prevAmount=this.computedTypedValue,this.from.currentTime=new Date().getTime(),this.to.usdPrice=n):this.computedIsExactIn&&(this.from.amount=this.computedTypedValue,this.to.amount=e,this.from.prevAmount=this.computedTypedValue,this.to.currentTime=new Date().getTime(),this.to.usdPrice=s),this.to.reverseReceiveAmount=e,this.from.usdPrice=o});r(this,"checkAndGetTokenInfo",async({chainId:t,tokenContractAddress:e})=>{let[o,s]=await this.getTokenInfoAndBalance(t,e);return o?null:s.data});r(this,"getDexMultiDefaultTokenInfo",t=>{let{chainList:e}=this.commonStore,o=M(e).find(s=>Number(s.chainId)===Number(t??oo))||{};return{fromDexMultiTokenInfoVO:{...o.dexDefaultFromToTokenShowVO?.fromDexMultiTokenInfoVO,reserveGas:o.reserveGas},toDexMultiTokenInfoVO:o.dexDefaultFromToTokenShowVO?.toDexMultiTokenInfoVO||{}}});r(this,"addressReplaceSymbol",t=>{let{fromDexMultiTokenInfoVO:e}=this.getDexMultiDefaultTokenInfo(t.chainId),{tokenSymbol:o,isNativeToken:s}=e;return s&&this.commonStore.getTokenAddress(t)===this.commonStore.getTokenAddress(e)?o:t?.tokenContractAddress});r(this,"symbolReplaceAddress",t=>this.tokenReplaceMainToken(t).tokenContractAddress);r(this,"validTokens",{});r(this,"fetchTokenInfo",async t=>{if(t.tokenContractAddress){let e=await this.checkAndGetTokenInfo(t);if(e?.tokenContractAddress){let s={...e,balance:e.amountNum,amount:t.amount||""},i=`${e.chainId}_${this.commonStore.getTokenAddress(e)}`;return this.validTokens[i]=!0,s}let o=`${t.chainId}_${this.commonStore.getTokenAddress(t)}`;return this.validTokens[o]=t.tokenContractAddress==vn,null}return null});r(this,"checkQueryToken",async(t,e=!0)=>{if(!G(t.chainId))return null;let o=t;if(Ya(this.commonStore.chainList,Number(t.chainId))){let{from:i}=this.getInitializedValue(t.chainId);if(this.commonStore.getTokenAddress(t)===this.commonStore.getTokenAddress(i)&&e){let c=`${i?.chainId}_${this.commonStore.getTokenAddress(i)}`;return this.validTokens[c]=!0,i}let n=await this.fetchTokenInfo({chainId:Number(t.chainId),tokenContractAddress:t.tokenContractAddress});e?o=n||i:o=n}else o=null;return o});r(this,"updateFrom",t=>{(!this.commonStore.equalsToken(t,this.from)||this.from.balance!==t.balance)&&(this.setShowMaxIcon(!1),this.setShowAddFund(!1)),this.from={...M(this.from),...t}});r(this,"updateFromAmount",t=>{this.from.amount=t,t||(this.from.usdPrice="0"),this.from.prevAmount||(this.from.prevAmount=t)});r(this,"updateTo",t=>{this.to={...M(this.to),...t}});r(this,"hideMaxDialog",!!v.get(fs));r(this,"hideMaxDialogLessGas",!!v.get(Ss));r(this,"setStorageShowMaxDialog",t=>{if(t){let e=this.checkMaxDialogTypeIsEnough(this.maxDialogType);v.set(e?fs:Ss,"1"),e?this.hideMaxDialog=!0:this.hideMaxDialogLessGas=!0}this.visibleMaxDialog=!1});r(this,"visibleMaxDialog",!1);r(this,"showMaxDialog",()=>{let t=this.checkMaxDialogTypeIsEnough(this.maxDialogType);t&&this.hideMaxDialog||!t&&this.hideMaxDialogLessGas||(this.visibleMaxDialog=!0)});r(this,"showMaxIcon",!1);r(this,"setShowMaxIcon",t=>{this.showMaxIcon=t});r(this,"showAddFund",!1);r(this,"setShowAddFund",t=>{this.showAddFund=t});r(this,"setFromBalanceRequestError",t=>{this.fromBalanceRequestError=t});r(this,"setToBalanceRequestError",t=>{this.toBalanceRequestError=t});r(this,"onSwitchFromTo",async()=>{if(!this.isBalanceLoading){this.rootStore.quoteStore.isFirstQuote=!0,this.rootStore.quoteStore.quoteScope=null,this.setShowMaxIcon(!1),this.setShowAddFund(!1);let[t,e]=[M(this.from),M(this.to)];[this.fromBalanceRequestError,this.toBalanceRequestError]=[this.toBalanceRequestError,this.fromBalanceRequestError];let o={amount:this.computedTypedValue??"",prevAmount:this.computedTypedValue??"",usdPrice:""},s={amount:"",prevAmount:"",usdPrice:""};this.setNeedCrossChainDoubleConfirm(!0),this.setField(C.FROM),this.computedIsSingleChain?this.setFrom({...e,...o}):(this.rootStore.quoteStore.setQuoteNumber(this.computedTypedValue?0:2),this.setFrom({...e,amount:e.amount||"",prevAmount:e.amount||"",usdPrice:""})),this.setTo({...t,...s}),this.advanceSetTypedValue(e.amount),this.rootStore.receiveAddressStore.clearReceiveAddressValue()}});r(this,"getChainInfo",t=>{let{chainList:e}=this.commonStore;return M(e).find(s=>Number(s.chainId)===Number(t))||{}});r(this,"getInitializedValue",(t=oo)=>{let e=this.getChainInfo(t),{fromDexMultiTokenInfoVO:o,toDexMultiTokenInfoVO:s}=e?.dexDefaultFromToTokenShowVO||{fromDexMultiTokenInfoVO:{},toDexMultiTokenInfoVO:{}},i={...M(o),balance:"",reserveGas:e?.reserveGas},n={...M(s),balance:""};return{from:i,to:n}});r(this,"resetFromTo",async t=>{let{chainList:e,currentTab:o}=this.commonStore,s=o===y.BRIDGE;if(Number(t)!==Number(this.from.chainId)){let i=M(e).find(p=>Number(p.chainId)===Number(t)),{fromDexMultiTokenInfoVO:n,toDexMultiTokenInfoVO:c,toCrossDexMultiTokenInfoVO:d}=i?.dexDefaultFromToTokenShowVO||{fromDexMultiTokenInfoVO:{},toDexMultiTokenInfoVO:{}};this.from={...M(n),balance:"",reserveGas:i?.reserveGas};let m=s&&d||c;this.to={...M(m),balance:""}}});r(this,"clearFromTo",()=>{this.from={},this.to={}});r(this,"updateBalanceIfNativeToken",(t,e)=>{e.isNativeToken?this.getTokenBalanceByAccount(t,e,!1).catch(Ta):(this.setFromBalanceRequestError(!1),this.setBalance(t,e.amountNum))});r(this,"getSwapTokenBalance",(t=!1)=>{this.getTokenBalanceByAccount(C.FROM,M(this.from),t).catch(()=>{}),this.getTokenBalanceByAccount(C.TO,M(this.to),t).catch(()=>{})});r(this,"getTokenInfoAndBalance",async(t,e)=>{let o=this.accountStore.getAddressByChainId(t),s={chainId:t,tokenAddress:e,userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,userWalletAddress:o,businessType:this.commonStore.computedCurrentTabIsLimit?hs.LIMIT_ORDER:hs.SWAP_ORDER};return O(k.get(Hn,{params:s}))});r(this,"needBalanceLoading",!0);r(this,"setNeedBalanceLoading",t=>{this.needBalanceLoading=t});r(this,"getTokenBalanceByAccount",async(t,e,o)=>{let s=t===C.FROM,{chainId:i,tokenContractAddress:n}=e;if(G(i)&&n&&this.accountStore.computedAccountId){this.needBalanceLoading&&(this.isBalanceLoading=!0);let c=await this.getTokenInfoAndBalance(i,n);if(this.isBalanceLoading=!1,this.setNeedBalanceLoading(!0),!this.commonStore.equalsToken(e,s?this.from:this.to))return;if(c[0]){if(o){this.fromBalanceRequestError=!1,this.toBalanceRequestError=!1;return}s?(this.fromBalanceRequestError=!0,this.fromBalanceState=Z.BALANCE_REQUEST_FAILED):(this.toBalanceRequestError=!0,this.toBalanceState=Z.BALANCE_REQUEST_FAILED),this.setBalance(t,"0","0");return}s?this.fromBalanceRequestError=!1:this.toBalanceRequestError=!1;let{amountNum:d,availableAmountNum:m}=c[1]?.data;this.setBalance(t,d,m)}});r(this,"setBalance",(t,e="",o="")=>{let s=t===C.TO,i={balance:e,availableBalance:o};s?this.updateTo({...this.to,...i}):this.updateFrom({...this.from,...i})});r(this,"setBalanceState",t=>{let{amount:e,address:o,from:s,to:i}=t;Boolean(o)&&Boolean(s.tokenContractAddress)?this.fromBalanceRequestError===!0?this.fromBalanceState=Z.BALANCE_REQUEST_FAILED:H(s.balance||"0").lt(e||"0")?this.fromBalanceState=Z.BALANCE_INSUFFICIENT:this.fromBalanceState=Z.COMMON:this.fromBalanceState=Z.BALANCE_NOT_SHOW,!(Boolean(o)&&Boolean(i.tokenContractAddress))||!this.computedIsToAddressEqualsCurrentToAddress&&this.computedDiffCrossChain?this.toBalanceState=Z.BALANCE_NOT_SHOW:this.toBalanceRequestError===!0?this.toBalanceState=Z.BALANCE_REQUEST_FAILED:this.toBalanceState=Z.COMMON});r(this,"updateFromBalancePush",t=>{let{coinAmountOriginalDec:e,availableAmountNum:o}=t;this.commonStore.equalsToken(this.from,t)?this.setBalance(C.FROM,e,o):this.commonStore.equalsToken(this.to,t)&&this.setBalance(C.TO,e,o)});r(this,"tokenReplaceMainToken",t=>{let e=t,{fromDexMultiTokenInfoVO:o}=this.getDexMultiDefaultTokenInfo(t?.chainId),{tokenSymbol:s,chainId:i}=o;return G(t?.chainId)&&t?.tokenContractAddress&&(this.commonStore.getTokenAddress(t)===(this.commonStore.isSensitiveChain(i)?s:Pt(s))||this.commonStore.getTokenAddress(t)===this.commonStore.getTokenAddress(o))&&(e={...o,amount:t.amount}),e});r(this,"onClickAddFunds",()=>{let{tokenSymbol:t,chainName:e}=this.from,{address:o}=this.accountStore,s={currency:t,network:e,address:o};this.getDeposit(s)});r(this,"calOrderUpdateFromTo",t=>{let{fromTokenUsd:e,toTokenUsd:o,fromAmount:s,toAmount:i}=t||{};io(s)||(this.from.amount=s),io(e)||(this.from.usdPrice=e),io(i)||(this.to.amount=i),io(o)||(this.to.usdPrice=o)});r(this,"isEvmChain",t=>G(t)?this.commonStore.getChainByID(t)?.chainType!==gn.NO_EVM_CHAIN:!0);r(this,"isTronChain",t=>t===B.TRON_MAINNET);r(this,"getFormatFromToToken",async({from:t,to:e},o)=>{let[s,i]=await Promise.all([this.checkQueryToken(t,o),this.checkQueryToken(e,o)]),n=s,c=i,d=m=>`${m?.chainId}-${m?.tokenContractAddress}`;if(s){let m=this.getInitializedValue(s?.chainId),p=so(As([s,i,m.from,m.to],d));n=p[0],c=p[1]}else if(i){let m=this.getInitializedValue(i.chainId),p=so(As([i,m.from,m.to],d));n=p[1],c=p[0]}return{token1:n,token2:c}});r(this,"orderContinueStatus",X.DEFAULT);r(this,"setOrderContinueStatus",t=>{this.orderContinueStatus=t});r(this,"fillSwapFromTo",async({apiRequestParams:t,locationParams:e})=>{let{closeModal:o}=this.rootStore.recentTransactionStore;!await this.beforeCheckAndGetTokenInfo(t,e)||(o(),this.setSwapAndLimitTypeValue(e.inputAmount))});r(this,"beforeCheckAndGetTokenInfo",async(t,e)=>{let{orderCheckContinue:o}=this.rootStore.oneMoreOrderStore;if(this.setOrderContinueStatus(X.LOADING),t&&!await o(t))return this.setOrderContinueStatus(X.ERROR),!1;let{token1:s,token2:i}=await this.getFormatFromToToken(e,!1);return!s||!i?(P.error({title:h("swaptrade_history_toast_setup_error"),duration:At}),this.setOrderContinueStatus(X.ERROR),!1):(this.setOrderContinueStatus(X.READY),this.updateFromAndToInfo(s,i),!0)});r(this,"beforeCheckUrl",async t=>{this.setOrderContinueStatus(X.LOADING);let{orderCheckContinue:e}=this.rootStore.oneMoreOrderStore;return await e(t)?(this.setOrderContinueStatus(X.READY),!0):(this.setOrderContinueStatus(X.ERROR),!1)});r(this,"updateFromAndToInfo",(t,e)=>{this.updateFrom(t),this.updateTo(e)});this.rootStore=t,this.accountStore=t.accountStore,this.commonStore=t.commonStore}get computedTypedValue(){return this.commonStore.currentTab===y.SWAP?this.singleTypedValue:this.typedValue}get computedFromMax(){return this.commonStore.currentTab===y.SWAP?this.singleFromMax:this.fromMax}get computedNeedCrossChainDoubleConfirm(){return this.computedIsSingleChain?!1:!this.needCrossChainDoubleConfirm}get dependentField(){return this.independentField===C.FROM?C.TO:C.FROM}get computedIsExactIn(){return this.independentField===C.FROM}get computedIsSingleChain(){return G(this.from.chainId)&&G(this.to.chainId)&&Number(this.from.chainId)===Number(this.to?.chainId)}get computedSwapAmount(){return{[this.independentField]:this.computedFromMax?ro(this.computedTypedValue,{noNeedThousandth:!0}):this.computedTypedValue,[this.dependentField]:this.computedCalAmount[this.dependentField]}}get computedCalAmount(){return{[C.FROM]:ro(this.from?.amount,{noNeedThousandth:!0})??"",[C.TO]:ro(this.to?.amount,{noNeedThousandth:!0})??""}}get computedIfQuote(){return!!(this.computedTypedValueIsValid&&this.from&&this.to)}get computedTypedValueIsValid(){return!H(this.computedTypedValue).isZero()&&!H(this.computedTypedValue).isNaN()}get computedFromAmountIsValid(){let{amount:t}=this.from;return wt(t)}get computedFromLocalCostByUsd(){let{usdPrice:t}=this.from;if(!this.computedFromAmountIsValid)return"";let{nowCurrencyUnit:e}=this.commonStore,{symbol:o,usdToThisRate:s}=e,i=H(t);if(o&&t&&s&&!i.isNaN()){let c=i.multipliedBy(s).toString();return ot(c,o)}return""}get computedToLocalCostByUsd(){let{usdPrice:t}=this.to,{nowCurrencyUnit:e}=this.commonStore,{symbol:o,usdToThisRate:s}=e,i=H(t);if(o&&t&&s&&this.to.amount&&!i.isNaN()&&wt(this.from.amount)){let c=i.multipliedBy(s).toString();return ot(c,o)}return""}get computedRate(){let{from:t,to:e,computedIsExactIn:o}=this,{quoteStore:s,gasDropStore:i}=this.rootStore,n=_(s,"quote.bestRoute.gasDropFromAmount",""),c=n&&i?.gasDropConfig?.gasDrop?H(t?.amount).minus(n):H(t?.amount),d=e?.reverseReceiveAmount&&o||!o&&t?.amount;return c&&d?j(H(e?.reverseReceiveAmount).div(c).toString(10)):""}get computedToFromRate(){let{from:t,to:e,computedIsExactIn:o}=this,{quoteStore:s,gasDropStore:i}=this.rootStore,n=_(s,"quote.bestRoute.gasDropFromAmount",""),c=n&&i?.gasDropConfig?.gasDrop?H(t?.amount).minus(n):H(t?.amount),d=e?.reverseReceiveAmount&&o||!o&&t?.amount;return c&&d?j(H(c).div(e?.reverseReceiveAmount).toString(10)):""}get computedIsToAddressEqualsCurrentToAddress(){let t=this.accountStore.getAddressByChainId(this.to.chainId);return t&&this.rootStore.receiveAddressStore.computedReceiveAddr===t}get computedValueDifference(){let{tradeModeStore:t,quoteStore:e}=this.rootStore,{usdPrice:o}=this.from,{usdPrice:s,currentTime:i}=this.to,{computedIsSnapType:n}=t,c=_(e,"quote.bestRoute.gasDropFromAmount",""),d=_(e,"quote.bestRoute.fromTokenAmount",""),m=Gt(o),p=Cs(o),f=Gt(s),g=Cs(s);if(m||p||f||g)return{isUp:!1,diff:"",isOver:!1,nowTime:new Date().getTime()};let I=c?H(o).div(H(d))*H(c):"";o=c?o-I:o;let A=H(s).minus(o).div(o).multipliedBy(100),R=H(A.toFixed(2,1));if(R.gt(-.1)&&R.lt(.1))return null;let q=A.isNegative()?"":"+",K="";return A.gt(100)?K=`>${q}${vt(100,{needZero:!1})}`:A.lt(-100)?K=`<${q}${vt(100,{needZero:!1})}`:K=`${q}${vt(R.toString(10),{needZero:!1})}`,{isUp:n?!1:!A.lt(0),diff:K,isOver:n?!1:A.lte(-10),currentTime:i,specialValueRangePrompt:A.gt(-10)&&A.lt(10),value:`${H(A.toFixed(2,1)).toString(10).replace(/\+|-/,"")}`}}get computedMinimumReceived(){let{quoteStore:t}=this.rootStore,e=_(t,"quote.bestRoute.minimumReceived"),o=_(t,"quote.bestRoute.toToken.tokenSymbol","");return`${j(e)||"--"} ${o}`}get computedMinimumReceivedIsOrange(){let{quoteStore:t}=this.rootStore,e=H(_(t,"quote.bestRoute.minimumReceived")),o=H(this.to?.amount);return!o.isZero()&&!o.isNaN()&&Fd(Dd(o,e),o)>=.1}get computedIsCrossChain(){return G(this.from.chainId)&&G(this.to.chainId)&&Number(this.from.chainId)!==Number(this.to?.chainId)}get computedIsBridge(){let{from:t,to:e}=this;return this.computedIsCrossChain&&t.tokenSymbol===e.tokenSymbol}getDeposit(){}get computedDiffCrossChain(){let t=!!this.accountStore.address,e=this.commonStore.getChainByID(this.from.chainId),o=this.commonStore.getChainByID(this.to.chainId),s=String(this.from.isHoneypot),i=String(this.to.isHoneypot),{computedNonsupportChain:n}=this.accountStore,c=e?.crossChainType||"",d=o?.crossChainType||"";return t&&!n&&s!=="1"&&i!=="1"&&c&&d&&c!==d}get computedMaxTipsText(){let{from:t,maxDialogType:e}=this,{cacheNativeGasFee:o}=this.rootStore.quoteStore;if(!t.isNativeToken||!o||!t.tokenSymbol)return h("wallet_swap_toast_reserve_mainnet_token");let s={value:j(o),tokenSymbol:t.tokenSymbol};if(this.checkMaxDialogTypeIsEnough(e)){if(this.computedIsFromBtcCoin&&T.gt(this.computedUnavailableBalance,0)){let i=j(this.computedUnavailableBalance);return h("swaptrade_dialog_pay_card_reserved_from_wallet",{symbol:s.tokenSymbol,value:s.value,unablevalue:i})}return h("swaptrade_dialog_desc_reserved_netfee",s)}return h("swaptrade_dialog_desc_please_reserve",s)}get computedShowAddFund(){let{accountStore:t,swapBtnStore:e}=this.rootStore,{from:o}=this;return!t.computedNonsupportChain&&(this.independentField===C.FROM&&H(this.computedTypedValue||0).gt(H(o.balance||0))||e.computedTooBalance)||this.showAddFund&&!this.checkMaxDialogTypeIsEnough(this.maxDialogType)}get computedIsEvmChain(){return this.isEvmChain(this.from.chainId)}get computedDefaultAutoSlippageInfo(){let t=this.commonStore.getChainByID(this.from.chainId);return{autoSlippage:t?.toleranceSlippage?.selectItem,autoTotalSlippage:t?.crossToleranceSlippage?.selectItem}}get computedIsSolanaChain(){return uc(this.from.chainId)}get computedIsAptosChain(){return lc(this.from.chainId)}get computedIsTronChain(){return nr(this.from.chainId)}get computedIsSuiChain(){return nc(this.from.chainId)}get computedIsStacksChain(){return ac(this.from.chainId)}get computedIsStarknetChain(){return cc(this.from.chainId)}get computedHasToSwap(){let t=_(this.rootStore.quoteStore,"quote.bestRoute.toSwapFeeUsd");return this.computedIsCrossChain&&t>0}setSwapAndLimitTypeValue(t){let{computedCurrentTabIsLimit:e}=this.commonStore,{clearSellAndReceive:o}=this.rootStore?.limitOrderControlStore||{};e?o?.():wt(t)?(this.setField(C.FROM),this.advanceSetTypedValue(t)):this.advanceSetTypedValue("")}get computedLeverageTokenPair(){return Ju(this.from,this.to)}get computedFormToTokenIsLeverageToken(){let[t,e]=this.computedLeverageTokenPair;return!!t||!!e}get computedIsFromBtcChain(){return ic(this.from.chainId)}get computedIsFromBtcCoin(){return this.computedIsFromBtcChain&&this.from.isNativeToken}get computedUnavailableBalance(){return H(this.from.balance).minus(this.from.availableBalance).toString()}get computedIsFacetToken(){let{from:t,to:e}=this;return Number(t.tokenType)===Oe.FACET||Number(e.tokenType)===Oe.FACET}get computedNonsupportFacetToken(){let{address:t,walletConfig:{OKXWalletType:e,walletType:o}}=this.accountStore;if(!t)return!1;let s=[Wt.MNEMONIC,Wt.PRIVATE_KEY].includes(e),i=o===Ko.METAMASK;return this.computedIsFacetToken&&!(s||i)}};var Se=class extends go{constructor(e){super(e);r(this,"getDeposit",()=>()=>{});r(this,"addFundsParams",{});r(this,"closeAddFunds",()=>{this.visibleAddFunds=!1});r(this,"onClickAddFunds",()=>{let{tokenSymbol:e,chainName:o,tokenLogoUrl:s,chainId:i,isNativeToken:n,tokenContractAddress:c}=this.from;this.visibleAddFunds=!0;let d={currency:e,network:o,iconUrl:s,chainId:i,isNativeToken:n,tokenContractAddress:n?"":c,receiveOnly:!0};this.baseAddFunds(d)});r(this,"baseAddFunds",e=>{this.visibleAddFunds=!0,this.addFundsParams={...e}});r(this,"tokenReplaceMainToken",(e,o)=>{let s=e,i=!Ar(e),{fromDexMultiTokenInfoVO:n}=this.getDexMultiDefaultTokenInfo(i?o:e.chainId),{tokenSymbol:c,chainId:d}=n;return!i&&(this.commonStore.getTokenAddress(e)===(this.commonStore.isSensitiveChain(d)?c:Pt(c))||this.commonStore.getTokenAddress(e)===this.commonStore.getTokenAddress(n))&&(s={...n,amount:e.amount}),s});zt(this),Ct(()=>{let{computedDiffCrossChain:o,to:s}=this;return{computedDiffCrossChain:o,toChainId:s?.chainId}},({computedDiffCrossChain:o,toChainId:s})=>{this.cacheToChainId!==s&&this.rootStore.receiveAddressStore.saveReceiveAddressValue({}),this.rootStore.receiveAddressStore.setCacheToChainId(o&&s?s:-1)},{equals:xt.shallow})}};u();l();u();l();D();var qs=class{constructor(t){r(this,"callDataInfo",null);r(this,"setCallDataInfo",({quote:t,tradingModeType:e,unsignedTx:o})=>{this.callDataInfo={quote:t,tradingModeType:e,unsignedTx:o}});r(this,"signIntentSwap",async()=>[]);r(this,"createIntentOrder",async(t,e,o)=>{let s={intentCode:e,signature:o,quote:t,userWalletAddress:this.rootStore?.accountStore?.address},[i,n]=await O(k.post(pa,{...s}));return i&&(b.error(N.INTENT_ORDER_CREATE_ERROR,{error:i}),P.error({title:i?.error_message||h("swaptrade_trading_mode_alert_order_fail")})),[i,n]});this.rootStore=t}},Zu=qs;u();l();var tl=gt(["isConfirmLoading"],[]);var Gs=class extends Zu{constructor(e){super(e);r(this,"isConfirmLoading",!1);r(this,"setIsConfirmLoading",e=>{this.isConfirmLoading=e});r(this,"signIntentSwap",async(e,o)=>{let{signTransaction:s}=this.rootStore.sendTransactionStore,[i,n]=await s(e,o);return i&&(b.error(N.INTENT_SWAP_SIGN_ERROR,{error:i,msg:{chainId:e,unsignedTx:o}}),P.error({title:h("swaptrade_trading_mode_alert_order_fail")})),[i,n]});r(this,"onIntentSwap",async()=>{this.setIsConfirmLoading(!0),b.keepLive();let{swapStore:e,quoteStore:o}=this.rootStore,s=_(o,"quote.bestRoute.fromToken.chainId");try{let{quote:i,tradingModeType:n,unsignedTx:c}=this.callDataInfo||{},[d,m]=await this.signIntentSwap(s,c);if(d)return;let[p,f]=await this.createIntentOrder(i,n,m);if(p)return;e.afterTransaction(f.data?.orderId)}catch(i){b.error(N.INTENT_SWAP_PROCESS_ERROR,{error:i})}finally{this.setIsConfirmLoading(!1),b.removeKeep()}});ct(this,tl)}},Lr=Gs;u();l();D();u();l();D();var Hs=class{constructor(t){r(this,"receiveAddrStatus",Re.NORMAL);r(this,"receiveAddrObj",{});r(this,"saveReceiveAddressValue",t=>{this.receiveAddrObj=this.filterReceiveWalletInfo(t),t?.specifiedAddress||this.initCheckAddrStatus()});r(this,"clearReceiveAddressValue",()=>{this.receiveAddrObj={},this.initCheckAddrStatus(),this.walletAddrInWeb3=[],this.getLinkedWalletAddrInWeb3().catch(()=>{})});r(this,"checkReceiveAddressLoading",!1);r(this,"filterReceiveAddress",(t,e,o=!0)=>{let s=e?.specifiedAddress||this.receiveAddrObj?.specifiedAddress||"";return s?t.filter(({specifiedAddress:i})=>o?i.includes(s):i===s):t});r(this,"filterReceiveWalletInfo",t=>{if(!t.specifiedAddress||t.walletId)return t;let e=this.filterReceiveAddress(this.initWalletAddrListFromChain,t,!1);return e.length?e[0]:t});r(this,"initCheckAddrStatus",()=>{this.checkReceiveAddressLoading=!1,this.receiveAddrStatus=Re.NORMAL});r(this,"checkReceiveAddr",async t=>{if(t||this.receiveAddrObj.specifiedAddress){this.checkReceiveAddressLoading=!0;let{to:e}=this.rootStore.fromToStore;try{let o=await oc(e?.chainId,t||this.computedReceiveAddr),s=Symbol("requestId");if(this.currentRequestId=s,o){let{data:i}=await k.get(ra,{params:{address:t||this.receiveAddrObj.specifiedAddress,chainId:e?.chainId}});this.currentRequestId===s&&at(()=>{this.receiveAddrStatus=i.status})}else at(()=>{this.receiveAddrStatus=Re.ILLEGALITY})}catch(o){b.stuff(o),this.receiveAddrStatus=Re.ILLEGALITY}finally{this.checkReceiveAddressLoading=!1}}else this.initCheckAddrStatus()});r(this,"getSpecifiedChainWalletList",async t=>{let e=await this.getSpecifiedChainWalletListByWeb3(t),o={};return e?.forEach(s=>{let{specifiedAddress:i,walletType:n,createTime:c}=s,d=n===Ko.OKEXCHAIN;o[i]&&o[i]?.has&&d?o[i].walletInfo.createTime<c&&(o[i].walletInfo=s):(!o[i]?.has||d)&&(o[i]={walletInfo:s,has:d})}),Object.keys(o).map(s=>o[s].walletInfo)});r(this,"walletAddrInWeb3",[]);r(this,"getLinkedWalletAddrInWeb3",async()=>{let{computedDiffCrossChain:t,to:e}=this.rootStore.fromToStore,{computedAccountId:o}=this.rootStore.accountStore;if(!t)return;let[s,i]=await O(this.getSpecifiedChainWalletList({chainId:e.chainId,walletIds:[o]}));s||at(()=>{this.walletAddrInWeb3=i})});r(this,"initWalletAddrListFromChain",[]);r(this,"initWalletAddrListInStorage",[]);r(this,"filterWalletAddrListFromChain",[]);r(this,"filterWalletAddrListInStorage",[]);r(this,"getWalletList",async()=>{let{to:t}=this.rootStore.fromToStore,e=await this.getSpecifiedChainWalletList({chainId:t.chainId});at(()=>{this.initWalletAddrListFromChain=e,this.filterWalletAddrListFromChain=e;let o=v.get(to);if(o){let s=o[t.chainId]||[];this.initWalletAddrListInStorage=s,this.filterWalletAddrListInStorage=s}})});r(this,"getFilteredAddrList",t=>{this.filterWalletAddrListFromChain=this.filterReceiveAddress(this.initWalletAddrListFromChain,t),this.filterWalletAddrListInStorage=this.filterReceiveAddress(this.initWalletAddrListInStorage,t)});r(this,"saveWalletAddressToStorage",t=>{this.receiveAddrObj?.specifiedAddress&&v.set(to,{[t.chainId]:[this.receiveAddrObj]})});r(this,"formatInputValue",t=>{let{specifiedAddress:e,deriveName:o,label:s}=t;if(e.length<=9)return e;let i=sr(t.specifiedAddress);return o&&(i=`(${i})`,s?i=`${o} - ${s} ${i}`:i=`${o} ${i}`),i});this.rootStore=t}get computedSwapHighLight(){return this.receiveAddrStatus===Re.NORMAL&&!!this.receiveAddrObj?.specifiedAddress}get computedFormatReceiveAddr(){return this.receiveAddrObj?.specifiedAddress?this.formatInputValue(this.receiveAddrObj):""}get computedReceiveAddr(){return this.receiveAddrObj?.specifiedAddress||""}setReceiveAddress(t){this.receiveAddress=t}getReceiveAddress(){return this.receiveAddress}getSpecifiedChainWalletListByWeb3(){}get computedWalletAddrInWeb3(){return this.walletAddrInWeb3.length?this.walletAddrInWeb3[0]:null}get isFromFilterAddress(){let t=this.filterReceiveAddress(this.initWalletAddrListFromChain,this.receiveAddrObj?.specifiedAddress,!1),e=this.filterReceiveAddress(this.initWalletAddrListInStorage,this.receiveAddrObj?.specifiedAddress,!1);return!!(t.length+e.length)&&!!this.receiveAddrObj?.specifiedAddress}},el=Hs;var Qs=class extends el{constructor(e){super(e);r(this,"formatInputValueEx",(e,o)=>{let{keyringName:s,walletName:i}=e;if(o.length<=9)return o;let n=sr(o);return s&&(n=`(${n})`,i?n=`${s} - ${i} ${n}`:n=`${s} ${n}`),n});r(this,"cacheToChainId",-1);r(this,"setCacheToChainId",e=>{this.cacheToChainId=e});r(this,"addressListEx",[]);r(this,"getWalletListEx",()=>{let{accountStore:e,fromToStore:o}=this.rootStore,s=L.getNetWorkName(o.to.chainId),{walletList:i,addressBookList:n,keyringIdentityTypeEnum:c}=e,m=(v.get(to)||{})[o.to.chainId]||[],p=Yu(n,s),f=Xu(i,s);this.addressListEx=zu({recentAddrData:m,addressBookData:p,walletListData:f,chainName:s,keyringIdentityTypeEnum:c})});zt(this)}get computedFormatReceiveAddrEx(){let{accountStore:e,fromToStore:o}=this.rootStore,{walletConfig:s}=e;if(this.receiveAddrObj.specifiedAddress)return this.formatInputValueEx(this.receiveAddrObj,this.receiveAddrObj.specifiedAddress);let i=L.getNetWorkName(o.to.chainId),n=s?.account[i];return n?(this.receiveAddrObj={...s,specifiedAddress:n},this.formatInputValueEx(s,n)):""}},Rr=Qs;u();l();D();u();l();var Ks=class{constructor(t){r(this,"updateTxHash",t=>(b.info(N.UPDATE_HASH,{...t,tags:{orderId:t.orderId,status:t?.status||1}}),k.post(Bn,t).catch(e=>{b.info(N.UPDATE_HASH_ERROR,{...t,error:e,tags:{orderId:t.orderId}})})));r(this,"cancelOrder",t=>(b.info(N.CANCEL_ORDER,{tags:{orderId:t}}),k.get(ca,{params:{id:t}})));this.rootStore=t}},ol=Ks;var $s=class extends ol{constructor(){super(...arguments);r(this,"sendTransaction",async(...e)=>L.global?.signAndSubmitTransaction(...e));r(this,"sendTransactionEnhance",async(...e)=>this.sendTransaction(...e));r(this,"signTransaction",async(e,o)=>{let[s,i]=await O(L.global.signTypedDataV4(e,o));return[s,i]})}},Or=$s;u();l();u();l();D();u();l();D();var js=class{constructor(t){r(this,"rootStore");this.rootStore=t}checkZeroValue(){let t=null,o=this.rootStore.quoteStore.quote.bestRoute,{fromTokenPrice:s,toTokenPrice:i,fromToken:n,toToken:c}=o;return!Number(s)&&!Number(i)?t=n.tokenSymbol===c.tokenSymbol?$.ALIKE_TOKEN_SYMBOL_PRICE_UNKNOWN:$.ALL_TOKEN_PRICE_UNKNOWN:Number(s)?Number(i)||(t=$.TO_TOKEN_PRICE_UNKNOWN):t=$.FROM_TOKEN_PRICE_UNKNOWN,{errorType:t,continueToNextInterceptor:!1}}checkValueDifference(){let t=null,{fromToStore:e,tradeModeStore:o}=this.rootStore,{computedValueDifference:s,computedIsCrossChain:i}=e,{computedIsSnapType:n}=o;return n?null:(s?.isOver&&(t=i?$.VALUE_DIFFERENCE_TOO_MUCH_CROSS:$.VALUE_DIFFERENCE_TOO_MUCH),{errorType:t,continueToNextInterceptor:!1})}checkMinReceive(){let t=null,e=this.rootStore.fromToStore,{computedIsSnapType:o}=this.rootStore.tradeModeStore;return o?null:(e.computedMinimumReceivedIsOrange&&(t=$.MIN_RECEIVED_TOO_SMALL),{errorType:t,continueToNextInterceptor:!1})}checkRepeatOrderWithEnoughBalance(){let t=null,{swapCheckStore:e}=this.rootStore,{repeatOrder:o}=e;return o?.enoughFlag===as.ENOUGH&&(t=$.REPEAT_ORDER),{errorType:t,continueToNextInterceptor:!1}}async checkBlockedRepeatOrder(){let t=null,{swapCheckStore:e}=this.rootStore;await e.checkRepeatOrder();let{repeatOrder:o}=e;return o&&(o.repeatFlag===re.BTC_REPEAT?t=$.REPEAT_ORDER_BTC:o.repeatFlag===re.FACET_REPEAT?t=$.REPEAT_ORDER_FACET:o.enoughFlag!==as.ENOUGH&&(t=$.REPEAT_ORDER_NOT_ENOUGH)),{errorType:t,continueToNextInterceptor:!1}}checkFacetTokenCrossChainDetail(){let{fromToStore:t}=this.rootStore,{from:e,to:o,computedNonsupportFacetToken:s}=t;if(s||v.get(kn))return null;let i=null;return e.tokenType!==o.tokenType&&(Number(e.tokenType)===Oe.FACET||Number(o.tokenType)===Oe.FACET)&&(i=$.FACET_SWAP_TIPS),{errorType:i,continueToNextInterceptor:!1}}checkCrossChain(){let t=null;return this.rootStore.fromToStore.computedNeedCrossChainDoubleConfirm&&!v.get(Cn)&&(t=$.CROSS_CHAIN_DOUBLE_CONFIRM),{errorType:t,continueToNextInterceptor:!1}}checkGasMoreThanReceive(){let t=null,{fromToStore:e,quoteStore:o}=this.rootStore,{computedIsCrossChain:s}=e,i=o.quote.bestRoute,{toTokenPrice:n,quoteNetWorkFeeOfMoney:c,fromSwapFeeUsd:d}=i,{BigNumber:m}=T;return(s?new m(d):new m(c)).gte(new m(n))&&(t=$.GAS_MORE_THAN_RECEIVE_VALUE),{errorType:t,continueToNextInterceptor:!1}}checkToSwapThanGasFee(){let t=null,{fromToStore:e,quoteStore:o}=this.rootStore,{computedHasToSwap:s}=e,i=Number(e.to.chainId)===1;if(s&&i){let n=_(o,"quote.bestRoute.toSwapFeeUsd"),c=_(o,"quote.bestRoute.bridge.bridgeAmountOutUsd"),d=_(o,"quote.bestRoute.bridge.toRiskLimit");T.BigNumber(n).dividedBy(c).gte(d)&&(t=$.TO_SWAP_THAN_GAS_FEE)}return{errorType:t,continueToNextInterceptor:!1}}checkVolatilitySlippage(){let t=null,o=this.rootStore.slippageStore.computedVolatilityTips?.swapInterceptorType;return o&&(t=o),{errorType:t,continueToNextInterceptor:!0}}async checkBtcBalance(){let{fromToStore:t,safeMoonStore:e}=this.rootStore,{computedIsFromBtcCoin:o,from:s,updateBtcFromBalance:i}=t;if(o){if(!await i())throw Error("btc balance update failed");let c=e.computedInputVal,d=s.availableBalance;if(T.BigNumber(c).gt(d))return{errorType:$.BTC_AVAILABLE_BALANCE_NOT_ENOUGH,continueToNextInterceptor:!1}}return null}async checkCrossChainSwap(){let{swapCheckStore:t}=this.rootStore;await t.checkCrossChainSwap();let e=t.checkSwapMoreInfo?.errorCode;return Ea(e)&&e!==0?e===4&&v.get(`${ns}_${t.checkSwapMoreInfo?.contentTip?.extra?.bridgeName}_${e}`)||v.get(`${ns}_${e}`)?null:{errorType:$.CHECK_CROSS_MORE,continueToNextInterceptor:!1}:null}makeCheckers(){let{fromToStore:{computedIsCrossChain:t}}=this.rootStore;return t?[this.checkVolatilitySlippage,this.checkCrossChainSwap,this.checkBtcBalance,this.checkZeroValue,this.checkToSwapThanGasFee,this.checkValueDifference,this.checkMinReceive,this.checkCrossChain,this.checkGasMoreThanReceive]:[this.checkVolatilitySlippage,this.checkBlockedRepeatOrder,this.checkFacetTokenCrossChainDetail,this.checkZeroValue,this.checkRepeatOrderWithEnoughBalance,this.checkValueDifference,this.checkMinReceive,this.checkGasMoreThanReceive]}async check(){let t=[],e=this.makeCheckers();for(let o=0;o<e.length;o++){let s=e[o],{errorType:i,continueToNextInterceptor:n}=await s.call(this)||{};if(i&&(t.push(i),!n))return t}return t}},rl=js;var To=class{constructor(t){r(this,"swapBtnErrorTipsDialog",null);r(this,"swapInterceptor");r(this,"isInterceptionProcessing",!1);r(this,"defaultTipsDialogInfo",()=>({type:"",visible:!1,confirmCallBack:()=>{}}));r(this,"notShowAgainCrossChainConfirm",!1);r(this,"setNotShowAgainCrossChainConfirm",t=>{this.notShowAgainCrossChainConfirm=t});r(this,"tipsDialogInfo",this.defaultTipsDialogInfo());r(this,"swapBtnLoading",!1);r(this,"showErrorTips",(t,e)=>{this.tipsDialogInfo={type:t,visible:!0,confirmCallBack:e},this.setNotShowAgainCrossChainConfirm(!1)});r(this,"closeErrorTipsDialog",()=>{this.swapBtnLoading=!1,this.tipsDialogInfo.visible=!1});r(this,"openConfirmSwapDialog",(t,e)=>{let{swapStore:o,commonStore:s}=this,{receiveAddressStore:i}=this.rootStore;i.saveWalletAddressToStorage(e),o.setConfirmSwapVisible(!0),s.portal===_t.MARKET&&Ga({token_symbol:e.tokenSymbol,token_chain:e.chainId,token_address:e.tokenContractAddress})});r(this,"connectWallet",()=>{});r(this,"approve",()=>{});r(this,"cancelApprove",()=>{});r(this,"swap",()=>{});r(this,"clickSwapOnDapp",()=>{let{from:t,to:e,computedIsSingleChain:o}=this.fromToStore,{portal:s,computedNotThirdBiz:i}=this.commonStore;rr({business_type:o?"swap":"bridge",trade_dialog:i?"no":"yes",source:s,from_token_address:t.tokenContractAddress,to_token_address:e.tokenContractAddress,swap_type:o?"discover_swap":"discover_cross_chain_swap",from_chain:t.chainName,to_chain:e.chainName}),this.rootStore.swapDappStore?.fetchDappList()});r(this,"checkDappTrade",()=>{let t=this.rootStore.swapDappStore?.checkShouldJumpToDapp;return typeof t=="function"&&t()?Je:null});r(this,"isQuoting",()=>{let{fromToStore:t,quoteStore:e,slippageStore:o}=this.rootStore,{isFetchQuoting:s,bestRoute:i,quoteError:n,quoteNull:c}=e.quote,{from:d,to:m,computedTypedValue:p}=t,{tokenContractAddress:f}=d,{computedRealSlippageValue:g}=o;return c||!i&&n&&!s||!p||!m.tokenContractAddress||!f||g>50||g<0?ut:null});r(this,"isHoneypot",()=>this.rootStore?.safeMoonStore?.computedHoneypot?ut:null);r(this,"noAmountOrOverLimit",()=>{let{fromToStore:t}=this,{overLimit:e}=this.rootStore?.safeMoonStore?.computedSlippageTips||{},{computedTypedValue:o}=t;return Number(o)===0||e?ut:null});r(this,"hasFeeConfigErrorTips",()=>this.outerStore.computedFeeConfigErrorTips?ut:null);r(this,"uninitializedWalletInfo",()=>{let{accountStore:{hasInitWalletInfo:t}}=this;return t?null:ut});r(this,"unConnectedWallet",()=>{let{accountStore:{isConnectedWallet:t}}=this;return t?null:je});r(this,"nonsupportChain",()=>{let{accountStore:{computedNonsupportChain:t}}=this;return t?ut:null});r(this,"nonsupportFacetToken",()=>{let{fromToStore:{computedNonsupportFacetToken:t}}=this;return t?ut:null});r(this,"checkReceiveAddressStatus",()=>{let{fromToStore:{computedDiffCrossChain:t}}=this,{receiveAddressStore:{checkReceiveAddressLoading:e,computedSwapHighLight:o}}=this.rootStore;return t&&!o||e?ut:null});r(this,"interceptionProcessing",()=>{let{fromToStore:t}=this;return!this.isInterceptionProcessing&&t.isBalanceLoading||t.fromBalanceState===Z.BALANCE_REQUEST_FAILED?ut:null});r(this,"balanceLessThenInputAmount",()=>this.computedTooBalance?Ye:null);r(this,"approveStatus",()=>{let{approveStore:{computedApprovalStatus:t}}=this;return An[t]||null});r(this,"isValidAmount",()=>{let{fromToStore:t}=this,{from:e,to:o}=t;return o.amount&&e.amount?ze:null});r(this,"getBtnStatus",()=>{let t=[this.hasFeeConfigErrorTips,this.unConnectedWallet,this.nonsupportChain,this.nonsupportFacetToken,this.isHoneypot,this.checkDappTrade,this.checkReceiveAddressStatus,this.noAmountOrOverLimit,this.interceptionProcessing,this.balanceLessThenInputAmount,this.isQuoting,this.approveStatus,this.isValidAmount],e;for(let o of t){let s=o();if(s){e=s;break}}return e||(e=ut),e});r(this,"checkIsCurrentQuote",()=>(this.computedIsCurrentQuote||P.warn({title:h("swaptrade_mid_toast_tryagain_with_newquote")}),this.computedIsCurrentQuote));let{accountStore:e,fromToStore:o,swapStore:s,commonStore:i,quoteStore:n,approveStore:c,tradeModeStore:d}=t;this.rootStore=t,this.accountStore=e,this.fromToStore=o,this.swapStore=s,this.commonStore=i,this.quoteStore=n,this.approveStore=c,this.tradeModeStore=d,this.swapInterceptor=new rl(t),Object.assign(this,t)}async runSwapInterceptor(t){this.isInterceptionProcessing=!0;let[e,o]=await O(this.swapInterceptor.check());if(this.isInterceptionProcessing=!1,e){b.error(N.UPDATE_BTC_BALANCE_ERROR_BEFORE_SWAP,{error:e});return}if(o.length===0){t();return}let s=-1,i=()=>{s++;let n=s===o.length-1;this.showErrorTips(o[s],n?t:i)};i()}getBtnAllStatus({from:t,computedIsSingleChain:e}){return{[je]:{statusType:je,disabled:!1,toLocaleText:()=>h(je),onClick:this.connectWallet},[Ye]:{statusType:Ye,disabled:!0,toLocaleText:()=>h(Ye,{tokenSymbol:U(t.tokenSymbol)}),symbol:t.tokenSymbol},[Uo]:{statusType:Uo,disabled:!1,toLocaleText:()=>h(Uo,{tokenSymbol:U(t.tokenSymbol)}),onClick:this.approve,icon:"okx-defi-dex-authorization",iconType:Ro.ICON_POSITION.leading},[Xe]:{statusType:Xe,loading:!0,disabled:!0,toLocaleText:()=>h(Xe)},[ss]:{statusType:Xe,disabled:!1,toLocaleText:()=>h(ss,{ccy:t.tokenSymbol}),onClick:this.cancelApprove,icon:"okx-defi-dex-authorization",iconType:Ro.ICON_POSITION.leading},[Wo]:{statusType:Wo,loading:!0,disabled:!0,toLocaleText:()=>h(Wo)},[ut]:{statusType:ut,disabled:!0,toLocaleText:()=>h(e?ut:is)},[ze]:{statusType:ze,disabled:!1,loading:this.swapBtnLoading,toLocaleText:()=>h(e?ze:is),onClick:this.swap},[Je]:{statusType:Je,disabled:!1,loading:this.rootStore.swapDappStore?.swapOnDappBtnLoading,toLocaleText:()=>h(Je),icon:"okds-open-link",iconType:Ro.ICON_POSITION.leading,onClick:this.clickSwapOnDapp}}}get needToCrossChainDoubleCheck(){return!0}get computedTooBalance(){let{rootStore:t,fromToStore:e,accountStore:o}=this,{isConnectedWallet:s}=o,i=e.from.balance,n=t.safeMoonStore.computedInputVal;return s?T.BigNumber(i||0).isLessThan(n):!1}get computedBtnStatus(){let{fromToStore:t}=this,e=this.getBtnStatus();return this.getBtnAllStatus(t)[e]}get computedIsCurrentQuote(){let{fromToStore:t,quoteStore:e}=this,{computedIsExactIn:o,computedTypedValue:s}=t,{quote:i,getGasTokenFeeLoading:n}=e,{fromTokenAmount:c="",inputToTokenAmount:d=""}=i?.bestRoute||{},m=!!s,p=m&&o&&T.BigNumber(s).isEqualTo(c),f=m&&!o&&T.BigNumber(s).isEqualTo(d);return!n&&(p||f)}};u();l();var sl=gt(["tipsDialogInfo","notShowAgainCrossChainConfirm","isInterceptionProcessing","swapBtnLoading"],["computedTooBalance","computedBtnStatus","computedIsCurrentQuote"]);var ge=class extends To{constructor(e){super(e);r(this,"handleSwap",async()=>{let{quote:e,computedIsDexQuote:o}=this.quoteStore,{receiveAddressStore:s}=this.rootStore;if(this.swapBtnLoading=!0,this.walletContractStore.setQuoteData(e.bestRoute),o){let n=await this.walletContractStore.fetchCallData();if(this.swapBtnLoading=!1,n)return}this.swapBtnLoading=!1;let i=o?rt.SWAP:rt.INTENT_SWAP;s.saveWalletAddressToStorage(this.fromToStore?.to),L.history?.push({pathname:It,search:`needUpdate=${qo.on}&type=${i}`})});r(this,"swap",async()=>{let e=this.checkIsCurrentQuote();rr({wallet_address:this.accountStore.address,button_name:"confirm",...this.quoteStore.computedMonitorSwapSaveOrderParams}),e&&(this.swapBtnLoading=!0,this.runSwapInterceptor(this.handleSwap))});r(this,"approve",async()=>{let{accountStore:e}=this;this.approveStore.updateCurrentApproveTokenConfig({status:x.Approving});let o=await L.checkMpcAccountIfNecessary();if(ks({wallet_address:e.address}),!o){this.approveStore.updateCurrentApproveTokenConfig({status:x.UnApproved});return}this.approveStore.setApprove()});r(this,"cancelApprove",async()=>{let{accountStore:e}=this;this.approveStore.updateCurrentApproveTokenConfig({status:x.CancelApproving});let o=await L.checkMpcAccountIfNecessary();if(ks({wallet_address:e.address}),!o){this.approveStore.updateCurrentApproveTokenConfig({status:x.CancelApprove});return}this.approveStore.setApprove(be.CANCEL_APPROVE)});this.walletContractStore=e.walletContractStore,ct(this,sl)}};u();l();u();l();D();u();l();u();l();var il=function(){return new Promise(function(t){setTimeout(t,1)})};u();l();var Ue=E(V());u();l();var xd=/\s/,nl=a=>!(!_a(a)||xd.test(a)||a.length<10);u();l();u();l();var Zt={AUTO:1,CUSTOM:2,DEFAULT:3};var Wd=T.mul(.5,100),Vd=T.mul(.1,100),Ys=a=>{let t=_(a,"quoteStore.quote.bestRoute.autoSlippageInfo",{}),{computedDefaultAutoSlippageInfo:e}=a.fromToStore;return{...e,...t}},Co=({isSingleChain:a,autoSlippageInfo:t})=>{let{autoSlippage:e,autoTotalSlippage:o}=t||{};return a?e||.01:o||.03},Pr=a=>{let t=a.fromToStore.computedIsSingleChain,e=Ys(a),o=Co({isSingleChain:t,autoSlippageInfo:e});return T.mul(T.ceilTruncate(o,3,!1),100)},qd=a=>{let t=Ht(a);if(t.indexOf(".")>-1){let e=t.split("."),o=e[0],s=e[1];s&&s.length>1&&(s=s.slice(0,1)),t=`${o}.${s}`}return z(t)},Dr=({inputSlippageParams:a,computedSafeMoonTips:t,minSlippageShow:e,maxSlippageShow:o=Wd,autoSlippageValue:s=0,isSingleChain:i=!0})=>{let{safeMoonSlippage:n=0,overLimit:c,equalLimit:d}=t||{};if(a===""&&!t)return{slippage:0,inputValue:"",notice:"",isError:!1};let m=qd(a),p="",f=!1,g=!1;return t?.safeMoonSlippage?c||d||T.BigNumber(m).isZero()?p="":e>m?(p=h("swaptrade_settings_errortip_minimum_slippage",{cross:vt(e,{needZero:!1})}),f=!0,m=n):n>m?(p=h("swaptrade_settings_errortip_lowslippage_failed",{auto:vt(n,{needZero:!1})}),g=!0):m>o&&(p=h("swaptrade_card_swap_advance_options_exceeding_desc",{num:vt(o,{needZero:!1})}),f=!0,m=n):ie(m)?(m="",f=!0):m<e?(p=h(i?"swaptrade_dialog_modal_singlechain_limit":"swaptrade_dialog_modal_crosschain_limit",{value:T.thousandFormat(e)}),f=!0):m<s?(p=h("swaptrade_dialog_modal_transaction_failure"),f=!1):m>=Vd&&m<=o?(p=h("swaptrade_adjustslip_modalhint_actual_amount_less",{value:vt(m,{needZero:!1})}),f=!1):m>o&&(m=o,p=h("swaptrade_card_swap_advance_options_exceeding_desc",{num:vt(o,{needZero:!1})}),f=!0),{slippage:m,inputValue:a!==""?Ht(m):"",notice:p,isError:f,isWarning:g}},al=({slippageInfo:a,isSingleChain:t})=>{let{autoSlippageInfo:e,customSlippage:o}=a,s={};return t?o||(s=no(e,["autoSlippage"])):s=no(e,["autoFromSlippage","autoToSlippage","autoTotalSlippage"]),Object.keys(s).forEach(n=>{let c=s[n],d=T.ceilTruncate(c,3,!1);s[n]=T.toPlainString(Number(d))}),{customSlippage:o,autoSlippageInfo:s}};var Io=class{constructor(t){r(this,"defaultGasFee","--");r(this,"isWalletConfirm",!1);r(this,"setWalletConfirm",t=>{this.isWalletConfirm=t});r(this,"isConfirmLoading",!1);r(this,"txInfo",{});r(this,"resetTxInfo",()=>{this.txInfo={}});r(this,"showRecentTransactionModal",t=>{this.confirmSwapVisible=!1,this.rootStore.recentTransactionStore.showModal(t)});r(this,"saveOrderParamsExtendSlippageAndGasPrice",t=>{let e={...t},{computedQuote:o,fromToStore:s}=this,{computedIsSingleChain:i,computedDefaultAutoSlippageInfo:n}=s,{autoSlippageInfo:c}=o.bestRoute||{},d=Co({isSingleChain:i,autoSlippageInfo:n}),m={autoSlippageInfo:c||{}},p=_(this,"rootStore.slippageStore");return p&&(d=p.computedRealSlippageValue,m=p.getOrderSlippageInfo()),Object.assign(e,{slippage:String(d),...al({slippageInfo:m,isSingleChain:i})})});r(this,"baseSaveOrderParams",()=>{let{accountStore:t,computedQuote:e,fromToStore:o,quoteStore:s,gasDropStore:i}=this,{from:n,to:c}=o,{estimateGasFee:d,minimumReceived:m,gasDropAmount:p}=e.bestRoute||{},{computedIsMevOpen:f}=this.rootStore.mevStore,g={chainId:n.chainId,fromAmount:T.BigNumber(s?.computedQuoteAmount).toString(10),fromTokenAddress:n.tokenContractAddress,fromTokenDecimal:String(n.decimals),toAmount:c.reverseReceiveAmount,toTokenAddress:c.tokenContractAddress,toTokenDecimal:String(c.decimals),userWalletAddress:t.address,estimateGasFee:d,pmm:"1",gasDropType:i?.computedGasDropSelected?1:0,gasDropAmount:p,minimumReceived:m,openMev:f,toChainId:c.chainId},I=this.rootStore.outerStore.extendFeeConfig(g);return this.saveOrderParamsExtendSlippageAndGasPrice(I)});r(this,"saveOrderSingleChainParams",t=>{let{computedQuote:e}=this,{originDexRouterList:o,dexRouterList:s}=e.bestRoute||{};return{...t,dexRouterList:s,originDexRouterList:o}});r(this,"saveOrderCrossChainParams",t=>{let{computedQuote:e,fromToStore:o}=this,{receiveAddressStore:s}=this.rootStore,{to:i,computedDiffCrossChain:n}=o,{receiveAddrObj:c}=s,{fromDexRouterList:d,bridge:m,toDexRouterToList:p,originFromDexRouterList:f}=e.bestRoute||{};return{...t,toChainId:i.chainId,crossChainDexRouter:{fromDexRouterList:d,toDexRouterToList:p,bridge:m,originFromDexRouterList:f},...n?{receiveWalletAddress:c?.specifiedAddress}:{}}});r(this,"saveOrderParams",()=>{let{fromToStore:t}=this,{computedIsSingleChain:e}=t,o=this.baseSaveOrderParams();return e?this.saveOrderSingleChainParams(o):this.saveOrderCrossChainParams(o)});r(this,"resetFromToAmount",()=>{this.fromToStore.updateFrom({amount:"",currentTime:"",prevAmount:"",usdPrice:""}),this.fromToStore.updateTo({amount:"",prevAmount:"",usdPrice:"",currentTime:""}),this.fromToStore.advanceSetTypedValue("")});r(this,"transferBtcPayload",t=>{let e={...t},{from:o}=this.fromToStore;return e.value=Fe(e.value,o.decimals),e});r(this,"getExtParams",t=>{let{computedIsSingleChain:e,to:o,from:s,computedDiffCrossChain:i}=this.fromToStore,{receiveAddrObj:n}=this.rootStore.receiveAddressStore,c=i?n?.specifiedAddress:o.tokenContractAddress;return{txSource:3,orderId:t,toTokenAddress:c,crossChain:e?0:1,chainId:s.chainId,tokenAddress:s.tokenContractAddress,amount:s.amount,toChainId:o.chainId}});r(this,"confirmSwapVisible",!1);r(this,"setConfirmSwapVisible",t=>{this.confirmSwapVisible=t});r(this,"selectTokenHandle",async t=>{let e=this.commonStore.getChainByID(Number(t?.chainId));if(await il(),!e)return;let{tokenModalStore:o,quoteStore:s}=this.rootStore,{from:i,updateFrom:n,updateTo:c,setBalance:d,setFromBalanceRequestError:m,setToBalanceRequestError:p,to:f,computedIsExactIn:g,needCrossChainDoubleConfirm:I,setNeedCrossChainDoubleConfirm:A}=this.fromToStore,{clearReceiveAddressValue:R}=this.rootStore.receiveAddressStore;o.setCommonlyUsedChain([t?.chainId]),this.quoteStore.isFirstQuote=!0;let w=o.tokenModalFromState===C.FROM,q=()=>{m(!1),d(C.FROM,t.balance)},K=()=>{p(!1),d(C.TO,t.balance)};if(t.selected){w?K():q(),this.fromToStore.onSwitchFromTo();return}w?q():K();let nt=()=>{I||A(!0)};if(w){if(Da(t.chainId,f.chainId)&&this.commonStore.currentTab===y.BRIDGE){let mt=new Kt(this.commonStore.currentTab,{}),[W,Ge]=await mt.fetchCrossChainTokens({fromChainId:t.chainId,fromTokenAddress:t.tokenContractAddress}),{amount:ui}=i,Lo={...t},He;W?(n({...Lo,amount:ui}),He=e?.dexDefaultFromToTokenShowVO?.toCrossDexMultiTokenInfoVO,c({...He})):(Lo=Ge.data.fromTokenInfo,He=Ge.data.toTokenInfo,n({...Lo,amount:ui}),c(He),nt(),this.fromToStore.getTokenBalanceByAccount("from",Lo)),this.fromToStore.getTokenBalanceByAccount("to",He)}else if(!this.commonStore.equalsToken(t,i)){let{amount:mt}=i;s.setQuoteNumber(2),n({...t,amount:mt});let{toToken:W,isChanged:Ge}=o.checkFromToLegal(t,f);c(W),Ge&&(nt(),this.fromToStore.getTokenBalanceByAccount("to",M(W))),g&&this.fromToStore.advanceSetTypedValue("")}}else this.commonStore.equalsToken(t,f)||(nt(),s.setQuoteNumber(0),c({...t,amount:""}),g||this.fromToStore.advanceSetTypedValue(""));R()});this.rootStore=t,this.commonStore=t.commonStore,this.accountStore=t.accountStore,this.fromToStore=t.fromToStore,this.tokenModalStore=t.tokenModalStore,this.quoteStore=t.quoteStore,this.gasDropStore=t.gasDropStore}get computedEstimateGasFee(){let t=this.defaultGasFee,e=this.commonStore.nowCurrencyUnit,o=_(this.computedQuote.bestRoute,"quoteNetWorkFeeOfMoney"),s=T.BigNumber(o).multipliedBy(_(e,"usdToThisRate"));return!Y(e)&&!s.isNaN()&&(t=ot(s.toJSON(),e?.symbol)),t}get computedCrossChainFromFee(){let t=_(this.computedQuote.bestRoute,"fromSwapFeeUsd");if(!t||ie(Number(t)))return"--";let{computedNowCurrencySymbol:e,currencyConversion:o}=this.commonStore,s=o(t).toString();return`${ot(s,e)}`}updateTxHash(t){this.rootStore.sendTransactionStore.updateTxHash(t)}cancelOrder(t){return this.rootStore.sendTransactionStore.cancelOrder(t)}saveOrderUrl(){return jo}onSaveOrder(t){return b.info(N.SAVE_ORDER_PARAMS,{data:t}),k.post(this.saveOrderUrl(),t)}saveOrderErr(t){let{error_code:e,error_message:o=""}=t,s=t?.data?.code||e||"";return b.error(N.SAVE_ORDER_ERROR,{error:t,tags:{errorCode:e||s,error_msg:`${N.SAVE_ORDER_ERROR}_${s}`}}),e==="10014"?ke.error({title:h("swaptrade_toast_trade_not_available")}):ke.error({title:o||h("swaptrade_toast_save_order_fail")})}getSaveOrderMonitorData(){}async onSwap(t){this.isConfirmLoading=!0,b.keepLive();let e=this.saveOrderParams(),[o,s]=await O(this.onSaveOrder(e));if(o){this.saveOrderErr(o),this.isConfirmLoading=!1,b.removeKeep();return}b.info(N.SAVE_ORDER,{data:s?.data,tags:{orderId:s?.data.orderId}}),qa({...this.getSaveOrderMonitorData(),order_id:s?.data.orderId,wallet_type:this.accountStore.walletConfig?.walletType});let[i]=await O(this.onChainTransaction({...s?.data,swapParams:e},t));console.log("onChainError=====>",i),i&&this.onWalletFail(i,s?.data?.orderId),this.isConfirmLoading=!1,b.removeKeep()}walletErrorMessage(t){let e=null;try{e=JSON.parse(t?.message)}catch{e={}}return e}walletErrToast(t,e){let o,s=this.walletErrorMessage(t);return b.error(N.SEND_ERROR,{error:t,tags:{orderId:e}}),s?.code===qt.SLIPPAGE_LOW?o=h("swaptrade_home_toast_slippage_too_low"):s?.code===qt.SEND_TX_ERROR_CODE&&(o=s?.message),ke.error({title:o||h("swaptrade_home_toast_broadcast_failed")})}onWalletFail(t,e){_r(t)?this.cancelOrder(e):t?.code!==bn.RECEIPT_ERROR&&(co.emit(ao.FAIL,{data:{orderId:e},status:-2,message:$r("transaction fail")}),this.walletErrToast(t,e)),b.error(N.ON_WALLET_FAIL,{error:t,tags:{orderId:e}})}extendEvmParams(t){return t}isOkxWallet(){}async getTransactionPayload({orderData:t,orderId:e}){let{from:o}=this.fromToStore;return vr(o,{orderData:t,extParams:this.getExtParams(e)},this).getSendTransactionParams()}sendTransactionEnhance(...t){return this.rootStore.sendTransactionStore.sendTransaction(...t)}getTransaction(){}logChainId(){}async doubleCheckChainId(){return!0}async onChainTransaction(t,e){let{callData:o,orderId:s,swapParams:i}=t,n=await this.getTransactionPayload({orderData:t,orderId:s}),{computedIsEvmChain:c,from:d}=this.fromToStore;if(b.info(N.PAYLOAD,{payload:n,tags:{orderId:s}}),e)try{await e(...n)}catch(p){return b.error(N.BEFORE_SEND_TRANSACTION_ERROR,{error:p}),!1}return this.logChainId({message:N.CHECK_CHAIN_ID_BEFORE_SEND_TRANSACTION,fromChainId:d.chainId,saveOrderChainId:i.chainId,orderId:s}),await this.doubleCheckChainId({saveOrderChainId:i.chainId,orderId:s})?this.sendTransactionEnhance(...n).then(({result:p,nonce:f})=>{if(!nl(p))throw new Error(`hash format is invalid: ${p}`);return this.txInfo={...o,txHash:p},T.BigNumber(f).isNaN()?(this.updateTxHash({orderId:s,transactionHash:p}),c&&this.getTransaction(p,this.fromToStore.from.chainId).then(g=>{b.info(N.UPDATE_NONCE,{nonce:g.nonce,tags:{orderId:s}}),this.updateTxHash({orderId:s,transactionHash:p,nonce:g.nonce})}).catch(g=>{b.error(N.UPDATE_NONCE_FAIL,{error:g})})):this.updateTxHash({orderId:s,transactionHash:p,nonce:f}),this.afterTransaction(s),this.logChainId({message:N.CHECK_CHAIN_ID_AFTER_SEND_TRANSACTION,fromChainId:d.chainId,saveOrderChainId:i.chainId,orderId:s}),!0}):(console.log("doubleCheckChainId","=====>\u5207\u94FE\u5931\u8D25"),!1)}afterTransaction(t){this.setWalletConfirm(!0),this.resetFromToAmount(),this.showRecentTransactionModal(t),co.emit(ao.TXHASH,{status:0,data:M(this.txInfo),message:$r("Transaction hash has been generated")})}get computedQuote(){return this.quoteStore.quote}checkRepeatOrderDetail(t){t&&this.rootStore.recentTransactionStore.showModal(t)}};u();l();var cl=gt(["isWalletConfirm","isConfirmLoading","txInfo","confirmSwapVisible"],["computedEstimateGasFee","computedCrossChainFromFee","computedQuote"]);var Te=class extends Io{constructor(e){super(e);r(this,"sendTransactionEnhance",e=>{let{computedIsSolanaChain:o,computedIsTronChain:s,computedIsAptosChain:i,computedIsSuiChain:n,computedIsStacksChain:c,computedIsStarknetChain:d,computedIsFromBtcCoin:m}=this.rootStore?.fromToStore,{from:p}=this.rootStore?.fromToStore,{walletSendParams:f}=this.rootStore.walletContractStore;return this.rootStore.sendTransactionStore.sendTransaction(p.chainId,e,f).then(g=>{let I,A;if(o)I=g.signature;else if(s){let{transaction:R}=g;I=R?.txID}else if(i)I=g;else if(n)I=g;else if(c)I=g.txHash;else if(d)I=g.transaction_hash;else if(m)I=g;else if(dc(p.chainId))I=g.txHash;else{let{hash:R,nonce:w}=g;I=R,A=w}return{result:I,nonce:A}})});r(this,"showRecentTransactionModal",e=>{this.isConfirmLoading=!1,this.confirmSwapVisible=!1,L.history.replace(`${Ot}/${e}`)});r(this,"extendsGas",e=>{let o={...e},{gasInfo:s}=this.rootStore.walletContractStore,{gasLimitInfo:i,isGasLimitLoading:n,gasType:c,...d}=s;return o.extParams.gasType=c,{...o,gasInfo:d}});r(this,"extendEvmParams",e=>{let o=super.extendEvmParams(e),{activityId:s}=this.rootStore.walletContractStore,i=this.rootStore.quoteStore.quote?.bestRoute?.isEnableMev;s&&(o.extParams.activityId=s);let{computedIsMevOpen:n,mevInfo:c}=this.rootStore.mevStore;return n&&(o.extParams.isMev=!0,o.extParams.mevInfo=c),!n&&Number(i)===Qo.ON&&(o.extParams.isShowBlockSwapMevTooltip=!0),o});r(this,"onWalletFail",(e,o)=>{this.isConfirmLoading=!1,!e?.message?.includes(L.global?.HARDWALLETERROR)&&super.onWalletFail(e,o)});r(this,"checkRepeatOrderDetail",e=>{e&&L.history.push(`${Ot}/${e}`)});r(this,"checkUtxoBeforePublish",async e=>{let{utxoList:o}=e,{preDataForSendBtc:s}=this.rootStore.walletContractStore,{checkUtxoBeforePublish:i}=s;await i(o)});r(this,"onSwap",async(...e)=>{this.isConfirmLoading=!0;let o=await L.checkMpcAccountIfNecessary();if(this.isConfirmLoading=!1,!o)return;let{computedIsDexQuote:s}=this.rootStore.quoteStore,{computedIsFromBtcCoin:i}=this.rootStore?.fromToStore;s?await super.onSwap(i?this.checkUtxoBeforePublish:null):await this.rootStore.intentSwapStore?.onIntentSwap(...e)});r(this,"getSaveOrderMonitorData",()=>({...this.quoteStore.computedMonitorSwapSaveOrderParams,...this.rootStore.walletContractStore.computedMonitorGasType}));ct(this,cl)}isOkxWallet(){return!0}getTransaction(){}walletErrorMessage(e){return e}};u();l();u();l();D();u();l();D();u();l();D();var Gd={[y.SWAP]:"swap_used_chain_cache",[y.LIMIT_ORDER]:"limit_used_chain_cache",[y.BRIDGE]:"bridge_used_chain_cache"},ul=(a,t,e)=>{let o=Gd[e],s=v.get(o)||[];if(s.length===0&&(s=t.slice(0,4).map(n=>n.chainId)),a.forEach(i=>{s.includes(i)||s.unshift(i)}),s=s.filter(i=>t.find(n=>n.chainId===i)),s.length<4)for(let i=0;i<t.length&&s.length<4;i++)s.includes(t[i].chainId)||s.push(t[i].chainId);return s.length>4&&(s=s.slice(0,4)),v.set(o,s),s};u();l();var Ao=class{constructor(t,e){r(this,"id",1);r(this,"tokenSymbol","--");r(this,"tokenName","--");r(this,"decimals",6);r(this,"tokenContractAddress","");r(this,"tokenLogoUrl","");r(this,"type","");r(this,"amountNum",0);r(this,"currencyAmount",0);F(this),Object.assign(this,t),this.tokenModalStore=e}get computedPrice(){let{nowCurrencyUnit:t}=this.tokenModalStore.commonStore,{symbol:e,usdToThisRate:o}=t,s=T.BigNumber(this.currencyAmount);return s.isNaN()||s.isZero()?`${e||""}0.00`:e&&o&&!s.isNaN()&&!s.isZero()?ot(s.multipliedBy(o).toJSON(),e):"0"}get computedIsSelect(){let{equalsToken:t}=this.tokenModalStore.commonStore,{from:e,to:o}=this.tokenModalStore.fromToStore;return this.tokenModalStore.tokenModalFromState===C.FROM?t(this,o):t(this,e)}get computedIsSelectOrigin(){let{from:t,to:e}=this.tokenModalStore.fromToStore,{equalsToken:o}=this.tokenModalStore.commonStore;return this.tokenModalStore.tokenModalFromState===C.FROM?o(this,t):o(this,e)}get computedAmountNum(){return this.amountNumBigDecimal!==""?this.amountNum:0}toJSON(){return M(this)}};u();l();var _o=(a={})=>({...ft,logoUrl:ft.logoUrl(),chainName:h(ft.localKey),...a}),Fr=(a={})=>{let t=gi();return{...ht,get logoUrl(){return t===fi.dark?ht.darkLogoUrl():ht.logoUrl()},chainName:h(ht.localKey),...a}};var ll="hide_collect_cancel_dialog",dl="hideTokenGuide",Ce=class{constructor(t){r(this,"searchValue","");r(this,"setSearchValue",t=>{this.searchValue=t});r(this,"fromTokenList",new Map);r(this,"toTokenList",new Map);r(this,"searchTokenList",{});r(this,"error",!1);r(this,"tokenModalVisible",!1);r(this,"tokenModalFromState",C.FROM);r(this,"changeTokenModalFromState",t=>{this.tokenModalFromState=t});r(this,"loading",{[C.FROM]:{},[C.TO]:{}});r(this,"initLoading",()=>{this.loading={[C.FROM]:{},[C.TO]:{}}});r(this,"importTokenInfo",{});r(this,"setImportTokenInfo",t=>{this.importTokenInfo={...t}});r(this,"toSelectedChainId","");r(this,"fromSelectedChainId","");r(this,"setToSelectedChainId",t=>{this.toSelectedChainId=t});r(this,"setFromSelectedChainId",t=>{this.fromSelectedChainId=t});r(this,"extendTokenList",(t=[],e=!0)=>{if(Y(t))return t;let o=[];return t.forEach(s=>{if(this.commonStore.getChainByID(z(s.chainId))){let i=new Ao(s,this),n={balance:i.computedAmountNum,selected:i.computedIsSelect,selectedOrigin:e?i.computedIsSelectOrigin:!1,price:i.computedPrice};o.push({...s,...n})}}),o});r(this,"importUserToken",Mt(function*(e,o=!0){let s=e.map(c=>{let{chainId:d,tokenContractAddress:m,tokenSymbol:p,decimals:f}=c;return{chainId:d,contractAddress:m,tokenSymbol:p,precision:f}}),i={userUniqueId:this.commonStore.userUniqueId,tokenDetailList:s},n=[];try{n=(yield k.post(Nn,i)).data}catch(c){throw P.error(h("swaptrade_pricechart_no_connection_desc")),c}return o&&(this.searchValue="",this.changeTokenModalVisible(!1)),n}));r(this,"orderTokenList",t=>this.computedIsCollectChain?t:ba(t,[e=>Number(e.topPlacement),e=>Number(e.currencyAmount),e=>Number(e.amountNum),e=>Number(e.isCollectToken),e=>Number(e.collectTime)],["desc","desc","desc","desc","desc"]));r(this,"formatTokenList",(t,e)=>{let o=t;t.length>100&&e!==ft.chainId&&(o=t.slice(0,100));let s=this.extendTokenList(o,!0);return this.orderTokenList(s)});r(this,"changeTokenModalVisible",t=>{this.tokenModalVisible=t});r(this,"getTokenListByChainId",async()=>{let t=this.tokenModalFromState===C.FROM,e={};if(this.tokenModalFromState===C.FROM?e={fromChainId:this.fromSelectedChainId}:this.tokenModalFromState===C.TO&&(e={fromChainId:this.fromToStore.from.chainId,toChainId:this.toSelectedChainId}),this.tokenModalFromState===C.FROM&&Number(this.fromSelectedChainId)===ht.chainId){this.getFromAllNetworksTokens();return}if(this.tokenModalFromState===C.TO&&Number(this.toSelectedChainId)===ht.chainId){this.getToAllNetworksTokens(e.fromChainId);return}if(this.tokenModalFromState===C.FROM&&Number(this.fromSelectedChainId)===ft.chainId){this.getFromCollectedTokens();return}if(this.tokenModalFromState===C.TO&&Number(this.toSelectedChainId)===ft.chainId){this.getToCollectedTokens(e.fromChainId);return}t?this.getTokenList(C.FROM,e.fromChainId):this.getTokenList(C.TO,e.toChainId,e.fromChainId)});r(this,"setTokenList",(t,e,o)=>{let s=this.formatTokenList(e,t);this[`${o}TokenList`].set(t,s)});r(this,"handleTokenList",Mt(function*(e,o,s,i){this.setError(!1),this[`${e}TokenList`].get(o)||this.setLoading(e,o,!0);try{let{data:n}=yield k.get(s,{params:i}),c=this.toLowerCaseContractAddress(n);return this.setTokenList(o,c,e),this.setLoading(e,o,!1),{data:c}}catch(n){return this.setTokenList(o,[],e),this.setLoading(e,o,!1),this.setError(!0),n}}).bind(this));r(this,"getTokenList",Mt(function*(e,o,s){let i={fromChainId:s,chainId:o,userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,userWalletAddress:this.accountStore.computedSpecialWalletAddress};this.commonStore?.computedCurrentTabIsLimit&&(i={...i,businessLine:Nt.LIMIT_ORDER});let n=z(o);if(this.computedIsNotSupportToChain)return this.setTokenList(n,[],e),{data:[]};let c=Dt(dt.ALL_TOKENS,this.commonStore.currentTab);return yield this.handleTokenList(e,n,c,i)}));r(this,"getFromCollectedTokens",Mt(function*(){let e={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:"",userWalletAddress:this.accountStore.computedSpecialWalletAddress};this.commonStore?.computedCurrentTabIsLimit&&(e={...e,businessLine:Nt.LIMIT_ORDER});let o=Dt(dt.COLLECT_LIST,this.commonStore.currentTab);return yield this.handleTokenList(C.FROM,ft.chainId,o,e)}));r(this,"getToCollectedTokens",Mt(function*(e){let o={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:e,chainId:e,userWalletAddress:this.accountStore.computedSpecialWalletAddress};this.commonStore?.computedCurrentTabIsLimit&&(o={...o,businessLine:Nt.LIMIT_ORDER});let s=Dt(dt.COLLECT_LIST,this.commonStore.currentTab);return yield this.handleTokenList(C.TO,ft.chainId,s,o)}));r(this,"getFromAllNetworksTokens",Mt(function*(){let e={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:"",userWalletAddress:this.accountStore.computedSpecialWalletAddress};this.commonStore?.computedCurrentTabIsLimit&&(e={...e,businessLine:Nt.LIMIT_ORDER});let o=Dt(dt.ALL_NETWORK,this.commonStore.currentTab);return yield this.handleTokenList(C.FROM,ht.chainId,o,e)}));r(this,"getToAllNetworksTokens",Mt(function*(e){let o={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:e,userWalletAddress:this.accountStore.computedSpecialWalletAddress};this.commonStore?.computedCurrentTabIsLimit&&(o={...o,businessLine:Nt.LIMIT_ORDER});let s=Dt(dt.ALL_NETWORK,this.commonStore.currentTab);return yield this.handleTokenList(C.TO,ht.chainId,s,o)}));r(this,"cancelSearchRef",null);r(this,"needRemoveChainId",t=>[ht.chainId,ft.chainId].includes(z(t)));r(this,"getSearchChainType",()=>{let t=Vo.SINGLE;return this.computedCurrentChainId===ht.chainId&&(t=Vo.ALL_NETWORK),this.computedCurrentChainId===ft.chainId&&(t=Vo.COLLECT),t});r(this,"singleSearchParams",t=>{let e=this.getSearchChainType(),o={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,chainType:e,searchType:e,userWalletAddress:this.accountStore.computedSpecialWalletAddress},s={},i={};return this.tokenModalFromState===C.FROM?(s={inputContent:t,fromChainId:this.fromSelectedChainId,chainId:this.fromSelectedChainId,toChainId:this.fromSelectedChainId},this.needRemoveChainId(this.fromSelectedChainId)&&(delete s.fromChainId,delete s.toChainId,delete s.chainId)):this.tokenModalFromState===C.TO&&(i={inputContent:t,fromChainId:this.fromToStore.from.chainId,chainId:this.fromToStore.from.chainId,toChainId:this.toSelectedChainId,fromTokenAddress:this.fromToStore.from.tokenContractAddress||""},this.needRemoveChainId(this.toSelectedChainId)&&(delete i.toChainId,delete s.chainId)),{...o,...s,...i}});r(this,"bridgeSearchParams",t=>{let e=this.getSearchChainType(),o={inputContent:t,userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,chainType:e,userWalletAddress:this.accountStore.computedSpecialWalletAddress};return this.tokenModalFromState===C.FROM&&(o={...o,fromChainId:this.fromSelectedChainId},this.needRemoveChainId(this.fromSelectedChainId)&&delete o.fromChainId),this.tokenModalFromState===C.TO&&(o={...o,fromChainId:this.fromToStore.from.chainId,fromTokenAddress:this.fromToStore.from.tokenContractAddress||"",toChainId:this.toSelectedChainId},this.needRemoveChainId(this.toSelectedChainId)&&delete o.toChainId),o});r(this,"limitSearchParams",t=>({...this.singleSearchParams(t),businessLine:Nt.LIMIT_ORDER}));r(this,"getSearchTokenList",async()=>{if(this.searchValue==="")return;if(this.cancelSearchRef&&this.cancelSearchRef.abort(),this.computedIsNotSupportToChain){this.setSearchTokenList({}),this.setLoading(this.tokenModalFromState,"search",!1);return}this.cancelSearchRef=yt(),this.setLoading(this.tokenModalFromState,"search",!0),this.setError(!1);let t=Is(this.searchValue),e={};this.commonStore?.currentTab===y.LIMIT_ORDER?e=this.limitSearchParams(t):this.commonStore?.currentTab===y.SWAP?e=this.singleSearchParams(t):this.commonStore?.currentTab===y.BRIDGE&&(e=this.bridgeSearchParams(t)),Wa({keyword:t});let o=Dt(dt.SEARCH,this.commonStore.currentTab),[s,i]=await O(k.get(o,{params:{...e},signal:this.cancelSearchRef?.signal}));if(s&&!this.isCancel(s)&&(this.setError(!0),this.setSearchTokenList({}),this.setLoading(this.tokenModalFromState,"search",!1)),i){let{systemList:n,thirdPartyList:c}=i.data;this.setSearchTokenList({systemList:n,thirdPartyList:c}),this.setLoading(this.tokenModalFromState,"search",!1)}});r(this,"resetTokenModal",()=>{this.resetTokenData()});r(this,"resetTokenData",()=>{this.searchTokenList={},this.searchValue=""});r(this,"balancePushSort",(t,e)=>{let o=[...t],{currencyAmount:s,coinAmountOriginalDec:i}=e;for(let n=0;n<o.length;n++)if(this.commonStore.equalsToken(o[n],e)){o[n].amountNum=i,o[n].currencyAmount=s;break}return o});r(this,"updateAllTokenList",t=>{let{chainId:e}=t,o=z(e),s=this.fromTokenList.get(o);s&&this.setTokenList(o,this.balancePushSort(M(s),t),C.FROM);let i=this.toTokenList.get(o);i&&this.setTokenList(o,this.balancePushSort(M(i),t),C.TO)});r(this,"checkFromToLegal",(t,e)=>{let{currentTab:o}=this.commonStore,s={toToken:{...e,amount:""},isChanged:!1};if(Number(t.chainId)!==Number(e.chainId)){if(this.computedToChain?.some(f=>f.chainId===e.chainId&&!f.disabled))return s;let{dexDefaultFromToTokenShowVO:i}=this.commonStore.getChainByID(this.fromToStore.from.chainId),{fromDexMultiTokenInfoVO:n,toDexMultiTokenInfoVO:c,toCrossDexMultiTokenInfoVO:d}=i,m=o===y.BRIDGE,p;return m&&d?p=d:this.commonStore.equalsToken(t,c)?p=n:p=c,{toToken:p,isChanged:!0}}return s});r(this,"calcCurToChainIdIsInSupList",t=>{let e=!1;return M(this.computedToChain).forEach(o=>{Number(o.chainId)===Number(t)&&!o.disabled&&(e=!0)}),e});r(this,"updateTokenCollected",async(t,e=!1)=>{let{isConnectedWallet:o}=this.accountStore;if(!o){P.error(h("swaptrade_selecttoken_toast_connect_wallet"));return}let s=zo({},{tokenContractAddress:t?.tokenContractAddress||this.rootStore.klineStore.chooseTokenContractAddress,chainId:Number(t?.chainId),symbol:t?.tokenSymbol,decimal:t?.decimals,isCustomToken:t?.isCustomToken||t?.isSubscribe,walletAddress:this.accountStore.address||this.accountStore.computedAccountWalletAddressesArray[0],userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId}),[i,n]=await O(k.post(Yo,s));this.updateTokenCollectedLocal(t),i?(P.error(h("swaptrade_pricechart_no_connection_desc")),this.updateTokenCollectedLocal(zo({},t,{isCollectToken:t?.tokenInfo?0:1}))):n?.data===-1?e?P.error({title:h("swaptrade_selecttoken_modal_favorite_limitreached"),duration:.5}):this.setShowCollectOverLimitDialog(!0):n?.data===0?(P.success({title:h("swaptrade_selecttoken_toast_removed_from_favorite"),duration:.5}),this.rootStore.marketInfoStore.setIsCollected(!1)):n?.data===1&&(or(),P.success({title:h("swaptrade_selecttoken_toast_added_to_favorite"),duration:.5}),this.rootStore.marketInfoStore.setIsCollected(!0))});r(this,"hideCollectCancelConfirm",v.get(ll));r(this,"showCollectOverLimitDialog",!1);r(this,"setShowCollectOverLimitDialog",t=>{this.showCollectOverLimitDialog=t});r(this,"setCommonlyUsedChain",t=>{let{from:e,to:o}=this.fromToStore,{chainList:s,currentTab:i}=this.commonStore,n=t&&t.length>0?t:[e.chainId,o.chainId];return ul(n,s,i)});r(this,"tokenPageChainList",[]);r(this,"setTokenPageChainList",t=>{this.tokenPageChainList=t});r(this,"getCurrentToChainInfo",()=>this.computedToChain.find(e=>z(e.chainId)===z(this.toSelectedChainId)));r(this,"changeTokenPageChainList",async t=>{if(this.tokenPageChainList.findIndex(o=>z(o.chainId)===z(t))===-1){let o=this.commonStore.chainList.find(i=>z(i.chainId)===z(t)),s=[...this.tokenPageChainList];s.unshift(o),s.length>4&&s.pop(),this.setTokenPageChainList(s)}this.tokenModalFromState===C.FROM?this.setFromSelectedChainId(t):this.setToSelectedChainId(t),await this.getTokenListByChainId()});r(this,"searchChainKeywords","");r(this,"setSearchChainKeywords",t=>{this.searchChainKeywords=t});r(this,"filterChains",t=>so(t,e=>{let o=Pt(Is(this.searchChainKeywords));return Pt(e.chainName).includes(o)}));r(this,"dialogIndex",ps.TOKEN_LIST);r(this,"setDialogIndex",t=>{this.dialogIndex=t});r(this,"hideTokenGuide",!!v.get(dl));r(this,"setHideTokenGuide",()=>{this.hideTokenGuide=!0,v.set(dl,"1")});r(this,"importToken",async(t,e)=>{let s=(await this.importUserToken(Array.isArray(t)?t:[t]))[0]||{};e&&e(s),Ar(s)&&await this.fromToStore.getTokenBalanceByAccount(this.tokenModalFromState,s),this.setImportTokenInfo({}),this.setDialogIndex(ps.TOKEN_LIST)});r(this,"reloadTokenList",async()=>{!this.tokenModalVisible||(this.searchValue!==""?await this.getSearchTokenList():await this.getTokenListByChainId())});this.rootStore=t,this.commonStore=t.commonStore,this.swapStore=t.swapStore,this.accountStore=t.accountStore,this.fromToStore=t.fromToStore}get computedIsSearching(){return!!this.searchValue}setSearchTokenList(t){this.searchTokenList=t}setError(t){this.error=t}setLoading(t,e,o){this.loading[t][e]=o}get computedTokenList(){return this.tokenModalFromState===C.FROM?this.fromTokenList.get(this.fromSelectedChainId):this.toTokenList.get(this.toSelectedChainId)}get computedSearchTokenList(){let t={};return Y(this.searchTokenList)||(t={systemList:this.extendTokenList(this.searchTokenList?.systemList,!1),thirdPartyList:this.extendTokenList(this.searchTokenList?.thirdPartyList,!1)}),t}toLowerCaseContractAddress(t){let e=[];return Array.isArray(t)&&t.forEach(o=>{e.push({...o,tokenContractAddress:this.commonStore.getTokenAddress(o)})}),e}isCancel(t){return Qt(t)}get computedFromChain(){let t=_o(),e=Fr({});return[t,e,...M(this.tokenPageChainList)]}get computedToChain(){let t=_o();if(G(this.fromToStore.from.chainId)){let e=this.tokenPageChainList.filter(o=>o?.chainId===this.fromToStore.from.chainId);return[t,...e]}return[t]}get computedCurrentToChainId(){return this.toSelectedChainId?this.toSelectedChainId:G(this.fromToStore.to.chainId)?this.calcCurToChainIdIsInSupList(this.fromToStore.to.chainId)?this.fromToStore.to.chainId:this.fromToStore.from.chainId:this.computedToChain.length>1?ht.chainId:oo}reassignTokenInfo(t,e,o){if(this.commonStore.equalsToken(t,e)){let s=e?.isCollectToken;return zo({},e,{isCollectToken:s?0:1,collectTime:s?"":Date.now().toString(),isCustomToken:o?1:e?.isCustomToken})}return t}filterCollectToken(t){let e=!t.isCustomToken||t.balance;return!!(!this.computedIsCollectChain&&e||this.searchValue||t.isCollectToken)}updateTokenCollectedLocal(t){let e=(o=[],s)=>o.map(i=>this.reassignTokenInfo(i,t,s)).filter(i=>this.filterCollectToken(i));if(this.searchValue){let{systemList:o,thirdPartyList:s}=this.searchTokenList;this.setSearchTokenList({systemList:e(o),thirdPartyList:e(s,!0)})}else this.updateTokenList(e)}updateTokenList(t){if(this.tokenModalFromState===C.FROM){let e=t(this.fromTokenList.get(this.fromSelectedChainId));this.fromTokenList.set(this.fromSelectedChainId,e)}else if(this.tokenModalFromState===C.TO){let e=t(this.toTokenList.get(this.toSelectedChainId));this.toTokenList.set(this.toSelectedChainId,e)}}get computedCurrentChainId(){return z(this.tokenModalFromState===C.FROM?this.fromSelectedChainId:this.toSelectedChainId)}get computedIsCollectChain(){return this.computedCurrentChainId===ft.chainId}setShowCollectCancelConfirm(t){v.set(ll,t),this.hideCollectCancelConfirm=t}get computedIsNotSupportToChain(){let t=this.getCurrentToChainInfo();return this.tokenModalFromState===C.TO&&t&&t.disabled}get computedSelectedChainId(){return this.tokenModalFromState===C.FROM?this.fromSelectedChainId||this.fromToStore.from.chainId:this.tokenModalFromState===C.TO?this.toSelectedChainId||this.fromToStore.to.chainId:""}get computedAllChainList(){let t=this.commonStore.chainList;return this.tokenModalFromState===C.FROM?{supported:t,unsupported:[]}:this.tokenModalFromState===C.TO?this.computedToChainList:{supported:[],unsupported:[]}}get computedToChainList(){let t=this.commonStore.chainList,e=Zo(M(t),{chainId:Number(this.fromToStore.to.chainId)});return{supported:e?[e]:[],unsupported:[]}}get computedIsSearchChainStatus(){return!!this.searchChainKeywords}get computedSearchedChainList(){if(!this.computedIsSearchChainStatus)return{supported:[],unsupported:[]};let{supported:t,unsupported:e}=this.computedAllChainList;return{supported:this.filterChains(t),unsupported:this.filterChains(e)}}get computedTokenGuideVisible(){return!1}};var yo=class extends Ce{constructor(t){super(t),this.removeToken().catch(()=>{})}async removeTokenByChainId(t){let e={},o=v.get(t)||[];return o.length>0&&(e=await this.importUserToken(o),v.set(t,[])),e.data||[]}removeToken(){let t=[];return Object.values(B).forEach(e=>{t.push(this.removeTokenByChainId(e))}),Promise.all(t)}};var xr=class extends yo{constructor(e){super(e);r(this,"showChainTab",!0);r(this,"generateToChainMap",()=>{let e=this.commonStore.chainList,s=Zo(M(e),{chainId:Number(this.fromToStore.from.chainId)})?.bridgeSupportChainInfoList||[];return ka([...s],"chainId")});zt(this)}get computedTokenGuideVisible(){let{tokenModalFromState:e,hideTokenGuide:o}=this;return e===C.TO&&!o}get computedToChainList(){let e=this.commonStore.chainList,o=[],s=[],i=this.generateToChainMap();return e.forEach(n=>{let c={...n};c.disabled=!i[n.chainId],c.disabled||o.push(c)}),{supported:o,unsupported:s}}get computedToChain(){let e=_o(),o=Fr({});if(G(this.fromToStore.from.chainId)){let s=this.generateToChainMap(),i=[];return M(this.tokenPageChainList).forEach(n=>{n.chainId!==Number(this.fromToStore.from.chainId)&&i.push({...n,disabled:!s[n.chainId]})}),[e,o,...i]}return[e]}};u();l();D();var Xs=class{constructor(t){r(this,"sendTransactionParams",{});r(this,"waitingHandleOrderList",[]);r(this,"needIntercept",!1);r(this,"updateHistoryOrderList",t=>{let e=et(),o=[],s=[],i=this.rootStore.recentTransactionStore;i.pendingOrders.forEach(n=>{let c=n;n.orderId===t&&(c={...n,status:ur.PendingRedeeming}),o.push(c)}),!e&&i.history?.list?.forEach(n=>{let c=n;n.orderId===t&&(c={...n,status:ur.PendingRedeeming}),s.push(c)}),i.setPendingOrders(o),!e&&i.setHistory({...i.history,list:s})});r(this,"sendTransactionEnhance",async({callData:t,chainId:e,redeemOrderIdPre:o,redeemOrderId:s,bizType:i},n)=>{let c=et(),d=`${o}:${s}`;if(!c&&this.setWaitingHandleList(d),this.needIntercept)return;let m;if(et()){let p=this.rootStore.swapStore.extendsGas(t);m=this.sendTransactionStore.sendTransactionEnhance(e,p,this.rootStore?.walletContractStore?.walletSendParams)}else{if(!await this.rootStore.commonStore.connectAndSwitchNetwork(e))return;m=this.sendTransactionStore.sendTransactionEnhance(t)}m.then(({result:p,hash:f,nonce:g})=>{!c&&this.setWaitingHandleList(d,!0),this.sendTransactionStore.updateTxHash({orderId:s,transactionHash:c?f:p,bizType:i,nonce:g}),Pa(n),this.updateHistoryOrderList(o),c||this.sendTransactionStore.getTransaction(p,e).then(I=>{b.info(N.UPDATE_NONCE,{nonce:I.nonce,tags:{orderId:s}}),this.sendTransactionStore.updateTxHash({orderId:s,transactionHash:p,nonce:I.nonce,bizType:i})}).catch(I=>{b.error(N.UPDATE_NONCE_FAIL,{error:I,transactionHash:p,tags:{orderId:s}})})}).catch(p=>{!c&&this.setWaitingHandleList(d,!0),b.error(N.REDEEM_ORDER_ERROR,{error:p,tags:{orderId:s}})})});r(this,"walletSendRedeem",()=>{this.sendTransactionEnhance(this.sendTransactionParams,()=>{L.history?.goBack()})});r(this,"facetOrderDetail",{});this.rootStore=t,this.sendTransactionStore=t.sendTransactionStore,F(this,{},{autoBind:!0})}setSendTransactionParams(t){this.sendTransactionParams=t}async launchFacetSwap(t){let e=et(),{data:o}=this.rootStore.recentTransactionStore.detail,s=t?t.orderId:o?.orderId,i=t?t.chainId:o?.fromChainId,n=t?t.toTokenAddress:o?.toTokenAddress,c=t?t.fromTokenAddress:o?.fromTokenAddress,d={orderId:s,chainId:i,userWalletAddress:this.rootStore.accountStore.getAddressByChainId(i)};if(e&&t?.goOrderDetail){L.history?.push(`${Ot}/${s}`);return}let[m,p]=await O(k.post(aa,d));if(m){b.error(N.REDEEM_ORDER_CALL_DATA_ERROR,{error:m,tags:{orderId:s}}),Number(m?.code)===100002&&this.rootStore.recentTransactionStore.removePendingOrder(s),P.error({title:m?.msg||h("swaptrade_top_notif_data_failed")});return}let{redeemSignatureVo:f,redeemDetailInfo:g,redeemOrderId:I,bizType:A}=p?.data||{},{unsignedTx:R,...w}=f||{},q={...w,extParams:{toTokenAddress:n,crossChain:0,tokenAddress:c,amount:g.fromTokenAmount,toChainId:i,...d}},K={callData:q,chainId:i,redeemOrderIdPre:s,redeemOrderId:I,bizType:A};if(this.setSendTransactionParams(K),b.info(N.REDEEM_ORDER,{callData:q,tags:{orderId:I}}),e){this.setFacetOrderDetail({...g}),this.rootStore.walletContractStore.setTransactionPayload(q),L.history?.push({pathname:It,search:`needUpdate=${qo.off}&type=${rt.REDEEM}`});return}await this.sendTransactionEnhance(K)}setWaitingHandleList(t,e){this.waitingHandleOrderList.find(s=>s===t)?e?(this.waitingHandleOrderList=this.waitingHandleOrderList.filter(s=>s!==t),this.needIntercept=!1):(P.warn({title:h("swaptrade_history_notification_desc_wallet_confirm")}),this.needIntercept=!0):(this.waitingHandleOrderList=[...this.waitingHandleOrderList,t],this.needIntercept=!1)}getFacetExploreUrl(t){let{data:e}=this.rootStore.recentTransactionStore.detail,o=[e?.fromChildOrderDetailVo?.exploreUrl,e?.relativeTransaction?.exploreUrl];return this.computedIsFacetTradeType&&o?.[t]||""}get computedIsFacetTradeType(){let{data:{specialOrderType:t}}=this.rootStore.recentTransactionStore.detail;return t===mc.FromIsEthChainFacetCoin}get computedShowFacetTip(){return this.rootStore.recentTransactionStore.detail.data.status===ur.PendingCanRedeem}setFacetOrderDetail(t){this.facetOrderDetail=t}get computedFacetOrderToFromRate(){let{price:t}=this.facetOrderDetail;return t&&!Gt(t)&&t!=="-1"?j(t):""}get computedFacetOrderFromToRate(){let{price:t}=this.facetOrderDetail;return t&&!Gt(t)&&t!=="-1"?j(T.BigNumber("1").div(t).toString(10)):""}get computedFacetOrderTokens(){let{fromToken:t,toToken:e,fromTokenAmount:o,toTokenAmount:s}=this.facetOrderDetail;return{fromToken:{...t,amount:o},toToken:{...e,amount:s}}}get computedFacetOrderMinimumReceived(){return this.facetOrderDetail.minimumReceived}get computedFacetTipParams(){let t=this.rootStore.recentTransactionStore.detail?.data;return{amount:j(t?.fromChildOrderDetailVo?.toAmountOut,{needBillionMillionUnit:!1}),token:t?.fromChildOrderDetailVo?.toTokenSymbol}}},Mr=Xs;u();l();D();var Ie=class{constructor(t){r(this,"liquidityModelVisible",!1);r(this,"dataStatus",X.DEFAULT);r(this,"setDataStatus",t=>{this.dataStatus=t});r(this,"rawData",[]);r(this,"LiquidityCancelRef",null);r(this,"fetchLiquidityData",async()=>{this.resetAllLiquidityData(),this.setDataStatus(X.LOADING);let{from:t}=this.fromToStore;this.LiquidityCancelRef&&this.LiquidityCancelRef.abort(),this.LiquidityCancelRef=yt();let[e,o]=await O(k.get(ua,{params:{chainId:t.chainId},signal:this.LiquidityCancelRef?.signal,isolate:!0}));if(e)this.setDataStatus(X.ERROR);else{let s=_(o,"data");Y(s)?this.setDataStatus(X.NULL):(this.initAllLiquidityData(s),this.setDataStatus(X.READY))}});r(this,"selectedListIds",[]);r(this,"setSelectedListIds",t=>{this.selectedListIds=t});r(this,"confirmIds",null);r(this,"setConfirmIds",t=>{this.confirmIds=t});r(this,"filterSelectedListIds",(t,e)=>{let o;e?o=_s(this.selectedListIds,t):o=Ca(this.selectedListIds,t),this.setSelectedListIds(De(o))});r(this,"searchLiquidityValue","");r(this,"setLiquiditySearchValue",t=>{this.searchLiquidityValue=t});this.rootStore=t,this.fromToStore=this.rootStore.fromToStore,F(this,{},{autoBind:!0})}setLiquidityModelVisible(t){this.liquidityModelVisible=t}setData(t){this.rawData=t}resetAllLiquidityData(){this.setData([]),this.setSelectedListIds([]),this.setConfirmIds(null)}initAllLiquidityData(t){this.setData(t);let e=tr(t,"id");this.setSelectedListIds(e);let o=this.fromToStore.from.chainId;G(o)&&this.setConfirmIds(La({},o,e))}get computedListCheckedAll(){return this.computedSearchStatus?this.computedSearchIfAllChecked:this.selectedListIds.length===this.rawData.length}get computedCheckedAllDisabled(){return this.computedSearchStatus&&Y(this.computedSearchData)}get computedLiquidityNum(){let{from:t}=this.rootStore.fromToStore,e="--",{dataStatus:o,rawData:s,confirmIds:i}=this;if(o===X.NULL)e="0 / 0";else if(o===X.READY){let n=_(i,t.chainId);e=`${!n||n&&n.length===0?s.length:n.length} / ${s.length}`}return e}get computedClearAll(){return Y(this.selectedListIds)}checkAllBtn(){let t="",e=this.computedSearchStatus?this.computedSearchData:this.rawData,o=tr(e,"id");this.computedListCheckedAll?t=_s(this.selectedListIds,...o):t=Ra(this.selectedListIds,o),this.setSelectedListIds(De(t))}get computedCheckedData(){return tr(this.rawData,e=>({...e,isChecked:!!ya(this.selectedListIds,e.id)}))}get computedSortListData(){return Ka(this.computedCheckedData)}get computedSearchStatus(){return!!this.searchLiquidityValue}get computedSearchDataIsNull(){return this.computedSearchStatus&&Y(this.computedSearchData)}get computedSearchData(){return $a(this.computedCheckedData,this.searchLiquidityValue)}get computedSearchIfAllChecked(){let t=Ia(this.computedSearchData,e=>e?.isChecked);return!Y(this.computedSearchData)&&t}get computedShowData(){return this.searchLiquidityValue?this.computedSearchData:this.computedSortListData}get computedIds(){return _(this.rootStore.liquidityChooseStore?.confirmIds,this.rootStore.fromToStore?.from.chainId)}get computedIsCustomLiquidity(){return(this.computedIds||[]).length<this.rawData.length}get computedMonitorLiquidSelectType(){let{computedIds:t=[],rawData:e}=this;return!t.length||t.length===e?.length?"all":t.length>1?"custom_>1":t.length===1?"custom_=1":""}get computedIsSelectedAllDex(){let{computedIds:t=[],rawData:e}=this;return!t.length||t.length===e?.length}};u();l();D();var zs=class{constructor(t){r(this,"orderCheckContinue",async t=>{let[e,o]=await O(k.get(la,{params:t}));if(e)return P.error({title:h("swaptrade_history_toast_setup_error"),duration:At}),!1;let s=_(o,"data"),i=String(s?.checkCode);return i===Pe.SUCCESS?!0:(i===Pe.SINGLE_ERROR||i===Pe.LIMIT_SINGLE_ERROR?P.error({title:h("swaptrade_history_toast_chain_unsupported",{chain:s?.fromChainName}),duration:At}):i===Pe.CROSS_ERRORL||i===Pe.LIMIT_CROSS_ERRORL?P.error({title:h("swaptrade_history_toast_both_unsupported",{fromChain:s?.fromChainName,toChain:s?.toChainName}),duration:At}):P.error({title:h("swaptrade_history_toast_setup_error"),duration:At}),!1)});this.rootStore=t,F(this,{},{autoBind:!0})}},Br=zs;u();l();D();var{BigNumber:ml}=T,Js="safemoon_slippage",Zs="safemoon_is_changed",pl=50,ti={NeedIncreaseSlip:0,AdviseGivenSlip:1,NotAvailableGivenSlip:2,AdviseSlip:3},Ae=class{constructor(t){r(this,"isChanged",!1);r(this,"getSafemoonIsChangedLocal",()=>!!v.get(`${Zs}_${this.computedSlippageTokenPair}`));r(this,"cacheSlippage",0);F(this),this.rootStore=t,this.commonStore=t.commonStore,this.fromToStore=t.fromToStore,Ct(()=>this.computedSlippageTokenPair,()=>{this.setSafeMoonIsChanged(v.get(`${Zs}_${this.computedSlippageTokenPair}`)),this.setCacheSlippage(v.get(`${Js}_${this.computedSlippageTokenPair}`))}),Ct(()=>({slippage:this.computedPairSlippage}),()=>{this.cacheSlippage>0&&this.computedPairSlippage>this.cacheSlippage&&this.setSafeMoonIsChanged(!1),this.setCacheSlippage(v.get(`${Js}_${this.computedSlippageTokenPair}`))}),Ct(()=>this.computedSlippage,e=>{this.commonStore.safemoonSlippage=e})}setSafeMoonIsChanged(t){this.isChanged=t,v.set(`${Zs}_${this.computedSlippageTokenPair}`,t)}checkIsChanged(t){let e=new ml(t),o=e.gte(this.computedPairSlippage)&&e.lte(50);o&&this.setSafeMoonIsChanged(o)}setSafeMoonPairSlippage(t){!this.isAccessSlippage(t)||(this.setCacheSlippage(t),v.set(`${Js}_${this.computedSlippageTokenPair}`,t))}isAccessSlippage(t){let e=new ml(t);return this.computedPairSlippage>0&&e.gte(this.computedPairSlippage)&&e.lte(50)}get computedAutoSlippage(){return Pr(this.rootStore)}get computedSafeMoonToken(){let{from:t,to:e}=this.fromToStore;return this.checkIsSafeMoon(t)?t:this.checkIsSafeMoon(e)?e:null}get computedHoneypot(){let{from:t,to:e}=this.fromToStore;return this.checkIsHoneypot(t)?t:this.checkIsHoneypot(e)?e:null}setCacheSlippage(t){this.cacheSlippage=t}get computedPairSlippage(){return this.computedSafeMoonToken?1.1:0}get computedSlippage(){return this.cacheSlippage>this.computedPairSlippage?this.cacheSlippage:this.computedPairSlippage}get computedOverLimit(){return this.computedSlippage>50}get computedSlippageTokenPair(){let{from:t,to:e}=this.fromToStore;return`${this.checkIsSafeMoon(t)?t.tokenContractAddress:""}_${this.checkIsSafeMoon(e)?e.tokenContractAddress:""}`}get computedSlippageTips(){let t=_(this,"rootStore.quoteStore.quote.bestRoute"),e=Number(this.computedAutoSlippage),{tokenSymbol:o}=this.computedSafeMoonToken||{};return t?.isSafeMoonToken!=="1"||t?.isHoneypot==="1"?null:e===pl?{type:ti.AdviseGivenSlip,safeMoonSlippage:e,equalLimit:!0,tip:h("swaptrade_card_errortip_autoadjust_to_50",{tokenSymbol:o,slippageTolerance:e}),tipEquation:h("swaptrade_card_errortip_autoadjust_to_50",{tokenSymbol:U(o),slippageTolerance:e}),inputWarning:h("swaptrade_adjustslip_modal_advise_givenslip")}:e>pl?{type:ti.NotAvailableGivenSlip,overLimit:!0,safeMoonSlippage:e,tip:h("wallet_swap_adjustslip_modal_slip_notsupported",{tokenSymbol:o}),tipEquation:h("wallet_swap_adjustslip_modal_slip_notsupported",{tokenSymbol:U(o)})}:{type:ti.AdviseSlip,safeMoonSlippage:e,tip:h("swaptrade_card_errortip_autoadjust_to_less50",{slippageTolerance:e,tokenSymbol:o}),tipEquation:h("swaptrade_card_errortip_autoadjust_to_less50",{slippageTolerance:e,tokenSymbol:U(o)}),inputWarning:h("swaptrade_modal_errortip_adjust_to_suggested_range",{slippageTolerance:e})}}checkIsSafeMoon(t){return _(t,"isSafeMoonToken")===1}checkIsHoneypot(t){return _(t,"isHoneypot")===1}get computedInputVal(){let{computedIsExactIn:t,computedSwapAmount:e}=this.fromToStore;return!t&&this.computedHoneypot?"":e[C.FROM]}get computedInputFiatVal(){let{computedIsExactIn:t,computedFromLocalCostByUsd:e}=this.fromToStore;return!t&&this.computedHoneypot?"":e}get computedOutputVal(){let{computedIsExactIn:t,computedSwapAmount:e}=this.fromToStore;return t&&this.computedHoneypot?"":e[C.TO]}get computedOutputFiatVal(){let{computedIsExactIn:t,computedToLocalCostByUsd:e}=this.fromToStore;return t&&this.computedHoneypot?"":e}get computedOutputPopVal(){let{computedSwapAmount:t}=this.fromToStore;return this.computedHoneypot?"":t[C.TO]}};u();l();D();var Ur=class{constructor(){r(this,"gasDropConfig",{gasDropShow:!1,gasDropSwitch:v.get(ls)===Tn.OPEN,chainName:"",chainId:"",deduction:"",gasDrop:"",tokenLogoUrl:"",tokenSymbol:""});r(this,"setGasDropInfo",t=>{this.gasDropConfig={...this.gasDropConfig,...t}});r(this,"setGasDropSwitch",t=>{this.setGasDropInfo({gasDropSwitch:t}),v.set(ls,`${Number(t)}`)});r(this,"resetGasDrop",()=>{this.setGasDropInfo({gasDropShow:!1})});F(this)}get computedGasDropSelected(){let{gasDropShow:t,gasDropSwitch:e}=this.gasDropConfig;return t&&e}};u();l();var ei=class{constructor(t){r(this,"isShowMev",!1);r(this,"setShowMev",t=>{this.isShowMev=t});r(this,"isMevUserSwitchOpen",Ne.DEFAULT);r(this,"setMevUserSwitchOpen",t=>{this.isMevUserSwitchOpen=t});r(this,"mevInfo",{});r(this,"setMevInfo",t=>{this.mevInfo=t});this.rootStore=t,this.quoteStore=this.rootStore.quoteStore,this.fromToStore=this.rootStore.fromToStore,F(this,{},{autoBind:!0})}get computedIsMevOpen(){return this.isMevUserSwitchOpen===Ne.DEFAULT?this.isShowMev:this.isMevUserSwitchOpen===Ne.ON}},Wr=ei;u();l();D();var oi=class{constructor(t){r(this,"feeConfig",{});r(this,"setFeeConfig",t=>{if(!this.isIframe)return;if(!Y(t)){this.feeConfig=t,v.session.set("feeConfig",t);return}let e=v.session.get("feeConfig"),o=no(e,["referrerAddress","feePercent"]);Y(o)?(this.feeConfig={},v.session.remove("feeConfig")):this.feeConfig=o});r(this,"widgetFeeConfig",{});r(this,"setWidgetFeeConfig",t=>{this.isWidget&&(this.widgetFeeConfig=t)});r(this,"receiveQuoteUrl",()=>this.isIframe?Dn:xn);r(this,"saveOrderUrl",()=>this.isIframe?Mn:jo);r(this,"illegalFeePercent",t=>{let{BigNumber:e}=T,o=e(t);return!!(o.isNaN()||o.gt(En)||o.lte(0))});r(this,"extendFeeConfig",t=>{if(this.isWidget){let o=_(this.widgetFeeConfig,[t.chainId],{});if(typeof o.referrerAddress=="string")return{...t,...o};let s=_(o,["referrerAddress",t.fromTokenAddress]),i=_(s,"account"),c=_(s,"feePercent")||o.feePercent;return i?{...t,referrerAddress:i,feePercent:c}:t}if(!this.computedHasFeeConfig)return t;let e=Y(this.feeConfig)?v.session.get("feeConfig"):this.feeConfig;return{...t,...e}});F(this),this.rootStore=t,this.isIframe=!et()&&xa()&&!Be,this.isWidget=!et()&&er()}get computedHasFeeConfig(){return!!this.feeConfig?.referrerAddress&&!!this.feeConfig?.feePercent&&this.isIframe}get computedFeeConfigErrorTips(){return this.computedHasFeeConfig?this.illegalFeePercent(this.feeConfig?.feePercent):!1}},Vr=oi;u();l();D();u();l();var hl=()=>{let{swapStore:a,intentSwapStore:t,tradeModeStore:e,swapDappStore:o}=Bt();return!(a.isConfirmLoading||t.isConfirmLoading||!e.tradingModeType||o.computedSupportDappTradeByChain)};u();l();u();l();var fl=a=>{let{fromToStore:t,quoteStore:e}=Bt(),{commonDexInfo:o,pathSelectionRouterList:s,singleChainSwapInfo:i}=a,{computedIsSingleChain:n}=t,c=Number(o?.code)===Ut.CROSS_CHAIN_INTERVAL,d=c?{crossMaxAmount:o?.crossMaxAmount,crossMiniAmount:o?.crossMiniAmount}:null;return e.setQuoteScope(d),{isAutoError:c||(n?!i:!s?.length)}};var Hd=({quoteStore:a,fromToStore:t})=>{a.setQuoteNumber(a.quoteNumber+1),a.quoteNumber===1&&a.checkQuoteScopeLtMin(a.quoteScope,t.from.amount)&&t.advanceSetTypedValue("")},Qd=(a,{fromToStore:t,quoteStore:e})=>{let{commonDexInfo:o,pathSelectionRouterList:s,singleChainSwapInfo:i,swapType:n,intentCode:c,isSupportDappTrade:d,tradingModeType:m,supportSnapMode:p}=a,f={intentCode:c,tradingModeType:m,supportSnapMode:p,swapType:n},g=s?.map(A=>({...o,...A,...f,isSupportDappTrade:d}));return{bestRoute:t.computedIsSingleChain?{...o,...i,...f,intentInfo:a?.intentInfo||{},isSupportDappTrade:d}:e.pickBestRouterAccordingBridgeId(g)||{...o,...f,isSupportDappTrade:d},combineSelectionRouterList:g}},Kd=({bestRoute:a,combineSelectionRouterList:t,isAutoError:e},{fromToStore:o,quoteStore:s})=>{s.updateSlippageInfoFetched(a),s.setQuote({...s.quote,bestRoute:a,quoteNull:e,quoteError:null,isFetchQuoting:!1}),o.quoteUpdateFromTo(a),o.computedIsSingleChain||s.setPathSelectionRouterList(t||[])},$d=({isAutoError:a},{approveStore:t})=>{if(!a){t.isPendingNotCheck().catch(()=>{})}},jd=({isAutoError:a},{quoteStore:t})=>{a&&(t.handleReverseQuoteErrorAndNull(),at(()=>{t.updateQuoteStatus(t.quoteScope?2:3)}))},Yd=({snapModeQuote:a,tradingModeType:t,supportSnapMode:e},{intentSwapStore:o,tradeModeStore:s})=>{o.setCallDataInfo(a?{quote:a.quote,tradingModeType:t,unsignedTx:a.unsignedTx}:{}),s.tradingModeType===Vt.COMPARE_MODE&&e===Go.SUPPORT&&s.setBestPriceTag(t),s.tradingModeType===Vt.SNAP_MODE&&t===Vt.AUTO&&pc({title:h("swaptrade_trading_mode_toast_snap_quote_switch")}),s.setTradingModeType(t),s.setIsMetSnap(e)},Sl=a=>{let{fromToStore:t,quoteStore:e,approveStore:o,intentSwapStore:s,tradeModeStore:i}=Bt(),{isAutoError:n}=fl(a);Hd({quoteStore:e,fromToStore:t});let{bestRoute:c,combineSelectionRouterList:d}=Qd(a,{fromToStore:t,quoteStore:e});Kd({bestRoute:c,combineSelectionRouterList:d,isAutoError:n},{fromToStore:t,quoteStore:e,approveStore:o}),Yd(a,{intentSwapStore:s,tradeModeStore:i}),$d({isAutoError:n},{approveStore:o}),jd({isAutoError:n},{quoteStore:e})};u();l();var Eo=class{constructor(t){r(this,"allTimerAndQuoteState",{[tt.DEFAULT]:{isShowLoadingCpt:!1,quoteText:()=>""},[tt.QUOTING]:{isShowLoadingCpt:!0,quoteText:()=>h(Mo)},[tt.TIMER]:{isShowLoadingCpt:!0,quoteText:()=>h(Mo)},[tt.QUOTE_IS_HONEYPOT]:{isShowLoadingCpt:!1,quoteText:()=>h(Bo)},[tt.QUOTE_NULL]:{isShowLoadingCpt:!0,quoteText:()=>h(Bo)},[tt.QUOTE_NULL_AND_SECTION]:{isShowLoadingCpt:!0,quoteText:()=>h(Mo)},[tt.QUOTE_ERROR]:{isShowLoadingCpt:!1,quoteText:()=>h(Bo)}});Object.assign(this,t)}isValidRange(t){if(typeof t!="string")return!1;let{from:e}=this.fromToStore,o=t.split("-");if(o.length!==2)return!1;let{BigNumber:s}=T;return s(e.amount).lt(o[0])||s(e.amount).gt(o[1])}getCurrentTimerQuoteState(){let{quoteNull:t,isFetchQuoting:e,quoteError:o,bestRoute:s}=this.quote,i=this.fromToStore?.computedIfQuote,n=o!==null;return i?n?this.allTimerAndQuoteState[tt.QUOTE_ERROR]:this.rootStore.safeMoonStore.computedHoneypot?this.allTimerAndQuoteState[tt.QUOTE_IS_HONEYPOT]:t?s?.msg&&(e||this.isValidRange(s.msg))?this.allTimerAndQuoteState[tt.QUOTE_NULL_AND_SECTION]:this.allTimerAndQuoteState[tt.QUOTE_NULL]:e?e?this.allTimerAndQuoteState[tt.QUOTING]:this.allTimerAndQuoteState[tt.DEFAULT]:this.allTimerAndQuoteState[tt.TIMER]:this.allTimerAndQuoteState[tt.DEFAULT]}};var{FACET_TOKEN_ERROR_ONE:Xd,FACET_TOKEN_ERROR_TWO:zd,FACET_TOKEN_ERROR_THREE:Jd}=Ut,_e=class{constructor(t){r(this,"dialogCloseFlag",!1);r(this,"slippageInfoFetched",!1);r(this,"setDialogCloseFlag",t=>{this.dialogCloseFlag=t});r(this,"dialogShowQuotationComparison",!1);r(this,"setDialogShowQuotationComparison",t=>{this.dialogShowQuotationComparison=t});r(this,"quoteNumber",0);r(this,"setQuoteNumber",t=>{this.quoteNumber=t});r(this,"isDialog",!1);r(this,"setIsDialog",t=>{this.isDialog=t});r(this,"initQuote",{bestRoute:null,quoteError:null,quoteNull:!1,isFetchQuoting:!1});r(this,"isFirstQuote",!0);r(this,"setIsFirstQuote",t=>{this.isFirstQuote=t});r(this,"isPickRouterFromWallet",!1);r(this,"setIsPickRouterFromWallet",t=>{this.isPickRouterFromWallet=t});r(this,"quoteScope",null);r(this,"setQuoteScope",t=>{this.quoteScope=t});r(this,"fetchQuoteStatus",0);r(this,"quote",{...this.initQuote});r(this,"setQuote",t=>{this.quote=t});r(this,"pathSelectionRouterList",[]);r(this,"setPathSelectionRouterList",t=>{this.pathSelectionRouterList=t});r(this,"pickRouter",{});r(this,"setPickRouter",(t,e)=>{this.pickRouter=t,e&&(this.setNoCurrentPathTipInfo({bridgeName:t?.bridge?.bridgeName}),this.updateBestRoute(t))});r(this,"showChainListModel",!1);r(this,"setShowChainListModel",t=>{this.showChainListModel=t});r(this,"noCurrentPathTipInfo",{visible:!1,bridgeName:""});r(this,"setNoCurrentPathTipInfo",t=>{this.noCurrentPathTipInfo={...this.noCurrentPathTipInfo,...t}});r(this,"currentBridgeId","");r(this,"setCurrentBridgeId",t=>{this.currentBridgeId=t});r(this,"updateBestRoute",t=>{this.setQuote({...this.quote,bestRoute:t}),this.rootStore.mevStore.setMevUserSwitchOpen(Ne.DEFAULT),this.rootStore.fromToStore?.quoteUpdateFromTo(t)});r(this,"pickBestRouterAccordingBridgeId",t=>{let{smartRouterStore:{showXRouteModal:e}}=this.rootStore;if(!t||t.length===0)return null;let o=t.find(s=>s?.bridge?.bridgeId===this.currentBridgeId);return this.currentBridgeId&&!o&&(this.setCurrentBridgeId(""),!this.showChainListModel&&e!==Rn.ROUTER_SELECT&&this.setNoCurrentPathTipInfo({visible:!0})),o||t?.[0]});r(this,"quoteTimer",null);r(this,"clearQuote",()=>{this.cleanQuoteTimer(),this.setQuote(this.initQuote),this.setIsFirstQuote(!0),this.rootStore.fromToStore?.quoteUpdateFromTo(null),this.quotePending=!1});r(this,"cancelRef",null);r(this,"cleanQuoteTimer",()=>{clearTimeout(this.quoteTimer),this.quoteTimer=null,this.cancelRef&&this.cancelRef.abort()});r(this,"isClearQuote",()=>{let{currentTab:t}=this.commonStore,{computedTypedValue:e,from:o,to:s,computedIsSingleChain:i,computedIsExactIn:n}=this.fromToStore;return t===y.LIMIT_ORDER||!wt(e)||!s?.tokenContractAddress||!o?.tokenContractAddress||!n&&!i});r(this,"getQuoteData",t=>{let e=ue();return O(Iu(()=>k.get(this.outerStore.receiveQuoteUrl(),{params:e,signal:t}),cs.NUM,cs.TIMER))});r(this,"handleUpdateQuote",t=>{if(t){let{data:e}=t;Sl(e)}});r(this,"fetchQuote",async()=>{if(!hl())return this.quoteTimer=setTimeout(()=>{this.fetchQuote().catch(()=>{})},ds),Promise.resolve(!1);if(this.isClearQuote())return this.quoteScope=null,this.clearQuote(),Promise.resolve(!1);if(this.cleanQuoteTimer(),this.rootStore.outerStore.computedFeeConfigErrorTips)return this.handleQuoteError(),Promise.resolve(!1);this.setQuote({...this.quote,isFetchQuoting:!0}),this.cancelRef=yt();let[t,e]=await this.getQuoteData(this.cancelRef.signal);return this.quotePending=!1,!Qt(t)&&t&&this.handleQuoteError(t),this.handleUpdateQuote(e),this.setIsPickRouterFromWallet(!1),this.commonStore.setResetFromToByTabChange(!1),this.setIsFirstQuote(!1),!Qt(t)&&!this.dialogCloseFlag&&at(()=>{this.quoteTimer=setTimeout(()=>{this.fetchQuote().catch(()=>{})},ds)}),Promise.resolve(!0)});r(this,"quotePending",!1);r(this,"debounceQuote",Jo(this.fetchQuote,yn));r(this,"fetchQuoteDebounce",async()=>{let{computedIsCrossChain:t,computedIfQuote:e}=this.fromToStore;this.quotePending=!0,e&&t?await this.debounceQuote():e&&!t?this.debounceQuote():this.clearQuote()});r(this,"handleQuoteError",t=>{this.setQuote({...this.initQuote,quoteError:t}),this.handleReverseQuoteErrorAndNull()});r(this,"getGasTokenFeeLoading",!1);r(this,"getGasTokenFeeCancelRef",null);r(this,"cancelGasTokenGeeRequest",()=>{this.getGasTokenFeeCancelRef&&(this.getGasTokenFeeCancelRef.abort(),this.getGasTokenFeeCancelRef=null)});r(this,"cacheNativeGasFee","");r(this,"setCacheNativeGasFee",t=>{this.cacheNativeGasFee=t});r(this,"fetchGasTokenFee",async()=>{let{from:t}=this.rootStore.fromToStore,{computedReserveGas:e}=this.rootStore.commonStore,{decimals:o,balance:s}=t||{},i=wa(ue(),["dexIds"]);this.getGasTokenFeeCancelRef=yt();let n=this.rootStore.fromToStore?.computedIsExactIn?Pn:Fn;this.getGasTokenFeeLoading=!0;let c=this.getGasTokenFeeCancelRef.signal,d=e,[m,p]=await O(k.get(n,{params:{...i,amount:Oa(s,o)},signal:c}));if(this.getGasTokenFeeLoading=!1,!Qt(m)&&m)return-1;if(!m){let{data:f}=p||{},{commonDexInfo:g}=f||{};Number(g?.code)===0&&g?.estimateReserveGasTokenFee!==""&&(d=g.estimateReserveGasTokenFee)}return this.setCacheNativeGasFee(d),d});r(this,"transactionDetailExpanded",!1);r(this,"setTransactionDetailExpanded",t=>{this.transactionDetailExpanded=t});F(this,{},{autoBind:!0}),Object.assign(this,t),this.rootStore=t}initQuoteStatus(){this.fetchQuoteStatus=0}updateQuoteStatus(t){this.fetchQuoteStatus=t}get computedIsIntentType(){return this.rootStore.tradeModeStore.computedIsSnapType}get computedSlippage(){let{computedIsSingleChain:t,computedDefaultAutoSlippageInfo:e}=this.fromToStore,o=this.rootStore.slippageStore,s=Co({isSingleChain:t,autoSlippageInfo:e}),i=Zt.AUTO;return o&&(s=o.computedRealSlippageValue,i=o.getSlippageType()),!this.slippageInfoFetched&&i===Zt.AUTO&&(i=Zt.DEFAULT),{slippage:s,slippageType:i}}handleReverseQuoteErrorAndNull(){let{updateFromAmount:t,computedIsExactIn:e,updateTo:o}=this.fromToStore;e?o({amount:""}):t({amount:""})}getQuoteError(t){let{commonDexInfo:e,pathSelectionRouterList:o,singleChainSwapInfo:s}=t,{computedIsSingleChain:i}=this.fromToStore,n=Number(e?.code)===Ut.CROSS_CHAIN_INTERVAL,c=n?{crossMaxAmount:e?.crossMaxAmount,crossMiniAmount:e?.crossMiniAmount}:null;return this.setQuoteScope(c),{isAutoError:n||(i?!s:!o?.length)}}updateSlippageInfoFetched(t){let{autoSlippage:e,autoTotalSlippage:o}=t?.autoSlippageInfo||{};(e||o)&&(this.slippageInfoFetched=!0)}checkQuoteScopeLtMin(t,e){if(!t||!e)return!1;let{crossMiniAmount:o}=this.quoteScope||{};return!!T.BigNumber(e).lt(T.BigNumber(o))}get computedCurrentTimerQuoteState(){return new Eo(this).getCurrentTimerQuoteState()}get computedRouterForSmartRouterStore(){return this.computedMediaForChangeSmartRouterData&&!this.fromToStore?.computedIsSingleChain?this.pickRouter:this.quote?.bestRoute}get computedMediaForChangeSmartRouterData(){return Si()?.media==="sm"||this.isDialog}get computedQuoteAmount(){let{computedIsExactIn:t}=this.fromToStore;return t?this.quote?.bestRoute?.fromTokenAmount:this.quote?.bestRoute?.payAmount}get computedQuoteIntervalIsEmpty(){return this.computedQuoteInterval.type===lt.EMPTY}get computedQuoteInterval(){let{safeMoonStore:t,fromToStore:e,approveStore:o,swapBtnStore:s,swapDappStore:i}=this.rootStore;if(t.computedHoneypot||e.computedFormToTokenIsLeverageToken)return{type:lt.EMPTY};let n=rc.handleQuoteErrorState({quote:this.quote,honeypotToken:_(this,"rootStore.safeMoonStore.computedHoneypot",!1)})||this.accountStore.computedNonsupportChain,{from:c,computedNonsupportFacetToken:d}=this.fromToStore;if(n||d)return{type:lt.EMPTY};if(i.checkShouldJumpToDapp())return{type:lt.SHOULD_JUMP_DAPPS};if(this.computedNotSupportBtcAddress&&this.accountStore.isConnectedWallet)return{type:lt.NOT_SUPPORT_BTC_ADDRESS_TYPE,text:this.quote.bestRoute?.errorMsg};if((!this.quoteScope||!e.computedIfQuote)&&this.fetchQuoteStatus!==3&&!o.computedIsCancelApproveStatus)return{type:lt.EMPTY};if(this.computedCrossAccuracyLimit)return{type:lt.CROSS_CHAIN_ACCURACY,text:h("swaptrade_card_tooltips_adjust_pay_token_decimal",{fromToken:c.tokenSymbol,value:this.computedCrossAccuracyLimit}),equation:h("swaptrade_card_tooltips_adjust_pay_token_decimal",{fromToken:U(c.tokenSymbol),value:this.computedCrossAccuracyLimit})};if(this.computedFacetTokenTips)return{type:lt.FACET_TOKEN_SWAP_ERROR,text:this.computedFacetTokenTips};let{crossMiniAmount:p,crossMaxAmount:f}=this.quoteScope||{};if(T.BigNumber(c.amount).lt(T.BigNumber(p))){let g=j(p,{cutPriceText:!0,isFloor:!1});return{type:lt.CROSS_CHAIN_MIN,text:h("swaptrade_bridge_toast_min_amout_crosschain_swap",{value:g,symbol:c.tokenSymbol}),equation:h("swaptrade_bridge_toast_min_amout_crosschain_swap",{value:g,symbol:U(c.tokenSymbol)})}}if(T.BigNumber(c.amount).gt(T.BigNumber(f))){let g=j(f,{cutPriceText:!0});return{type:lt.CROSS_CHAIN_MAX,text:h("swaptrade_bridge_toast_max_amout_crosschain_swap",{value:g,symbol:c.tokenSymbol}),equation:h("swaptrade_bridge_toast_max_amout_crosschain_swap",{value:g,symbol:U(c.tokenSymbol)})}}return this.computedIsNoLiquidity?{type:lt.NOT_LIQUIDITY}:o.computedIsCancelApproveStatus&&!s.computedTooBalance?{type:lt.CANCEL_APPROVE_TIPS}:{type:lt.EMPTY}}get computedNotSupportFromBtcAddressType(){let t=this.quote?.bestRoute?.code;return Number(t)===Ut.NOT_SUPPORT_FROM_BTC_ADDRESS}get computedNotSupportToBtcAddressType(){let t=this.quote?.bestRoute?.code;return Number(t)===Ut.NOT_SUPPORT_TO_BTC_ADDRESS}get computedNotSupportBtcAddress(){return this.computedNotSupportFromBtcAddressType||this.computedNotSupportToBtcAddressType}get computedIsNoLiquidity(){let{from:t}=this.fromToStore,{crossMiniAmount:e,crossMaxAmount:o}=this.quoteScope||{};return this.fetchQuoteStatus===3&&this.quote.quoteNull||T.BigNumber(t.amount).lte(o)&&T.BigNumber(t.amount).gte(e)}get computedCrossAccuracyLimit(){let{crossAccuracyLimit:t,code:e}=this.quote.bestRoute||{};return Number(e)===Ut.CROSS_CHAIN_ACCURACY?t:""}get computedFacetTokenTips(){let{errorMsg:t,code:e}=this.quote.bestRoute||{};return[Xd,zd,Jd].includes(Number(e))&&t?t:""}get computedYouSaveVisible(){let{computedNowCurrencySymbol:t,currencyConversion:e,computedIsWalletEnv:o}=this.commonStore,{computedIsExactIn:s,computedIsCrossChain:i}=this.rootStore.fromToStore,{quoteError:n,quoteNull:c,bestRoute:d}=this.quote;if(!s||n||c||!d?.youSaveDTO||i)return{visible:!1};let{youSaveDTO:m,fromToken:p,toToken:f}=d,{topTenDexInfoList:g,youSaveMoney:I}=m,A=Number(I)>=.1&&g?.length>0&&!p.isHoneypot&&!f.isHoneypot,R=e(I).toString(),w=A?ot(R,t,{isFloor:!1}):"",q=A?g?.[1]?.dexName:"";return o&&(!i&&this.computedTopTenDexInfoList.length>0?A=!0:A=!1),{visible:A,youSaveStr:w,dexName:q}}get computedHasYouSave(){let{computedIsCrossChain:t}=this.rootStore.fromToStore;return!!this.quote?.bestRoute?.youSaveDTO||t}get computedTopTenDexInfoList(){if(!this.rootStore.fromToStore?.computedIsExactIn||!this.computedHasYouSave)return[];let{computedNowCurrencySymbol:t,currencyConversion:e}=this.commonStore;return this.quote?.bestRoute?.youSaveDTO?.topTenDexInfoList?.map(({logoUrl:o,dexName:s,comparePercent:i,price:n,dexAmountOut:c,amountOutOfMoney:d,gasOfMoney:m,isOkxDex:p})=>{let f=e(d)?.toString(),g=e(m)?.toString();return{logoUrl:o,dexName:s,comparePercent:i,price:n,isOkxDex:p,formatPrice:j(n),dexAmountOut:T.BigNumber(c).toString(),formatDexAmountOut:j(c),amountOutOfMoney:f,formatAmountOutOfMoney:ot(f,t,{needBillionMillionUnit:!1}),gasOfMoney:ot(g,t),symbol:t||""}})??[]}get computedReferredFee(){let{bestRoute:t}=this.quote,{referredNetWorkFee:e,referredAmount:o}=t||{};if(!o||!e)return"";let{computedNowCurrencySymbol:s,currencyConversion:i}=this.commonStore,{from:n}=this.fromToStore;return h("swaptrade_modal_desc_crosschain_valuediff_variavle",{price:`${j(o)} ${n.tokenSymbol}`,fee:`${ot(i(e).toString(),s)}`})}get computedMonitorSwapSaveOrderParams(){let{accountStore:t,liquidityChooseStore:e}=this.rootStore,{bestRoute:o}=this.quote;if(!o)return{};let{slippage:s,slippageType:i}=this.computedSlippage,{fromToken:n,fromTokenAmount:c,fromTokenPrice:d,toTokenPrice:m,receiveAmount:p,toToken:f,swapType:g,routerLabel:I}=o,A=Number(g)===0,R=A?{liquidity_source:e.computedMonitorLiquidSelectType}:{},w=A?{}:{bridge_selection:I?.includes(sc)?"overall best":"custom"};return{wallet_address:t.address,from_token_address:n?.tokenContractAddress,from_token_amount:c,from_amount_usdt:d,to_token_address:f?.tokenContractAddress,to_token_amount:p,to_amount_usdt:m,from_chain:n?.chainName,to_chain:f?.chainName,swap_type:A?"swap":"cross_chain_swap",slippage:{type:i===Zt.AUTO?"auto":"custom",amount:s},trading_mode:this.computedIsIntentType?"intent_mode":"auto_mode",...R,...w}}get computedIsUsingCentralizedBridge(){let t=["8"],e=String(this.quote.bestRoute?.bridge?.bridgeId);return t.includes(e)}get computedIsNoQuote(){return this.quote.quoteError||this.quote.quoteNull||!this.quote.bestRoute||this.rootStore.safeMoonStore?.computedHoneypot||this.fromToStore.computedFormToTokenIsLeverageToken||this.rootStore.outerStore.computedFeeConfigErrorTips||!this.fromToStore.computedTypedValueIsValid}get computedIsDexQuote(){let{bestRoute:t}=this.quote,{tradingModeType:e}=t||{};return String(e)===Ho}get computedSupportDappTradeByQuote(){return Number(this.quote?.bestRoute?.isSupportDappTrade)===1}};u();l();var om="1",rm="2",gl={minValue:.01,maxValue:.5},Tl={minValue:.03,maxValue:.5},ye=class{constructor(t){r(this,"slippageSetting",{autoIsSelected:!1,inputSlippage:""});r(this,"configSingle",gl);r(this,"configCross",Tl);r(this,"inputValue","");r(this,"inputCache","");r(this,"inputSlippageFocus",!1);r(this,"slippageNotice","");r(this,"hasSlippageError",!1);r(this,"hasSafeMoonWarning",!1);r(this,"isFrozen",!1);r(this,"frozenTooltip","");r(this,"clearNoticeAndError",()=>{this.slippageNotice="",this.hasSlippageError=!1});r(this,"setFrozenInfo",({computedSafeMoonNotSupport:t,isCrossBridgeOnly:e})=>{this.isFrozen=t||e,t?this.frozenTooltip=h("swaptrade_dialog_modal_current_notsupport"):e?this.frozenTooltip=h("swaptrade_dialog_modal_crosschain_notsupport"):this.frozenTooltip=""});r(this,"refreshInfo",()=>{let{inputSlippage:t}=this.slippageSetting;if(this.inputValue=t||"",this.computedSafeMoonTips||t!==""&&t!==void 0){let{computedSafeMoonTips:e,minSlippageShow:o,maxSlippageShow:s,computedAutoSlippage:i}=this,n=this.rootStore.fromToStore.computedIsSingleChain,{notice:c,isError:d,isWarning:m}=Dr({inputSlippageParams:this.computedSlippageValue,computedSafeMoonTips:e,minSlippageShow:o,maxSlippageShow:s,autoSlippageValue:i,isSingleChain:n});this.slippageNotice=c,this.hasSlippageError=d,this.hasSafeMoonWarning=m}});r(this,"onFocus",()=>{this.inputSlippageFocus=!0,this.hasSafeMoonWarning=!1,this.inputCache&&(this.onInput(null,this.inputCache),this.inputCache="")});r(this,"onInput",(t,e="")=>{let o=t||e;this.templeAutoSelected=!1;let{computedSafeMoonTips:s,minSlippageShow:i,maxSlippageShow:n,computedAutoSlippage:c}=this,d=this.rootStore.fromToStore.computedIsSingleChain,{notice:m,isError:p,isWarning:f}=Dr({inputSlippageParams:o,computedSafeMoonTips:s,minSlippageShow:i,maxSlippageShow:n,autoSlippageValue:c,isSingleChain:d});if(!ie(z(o))){let I=/^0{2,}/gm;o=o.replace(I,"0"),this.inputValue=o}let g=o||this.computedSafeMoonTips;this.slippageNotice=g?m:"",this.hasSlippageError=p,this.hasSafeMoonWarning=f});r(this,"onBlur",()=>{this.inputSlippageFocus=!1});r(this,"onSelectCustom",()=>{let t=this.inputValue,{computedSafeMoonTips:e,minSlippageShow:o,maxSlippageShow:s,computedAutoSlippage:i}=this,n=this.rootStore.fromToStore.computedIsSingleChain,{slippage:c,inputValue:d,notice:m,isError:p}=Dr({inputSlippageParams:t,computedSafeMoonTips:e,minSlippageShow:o,maxSlippageShow:s,autoSlippageValue:i,isSingleChain:n}),f=this.getSafeMoonStore();if(f.checkIsChanged&&f.checkIsChanged(t),e?this.inputValue=Ht(c):this.inputValue&&(this.inputValue=Ht(c),this.slippageNotice=m,this.hasSlippageError=p,this.hasSafeMoonWarning=!!e),(Number(t)===0||ie(t))&&(this.slippageNotice=""),p){this.onSelectAuto(),this.inputSlippageFocus=!1;return}Es({custom_or_auto:d?"custom":"auto"}),this.setSlippageSetting({autoIsSelected:!d,inputSlippage:d}),this.rootStore.quoteStore.fetchQuoteDebounce()});r(this,"onReset",()=>{let{inputSlippage:t}=this.slippageSetting;this.inputValue=t,this.clearNoticeAndError(),this.inputSlippageFocus=!1});this.rootStore=t,this.commonStore=t.commonStore,this.fromToStore=t.fromToStore,this.smartRouterStore=t.smartRouterStore,F(this,{},{autoBind:!0})}getSafeMoonStore(){return this.rootStore.safeMoonStore}getOrderSlippageInfo(){let{autoIsSelected:t}=this.slippageSetting,e=Ys(this.rootStore);return t||this.isFrozen?{autoSlippageInfo:e}:{customSlippage:String(this.computedRealSlippageValue),autoSlippageInfo:e}}get minSlippage(){let t=this.rootStore.fromToStore.computedIsSingleChain,{computedSafeMoonToken:e}=this.getSafeMoonStore();if(e){let o=T.BigNumber.max(this.configCross.minValue,this.configSingle.minValue);return o.isNaN()?.011:o.toString()}return t?this.configSingle.minValue:this.configCross.minValue}get maxSlippage(){return this.rootStore.fromToStore.computedIsSingleChain?this.configSingle.maxValue:this.configCross.maxValue}get minSlippageShow(){return T.mul(this.minSlippage,100)}get maxSlippageShow(){return T.mul(this.maxSlippage,100)}get computedAutoSlippage(){let{computedHoneypot:t}=this.getSafeMoonStore();if(t){let e=_(this,"rootStore.quoteStore.quote.bestRoute.realSlippage",0);return T.mul(e,100)}return Pr(this.rootStore)}get computedSafeMoonNotSupport(){let{computedHoneypot:t,computedSlippageTips:e}=this.getSafeMoonStore();return!!(t||e?.overLimit||e?.equalLimit)}get computedSafeMoonSlippage(){return this.getSafeMoonStore().computedSlippage}get computedSafeMoonTips(){return this.getSafeMoonStore().computedSlippageTips}get computedSafeMoonTip(){return this.getSafeMoonStore().computedSlippageTips?.tip}get computedSafeMoonPairSlippage(){return this.getSafeMoonStore().computedPairSlippage}get computedSlippageValue(){return this.getSlippageValue()}get computedRealSlippageValue(){let t=this.getSlippageValue();return Number(T.div(t,100))||0}isValidVolatilityTip(){if(Number(this.computedSlippageValue)>this.computedAutoSlippage)return!1;let t=this.getSafeMoonStore(),e=this.smartRouterStore;return t.computedSafeMoonToken===null&&!e?.isCrossBridgeOnly}get computedVolatilityTips(){if(!this.isValidVolatilityTip())return null;let{computedAutoSlippage:t}=this,e=this.rootStore?.quoteStore?.quote?.bestRoute||{},{priceFluctuationMonitorTime:o,priceFluctuationThreshold:s,fromPriceFluctuation:i,toPriceFluctuation:n,rateFluctuationThreshold:c,slippageFluctuationhold:d,rateFluctuation:m}=e,{from:p,to:f}=this.fromToStore,g=f?.tokenSymbol||"",I=p?.tokenSymbol||"",A=T.mul(d,100),R=T.mul(s,100),w=T.mul(c,100),q=Number(m),K=Number(c);if(t>A){if(q<K)return null;let nt=this.slippageSetting.autoIsSelected;return{tip:h("swaptrade_settings_alert_both_exchange_tips",{payToken:I,receiveToken:g,value:w,min:o}),tipEquation:h("swaptrade_settings_alert_both_exchange_tips",{payToken:U(I),receiveToken:U(g),value:w,min:o}),swapInterceptorType:nt?$.VOLATILITY_SLIPPAGE:null}}else if(t===A){let nt=Math.abs(i),mt=Math.abs(n),W=Number(s);if(nt>W&&mt>W)return{tip:h("swaptrade_placeorder_alert_both_volatility",{payToken:I,receiveToken:g,value:R,min:o}),tipEquation:h("swaptrade_placeorder_alert_both_volatility",{payToken:U(I),receiveToken:U(g),value:R,min:o})};if(nt>W)return{tip:h("swaptrade_placeorder_alert_pay_receive_volatility",{token:I,value:R,min:o}),tipEquation:h("swaptrade_placeorder_alert_pay_receive_volatility",{token:U(I),value:R,min:o})};if(mt>W)return{tip:h("swaptrade_placeorder_alert_pay_receive_volatility",{token:g,value:R,min:o}),tipEquation:h("swaptrade_placeorder_alert_pay_receive_volatility",{token:U(g),value:R,min:o})};if(q>=K)return{tip:h("swaptrade_settings_alert_both_exchange",{payToken:I,receiveToken:g,value:w,min:o}),tipEquation:h("swaptrade_settings_alert_both_exchange",{payToken:U(I),receiveToken:U(g),value:w,min:o})}}return null}getDefaultSetting(){let t={inputSlippage:"",autoIsSelected:!0},e=this.getSafeMoonStore();if(e.computedSafeMoonToken){let o=e.computedSlippage,s=Ht(o);e.isChanged&&s&&(t.inputSlippage=s,t.autoIsSelected=!1)}return t}getSlippageType(){return this.slippageSetting.autoIsSelected||this.isFrozen?Zt.AUTO:Zt.CUSTOM}getSlippageValue(t){let{autoIsSelected:e,inputSlippage:o}=t||this.slippageSetting;return e||this.isFrozen?this.computedAutoSlippage:o||this.computedAutoSlippage}setSlippageSetting(t){let e={...t},o=this.getSafeMoonStore(),{computedSafeMoonToken:s}=o;if(!s){this.slippageSetting=e;return}let i=this.getSlippageValue(e);if(i===this.getSlippageValue(this.slippageSetting)||o.isAccessSlippage(i)||!o.getSafemoonIsChangedLocal()){e.inputSlippage="",e.autoIsSelected=!0;let n=Ht(i);o.isChanged&&n&&(e.inputSlippage=n,e.autoIsSelected=!1),o.setSafeMoonPairSlippage(i),this.slippageSetting=e}}async initSlippageConfigs(){try{let{data:t}=await k.get(sa),e=t?.find(({configId:s})=>om===s),o=t?.find(({configId:s})=>rm===s);e&&(this.configSingle=e),o&&(this.configCross=o)}catch{this.configSingle=gl,this.configCross=Tl}}initSlippageSetting(){let t=this.getDefaultSetting(),e;t?e={...t}:e={autoIsSelected:!0,inputSlippage:""},this.setSlippageSetting(e)}initReactions(){Ct(()=>{let{from:t,to:e}=this.fromToStore;return{chainId:t.chainId,toChainId:e.chainId,fromTokenAddress:t.tokenContractAddress,toTokenAddress:e.tokenContractAddress}},({fromTokenAddress:t,toTokenAddress:e})=>t&&e?(this.rootStore.quoteStore.slippageInfoFetched=!1,this.clearNoticeAndError(),this.initSlippageSetting()):!1,{equals:xt.shallow}),Ct(()=>{let t=this.fromToStore.from.chainId,{computedSafeMoonSlippage:e}=this;return{fromId:t,computedSafeMoonSlippage:e}},this.clearNoticeAndError,{equals:xt.shallow}),Ct(()=>{let{computedSafeMoonPairSlippage:t}=this;return{computedSafeMoonPairSlippage:t}},()=>{this.initSlippageSetting()},{equals:xt.shallow}),Ct(()=>{let{isCrossBridgeOnly:t}=this.smartRouterStore,{computedSafeMoonNotSupport:e}=this;return{computedSafeMoonNotSupport:e,isCrossBridgeOnly:t}},this.setFrozenInfo,{equals:xt.shallow}),Ct(()=>{let{slippageSetting:t,isFrozen:e,computedSafeMoonTip:o}=this;return{slippageSetting:t,isFrozen:e,computedSafeMoonTip:o}},this.refreshInfo,{equals:xt.shallow})}onSelectAuto(t){Es({custom_or_auto:"auto"}),!this.hasSlippageError&&!this.hasSafeMoonWarning&&this.inputValue?this.inputCache=this.inputValue:this.inputCache="";let e={autoIsSelected:!0,inputSlippage:""};if(this.inputValue="",this.slippageNotice="",this.hasSlippageError=!1,this.hasSafeMoonWarning=!1,!t){let o=this.getSafeMoonStore();o.computedSafeMoonToken&&o.setSafeMoonIsChanged(!1),this.setSlippageSetting(e),this.rootStore.quoteStore.fetchQuoteDebounce()}}get computedMinimumNum(){let{quote:t}=this.rootStore.quoteStore,e=t?.bestRoute?.receiveAmount,o=t?.bestRoute?.minimumReceived,s=this.fromToStore.to?.tokenSymbol,{computedIsSnapType:i}=this.rootStore.tradeModeStore,n=this.inputValue?T.div(this.inputValue,100):this.computedRealSlippageValue;if(this.hasSlippageError||!wt(this.rootStore.quoteStore.quote?.bestRoute?.receiveAmount)||!wt(e))return{text:"--",equation:"--"};let c=i?o:T.mul(e,1-(wt(n)?n:0));return{text:`${j(c)} ${s}`,equation:`${j(c)} ${U(s)}`}}};u();l();D();var ri=class{constructor(t){r(this,"checkCrossChainParams",()=>{let{quoteStore:t,receiveAddressStore:e}=this.rootStore,{quote:o}=t,s=this.checkCommonParams(),{receiveAddrObj:i}=e,n=_(o.bestRoute,"quoteNetWorkFeeOfMoney"),c=o?.bestRoute?.bridge?.bridgeId,d=i?.specifiedAddress;return{...s,fromSwapFeeUsd:n,bridgeId:c,receiveWalletAddress:d}});r(this,"checkCommonParams",()=>{let{accountStore:t,fromToStore:e,quoteStore:o}=this.rootStore,{from:s,to:i}=e;return{fromChainId:s.chainId,fromTokenAddress:s.tokenContractAddress,amount:o?.computedQuoteAmount,toChainId:i.chainId,toTokenAddress:i.tokenContractAddress,userWalletAddress:t.address,accountId:t.computedAccountId}});r(this,"repeatOrder",null);r(this,"checkRepeatOrder",async()=>{this.repeatOrder=null;let{fromChainId:t,...e}=this.checkCommonParams(),{quoteStore:{quote:o}}=this.rootStore,s=_(o.bestRoute,"fromSwapFeeUsd"),i={...e,chainId:t,fromSwapFeeUsd:s},[n,c]=await O(k.get(qn,{params:i}));!n&&[re.COMMON_REPEAT,re.BTC_REPEAT,re.FACET_REPEAT].includes(c?.data.repeatFlag)&&at(()=>{let{orderId:d,enoughFlag:m}=c?.data??{};this.repeatOrder={enoughFlag:m,repeatFlag:c?.data.repeatFlag,id:d}})});r(this,"checkSwapMoreInfo",null);r(this,"checkCrossChainSwap",async()=>{this.checkSwapMoreInfo=null;let t=this.checkCrossChainParams(),[e,o]=await O(k.post(Gn,{...t}));e||at(()=>{this.checkSwapMoreInfo=o?.data})});F(this),this.rootStore=t}},qr=ri;u();l();D();var Ee=class{constructor(t){r(this,"swapOnDappBtnLoading",!1);r(this,"setSwapOnDappBtnLoading",t=>{this.swapOnDappBtnLoading=t});r(this,"refreshing",!1);r(this,"setRefreshing",t=>{this.refreshing=t});r(this,"dappListContainerVisible",!1);r(this,"setDappListContainerVisible",t=>{this.dappListContainerVisible=t});r(this,"fetchDappListError",!1);r(this,"setFetchDappListError",t=>{this.fetchDappListError=t});r(this,"availableNoticeVisible",!1);r(this,"setAvailableNoticeVisible",t=>{this.availableNoticeVisible=t});r(this,"dappList",[]);r(this,"setDappList",t=>{this.dappList=t});r(this,"getFetchParam",()=>{let{from:t,to:e,computedIsSingleChain:o}=this.fromToStore||{},s={},i="";return o?(i=ha,s={chainId:t?.chainId,tokenAddress:e?.tokenContractAddress}):(i=fa,s={fromChainId:t?.chainId,fromTokenAddress:t?.tokenContractAddress,toChainId:e?.chainId,toTokenAddress:e?.tokenContractAddress}),{url:i,params:s}});r(this,"fetchDappList",async t=>{t?(this.setFetchDappListError(!1),this.setRefreshing(!0)):this.setSwapOnDappBtnLoading(!0);let{url:e,params:o}=this.getFetchParam(),[s,i]=await O(k.get(e,{params:o}));if(this.setRefreshing(!1),this.setSwapOnDappBtnLoading(!1),s){if(Number(s.code)===40008){this.setAvailableNoticeVisible(!0);return}this.setFetchDappListError(!0),this.setDappListContainerVisible(!0);return}this.setDappList(i.data),this.setDappListContainerVisible(!0)});r(this,"getSupportDetail",(t={},e)=>{let o=this.chainIsSupportMarket(t),s=this.chainIsSupportDappTrade(t),i=!!this.quoteStore?.computedSupportDappTradeByQuote,n=!o&&s,c=o&&s,d=o&&!s;return{chainSupportMarket:o,chainSupportDappTrade:s,quoteSupportDappTrade:i,balance:c||d,kline:c||d,klineJumpMarket:c||d,costValue:e&&c||d,valueDifference:d,liquidity:d,disableInput:n||c,showMax:d,showAddFund:d}});r(this,"mergeCurrencyInputProps",(t,e)=>({balanceStatus:e.balance?t.balanceStatus:Z.BALANCE_NOT_SHOW,costValue:e.costValue?t.costValue:"",valueDifference:e.valueDifference?t.valueDifference:{},disableInput:e.disableInput,showMax:e.showMax?t.showMax:!1,showMaxIcon:e.showMax?t.showMaxIcon:!1,showAddFund:e.showAddFund?t.showAddFund:!1}));r(this,"getCurrentFromToChainConfig",()=>{let t=this.fromToStore.from.chainId,e=this.fromToStore.to.chainId,o=this.commonStore.getChainByID(t),s=this.commonStore.getChainByID(e);return[o,s]});r(this,"chainIsSupportMarket",t=>Number(t?.isSupportMarket)===1);r(this,"chainIsSupportDappTrade",t=>Number(t?.isSupportDappTrade)===1);r(this,"bridgeSupportDappTrade",t=>Number(t?.supportLinkDapp)===1);r(this,"getSupportDappTradeByToken",()=>{let t=this.quoteStore?.computedSupportDappTradeByQuote,e=this.liquidityChooseStore?.computedIsSelectedAllDex;return this.fromToStore.computedIsSingleChain&&t&&e});r(this,"checkShouldJumpToDapp",()=>this.fromToStore.computedFormToTokenIsLeverageToken?!1:this.computedSupportDappTradeByChain?!0:this.getSupportDappTradeByToken());this.rootStore=t,this.commonStore=t.commonStore,this.fromToStore=t.fromToStore,this.quoteStore=t.quoteStore,this.liquidityChooseStore=t.liquidityChooseStore,F(this,{},{autoBind:!0})}get computedFromToSupportMarketAndDappTrade(){let[t,e]=this.getCurrentFromToChainConfig();return{from:{...this.getSupportDetail(t,!0)},to:{...this.getSupportDetail(e)}}}get computedFromToSupportMarket(){let[t,e]=this.getCurrentFromToChainConfig();return this.chainIsSupportMarket(t)&&this.chainIsSupportMarket(e)}get computedSupportDappTradeByChain(){let t=this.fromToStore.from.chainId,e=this.fromToStore.to.chainId,o=this.commonStore.getChainByID(t);if(this.fromToStore.computedIsSingleChain)return this.chainIsSupportDappTrade(o);let s=o?.bridgeSupportChainInfoList,i=Array.isArray(s)&&s.find(n=>Number(n.chainId)===Number(e));return this.bridgeSupportDappTrade(i)}};var We=class extends ae{constructor(){v.init({project:$o});super();r(this,"reset",()=>{this.receiveAddressStore=new Rr(this),this.outerStore=new Vr(this),this.fromToStore=new Se(this),this.approveStore=new ce(this),this.quoteStore=new _e(this),this.tokenModalStore=new xr(this),this.safeMoonStore=new Ae(this),this.walletContractStore=new br(this),this.sendTransactionStore=new Or(this),this.intentSwapStore=new Lr(this),this.swapCheckStore=new qr(this),this.swapStore=new Te(this),this.swapBtnStore=new ge(this),this.mevStore=new Wr(this),this.recentTransactionStore=new lr(this),this.facetStore=new Mr(this),this.liquidityChooseStore=new Ie(this),this.swapDappStore=new Ee(this),this.smartRouterStore=new ir(this),this.slippageStore=new ye(this),this.oneMoreOrderStore=new Br(this),this.gasDropStore=new Ur});this.reset()}},ko=We;r(ko,"instance",null),r(ko,"getInstance",()=>(We.instance||(We.instance=new We),We.instance));var Cl=ko;u();l();D();u();l();u();l();var Il=gt(["searchValue","fromTokenList","toTokenList","searchTokenList","error","tokenModalVisible","tokenModalFromState","loading","importTokenInfo","toSelectedChainId","fromSelectedChainId","hideCollectCancelConfirm","hideTokenGuide","tokenPageChainList","searchChainKeywords","dialogIndex"],["computedTokenList","computedSearchTokenList","computedFromChain","computedToChain","computedCurrentToChainId","computedCurrentChainId","computedIsCollectChain","computedTokenGuideVisible","computedIsNotSupportToChain","computedAllChainList","computedIsSearchChainStatus","computedSearchedChainList"]);var wo=class extends Ce{constructor(t){super(t),ct(this,{...Il})}};var Ve=class extends ae{constructor(){v.init({project:$o});super();r(this,"reset",()=>{this.receiveAddressStore=new Rr(this),this.outerStore=new Vr(this),this.fromToStore=new Se(this),this.approveStore=new ce(this),this.quoteStore=new _e(this),this.tokenModalStore=new wo(this),this.safeMoonStore=new Ae(this),this.walletContractStore=new br(this),this.sendTransactionStore=new Or(this),this.intentSwapStore=new Lr(this),this.swapCheckStore=new qr(this),this.swapStore=new Te(this),this.swapBtnStore=new ge(this),this.mevStore=new Wr(this),this.recentTransactionStore=new lr(this),this.facetStore=new Mr(this),this.liquidityChooseStore=new Ie(this),this.swapDappStore=new Ee(this),this.smartRouterStore=new ir(this),this.slippageStore=new ye(this),this.oneMoreOrderStore=new Br(this)});this.reset()}},vo=Ve;r(vo,"instance",null),r(vo,"getInstance",()=>(Ve.instance||(Ve.instance=new Ve),Ve.instance));var Al=vo;var sm=({localeData:a,...t})=>{let e=(0,_l.useLocation)(),o;return e.pathname.includes(it)?o=y.BRIDGE:e.pathname.includes(ga)?o=y.LIMIT_ORDER:e.pathname===st&&(o=y.SWAP),Gr.default.createElement(Os,{localeData:a,isDev:!0,noRemoteData:!0},Gr.default.createElement(uu,{swapRootStore:Al,bridgeRootStore:Cl,initTab:o},Gr.default.createElement(Uu,{currentTab:o,...t})))};var yl=kt(sm);$l();ki();ee();Zl();Xl();Yl();u();l();var si=E(V());D();ee();var El=({visible:a,onClose:t,onChange:e,walletId:o})=>si.default.createElement(Rs,{visible:a,onClose:t,onChange:e,coinId:_i,walletId:o},si.default.createElement(Rs.Header,{title:Rt("extension_defi_top_header_title_select_address_type"),subTitle:Rt("extension_defi_popup_desc_new_address_default")}));u();l();var kl=E(V()),wl=E(Xc());ee();Zr();var vl=E(jr());var im=({walletId:a,txParams:t,onConfirm:e,onCancel:o})=>{let s=Sc(a),i=_c(Et,s?.walletId),n=kc({coinAmount:0,localType:Et,coinId:yi,fromAddr:i,walletId:s?.walletId,txSource:Do.DAPP}),c={localType:Et,params:{transaction:t},walletId:s?.walletId},d=Xi(async({networkFee:m})=>{let{raw_data:p,raw_data_hex:f,txID:g,visible:I}=t||{};try{let A=await pt().signCommonMessage(i,{type:"protobuf",message:JSON.stringify({txID:g,visible:I,raw_data:p,raw_data_hex:f})},Et),R=wl.default.address.fromHex((0,vl.get)(p,"contract[0].parameter.value.contract_address",i)),w=await Ac(Et,A);await n(A,{toAdr:R,txHash:w,serviceCharge:m}),e?.({txHash:w})}catch(A){e({error:A})}});return kl.default.createElement(Jc,{unapproved:c,onCancel:o,onConfirm:d})},bl=im;u();l();var bt=E(V()),Vl=E(Fi());var ql=E(td());D();u();l();var Ll=E(V());var ii=E(jl());ee();var nm=async(a={})=>{let{contractAddress:t,contractName:e,functionName:o,functionArgs:s}=a,{getRawTransaction:i}=await ts(),n={data:{type:es.CONTRACT_CALL,data:{contract:t,contractName:e,functionName:o,functionArgs:s}}};return await i(ii.Currency.Stx,n)},am=async(a={})=>{let{recipient:t,amount:e,memo:o}=a,{getRawTransaction:s}=await ts(),i={data:{type:es.TRANSFER,data:{to:t,amount:e,memo:o}}};return await s(ii.Currency.Stx,i)},cm=async(a={})=>a.txType===os.CONTRACT_CALL?nm(a):a.txType===os.STX_TRANSFER?am(a):"",Rl=async({transaction:a={},fromAddress:t,value:e})=>{let o=await cm(a);return(await tu({coinId:Ei,fromAddress:t,value:e,inputData:o}))?.gasLimit||"0"};u();l();var um=E(V());var Ol=E(od());ee();Zr();async function Nl(a,t){let e=async()=>await dr({coinId:Xr,address:a},{fromAddr:a,toAddr:""}),o=async d=>{let m=(0,Ol.default)(d,"info.nonce",0),p={type:Wi.MULTI_CONTRACT_CALL,nonce:m,maxFee:0,chainId:Fc.StarknetChainId.SN_MAIN,multiContractCallData:{from:a,calls:t}};return(await pt().signTransaction(p,a,Oo))?.signature},s=async d=>{let{data:m}=await mr({coinId:Xr,address:a,inputData:d});return m?.gasLimit},i=await e(),n=await o(i);return await s(n)}Jl();zl();ee();Ni();Zr();u();l();var Pl=E(id()),Dl=E(ed()),bo=E(jr()),Fl=E(Xc());ki();ee();Ni();function xl(a,t){return Fl.default.address.fromHex((0,bo.get)(a,"raw_data.contract[0].parameter.value.contract_address",t))}function Ml(a){return(0,bo.get)(a,"raw_data.contract[0].parameter.value.data","")}function Bl(a){let t=(0,bo.get)(a,"raw_data.contract[0].parameter.value.call_value"),e=(0,bo.get)(a,"raw_data.contract[0].parameter.value.amount","");return t||e}async function lm(a){let{data:t={}}=await vs({coinId:No,address:a},{fromAddr:a}),{info:e={}}=t;return e}async function dm(a,t){let{transaction:e,bizType:o,bizId:s=[],notReplaceBlockhash:i=!1}=a;if(!i){let{recentBlockhash:n,lastValidBlockHeight:c}=await lm(t);e.message.recentBlockhash=n,e.lastValidBlockHeight=c,s.forEach(d=>{let m=(0,Pl.mnemonicToSeed)(o,d),p=nn.fromSeed(m.slice(0,32));e.sign([p])})}return e}async function Ul(a,t){let e=await dm(a,t);return Dl.default.encode(e.serialize())}function qe(a){let t=Qe({netWorkId:String(a)}),e=t?.baseChain||"",o=t?.localType||"",s=t?.coinId||3,i=t?.realChainIdHex;return{baseCoinId:s,networkType:o,chainId:i,baseChain:e}}async function ni({networkId:a,address:t,data:e,tokenAddress:o}){let s={},{baseCoinId:i}=qe(a),n={coinId:i,address:t},c={fromAddr:t,value:"0"},d={address:t,inputData:e,coinId:i,value:"0",tokenAddress:o},{data:m}=await mr(d),{gasLimit:p}=m,{data:{info:f}}=await vs(n,c),g=f?.needExtFee||!1,I=f?.gasPrice||{},{normal:A,proposePriorityFee:R,supportEip1559:w}=I;if(!g)return s={maxFeePerGas:A,maxPriorityFeePerGas:R,gasPrice:A,gasLimit:p,supportEip1559:w,networkFee:Ke(A,p)},s;let q={from:t,to:o,data:e,value:xo(0),gasPrice:xo(A),gasLimit:xo(p)},K=Di(q),nt=wc(K),mt=await hc({coinId:i},{inputData:nt}),W=Po(Ke(A,p),mt);return s.networkFee=W,s.extFee=mt,s}function te(a,t){return Oi(Li(a,10**t))}var mm=({code:a,data:t,error_message:e,error:o})=>{if(a!==0||!t||t.queryGasLimitErrorUseDefault||o)return{fee:0,error:e};let{gasLimit:s="0"}=t;return{...t,fee:s,error:!1}};async function ai({walletId:a,coinId:t,fromAddr:e,tx:o}){let s=o[0],i=s?.messages||[],n=s?.network||1,c=i?.valid_until||Math.floor(Date.now()/1e3)+600,{address:d}=i[0]||{},m=await dr({coinId:t,address:e,toAddr:d,fromAddr:e}),p=m?.chainId,f=m?.info?.nonce,g=await iu({nonce:f,localType:ve,fromAddr:e,walletId:a,messages:i,network:n,validUntil:c}),I=JSON.stringify(g.stringInputParams),A=await nu({fromAddr:e,chainId:p,coinId:t,inputData:I}),R=mm(A),w={coinId:t,coinAmount:0,inputData:I,fromAdr:e,toAdr:d,serviceCharge:R?.fee,extJson:JSON.stringify({nonce:f}),txSource:Do.DEX,accountId:a,walletType:qi.IMPORT,transactionParams:g?.transactionParams};return{feeInfo:R,extParams:w}}var Wl=-42412,pm=-42418,hm=(0,ql.default)(bc,500);function Gl(a,t){let{baseCoinId:e}=qe(a),o=gc(t?void 0:e,void 0,t?{chainId:+a,address:t}:void 0),s=(0,bt.useRef)({coinAmount:0,coinAmountInt:0,currencyAmount:0,currencyAmountUSD:0});return Tc(o?.coinId)||s.current}async function fm({coinId:a=3},{gasInfo:t={},calldata:e}){let{networkFee:o,isNetworkFeeLoading:s,isGasLimitLoading:i}=t,n=s||i,{minGasFee:c}=vc(t),d=Ri(c),m=Ls(t,"swap"),p=await hm(a,e),f=m||p;return f===!0&&(f=Rt("swaptrade_extension_cinteraction_might_error")),{fee:d,feeInt:c,maxFeeInt:o,loading:n,error:f}}async function Sm(a,{decimals:t},{calldata:e}){let{transaction:o}=e,{fee:s}=await fc({coinId:No,address:a}),i;if(o){let m=ru(o);i=ou(o,m)}let n=await su([i]),c=Po(s,n);return{fee:te(c,t),feeInt:c}}async function gm(a,{decimals:t},{calldata:e}){let o=await eu({address:a,transaction:e});return{fee:te(o,t),feeInt:o}}async function Tm(a,{decimals:t},{calldata:e}){let o=await zc({address:a,inputData:Ml(e),toAddr:xl(e,a),value:Bl(e)});return{fee:te(o,t),feeInt:o}}async function Cm(a,{decimals:t},{calldata:e}){let o=Zc.from(e.transactionBlock);o.setSenderIfNotSet(a);let s=o?.blockData?.gasConfig?.budget||"0";return{fee:te(s,t),feeInt:s}}async function Im(a,{decimals:t},{calldata:e}){let o=await Rl({transaction:e,fromAddress:a,value:"0"});return{fee:te(o,t),feeInt:o}}async function Am(a,{decimals:t},{calldata:e}){let o=await Nl(a,e);return{fee:te(o,t),feeInt:o}}async function _m(a,{decimals:t,coinId:e,chainId:o},s,{calldata:i}){let n=await ai({walletId:s,fromAddr:a,coinId:e,chainId:o,tx:i}),c=n.feeInfo.fee,d=n.feeInfo.error;return{fee:te(c,t),feeInt:c,error:d}}function Hl(a,t){let e=ln(),{baseChain:o,baseCoinId:s}=qe(a),{baseCoin:i}=Cc(s,!0),n=bs(o),{symbol:c}=(0,Vl.useSelector)(Fo),d=dn(s)||0,[m,p]=(0,bt.useState)(0),[f,g]=(0,bt.useState)(0),[I,A]=(0,bt.useState)(0),[R,w]=(0,bt.useState)(!1),[q,K]=(0,bt.useState)(!1),nt=(0,bt.useMemo)(()=>{let mt=Ke(m,d);return{estimatedGasFeeInt:f,maxGasFeeInt:I,decimals:i?.decimals,currencyAmount:mt,currencySymbol:c,coinSymbol:i?.symbol,loading:R,error:q}},[i.decimals,i.symbol,c,q,f,I,R,d,a,t,t?.gasInfo?.isNetworkFeeLoading,t?.gasInfo?.isGasLimitLoading]);return Ji(()=>{async function mt(){let W={fee:0,feeInt:0};w(!0),K(!1);try{o===Yr?W=await fm(i,t):o===we?W=await Sm(n,i,t):o===Ci?W=await gm(n,i,t):o===Ii?W=await Cm(n,i,t):o===Et?W=await Tm(n,i,t):o===Ai?W=await Im(n,i,t):o===Oo?W=await Am(n,i,t):o===ve&&(W=await _m(n,i,e,t)),p(W.fee),g(W.feeInt),A(W.maxFeeInt||W.feeInt)}catch{p(0),g(0)}finally{w(!!W.loading),K(W.error)}}mt()},[a,t]),nt}async function ym({networkId:a,tx:t,hardwareExtParams:e,checkTxBeforePublish:o,currentWallet:s}){let i=t,{baseChain:n,chainId:c,baseCoinId:d}=qe(a);if(n===we){let{account:m}=s,p=m[we];return i.transaction=await Ul(t,p),{target:i}}if(n===Yr){if(Ls(t?.gasInfo,"swap"))throw new Error(Rt("wallet_home_toast_network_error"));let p=i.value||i.amount||0,f=qe(a).baseCoinId;i={...i,...i.gasInfo};let g=await o({...i,userGasInfo:i.gasInfo,coinId:f,amount:p,baseCoinAmountUse:p}),{nonce:I,updateGasInfo:A={}}=g||{};i.nonce=I,i.maxFeePerGas=A.maxFeePerGas||i.maxFeePerGas,i.maxPriorityFeePerGas=A.maxPriorityFeePerGas||i.maxPriorityFeePerGas,i.gasPrice=A.gasPrice||i.gasPrice;let R=await pt().getSelectedWallet(),w=await pt().generateFormatedTxParams(a,i),{dispatch:q}=e||{};return q&&(await q(an({txParams:w,walletId:R})),i.result=w.result,i.walletId=R),{target:i}}if(n===Ti){let m=await pt().getSelectedWallet(),p=await pt().generateFormatedTxParams(a,i),f=await cn(p,p.address,n,m);return i.result=f,i.walletId=m,{target:i}}if(n===ve){let{walletId:m,account:p}=s,f=p[ve],{extParams:g}=await ai({walletId:m,fromAddr:f,coinId:d,chainId:c,tx:t});return{target:i,extParams:g}}return{target:i}}async function ci({networkId:a,tx:t,hardwareExtParams:e,checkTxBeforePublish:o,currentWallet:s}){if(!t)throw new Error("tx is required");let i=t;try{let{target:n,extParams:c}=await ym({networkId:a,tx:t,hardwareExtParams:e,checkTxBeforePublish:o,currentWallet:s});return i=n,await pt().dexSignAndSubmitTransaction(a,i,c)}catch(n){throw n?.data?.originalError?(n.message=n?.data?.originalError?.error_message,n.code=Wl):n?.message===on?(n.message=Rt("wallet_extension_swap_error_hardware_not_support"),n.code=Wl):n.code=pm,n}finally{Jr()===zr&&pt().focusLastOkPopupWithCache()}}async function Ql(a,t){let e=t;try{return typeof t=="string"&&(e=JSON.parse(t)),await pt().dexSignTypedDataV4(a,e)}finally{Jr()===zr&&pt().focusLastOkPopupWithCache()}}var Kl=a=>{let{chainId:t}=Gi(a),e=rs(a).some(m=>rn(m.coinId)),o=e?Yi(a):rs(a),s;e?s=o.find(m=>m.realChainIdHex===t)||{}:s=o[0]||{};let i=Number(e?s.netWorkId:s.chainId),n=Hi(a),c=Ki(a);return{walletType:{isMNEMONIC:c[n].keyringIdentityType===oe.MNEMONIC,isPRIVATE:c[n].keyringIdentityType===oe.PRIVATE_KEY,isHARDWARE:c[n].keyringIdentityType===oe.HARDWARE,isMPC:c[n].keyringIdentityType===oe.MPC},chainId:i}};L.initSentry(mi,di,process.env.APP_VERSION);L.setGlobal({HARDWALLETERROR:en,getApiHostname:wi,getStaticHostname:vi,LocalStore:li,interceptorHeaders:bi,urlConfig:Pi,FeeTypeEnum:Vi,netWorkIdToLocalType:new Proxy({},{get(a,t){return Qe({netWorkId:String(t)})?.localType}}),localTypeToBaseCoinId:new Proxy({},{get(a,t){return Qe({localType:t})?.coinId}}),KeyringIdentityTypeEnum:oe,RegisterLocalStatusEnum:Ui,hexToDecimal:sn,signAndSubmitTransaction:ci,signTypedDataV4:Ql,getGasPrice:ni,checkMPCStatus:Rc,hooks:{useCoin:Gl,useUtxoListFn:Oc,useFeeDisplay:Hl,useRegisterStatus:xc,useGasReturnActivity:Ic,useSignInfo:Ec,useUtxoEstimateFee:Pc,useUtxoCheckBeforePublishFn:Nc,useUtxoSignAndPublishTransactionFn:Dc},components:{EvmConfirm:jc,TronConfirm:bl,EthereumNetworkFee:Lc,SupplyGas:yc,StarknetRegister:Hc,Affix:un,InteractiveAddress:qc,NetworkFeeEnter:Vc,ViewData:$c,SectionWrap:Wc,ModuleWrap:Bc,TipMessage:Gc,CoinSummary:Uc,UtxoNetworkFeePanel:Yc,Mev:Kc,Layout:Bi,SwitchAddress:El}});var Em=()=>{let a=(0,Qr.useHistory)(),{pathname:t}=(0,Qr.useLocation)(),e=(0,Lt.useSelector)(ji);return(0,Hr.useCallback)((o,s)=>{if(e&&s){a.replace(Zi);return}o()},[e,t])},pO=()=>{let a=(0,Lt.useDispatch)(),t=(0,Lt.useSelector)(Fo),e=(0,Lt.useSelector)($i),o=(0,Lt.useSelector)(xi),s=Mc(),i=(0,Lt.useSelector)(Qi),n=(0,Lt.useSelector)(Mi),c=(0,Lt.useSelector)(Kl),d=i.map(f=>{if(tn(f.initialType)){f=(0,Kr.cloneDeep)(f);try{delete f.account[we],delete f.account[Et]}catch{(0,Kr.noop)()}}return f}),m=Em(),p=Qc();return zi(()=>{L.updateGlobal({signAndSubmitTransaction:async(f,g,I)=>await ci({networkId:f,tx:g,hardwareExtParams:I,checkTxBeforePublish:p,currentWallet:e})})}),Hr.default.createElement(yl,{t:Rt,dispatch:a,onBack:m,currency:t,currentWallet:e,localeData:o,addressBookList:s,walletList:d,locale:n,walletInfo:c})};export{pO as default};

window.inOKXExtension = true;
window.ASSETS_BUILD_TYPE = "prepub";

//# sourceMappingURL=dex-K4DLOJLO.js.map
