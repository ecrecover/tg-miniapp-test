import{a as fe,b as me}from"./chunk-X5IVS2R5.js";import{a as ie}from"./chunk-G2V3XEUQ.js";import{a as ae,b as ce}from"./chunk-QR2WOQMM.js";import"./chunk-2P6KMQ6R.js";import{a as se}from"./chunk-PVE3B4RU.js";import"./chunk-636MHS2Q.js";import"./chunk-XJ4IKVPR.js";import{k as ne}from"./chunk-XE2F6LDQ.js";import"./chunk-REIQGNZB.js";import"./chunk-Q4CU3DV4.js";import{a as oe}from"./chunk-DSYZP5KR.js";import"./chunk-JMAKZZHS.js";import"./chunk-NZPUYPHL.js";import{a as O}from"./chunk-4QAFBCO2.js";import{a as re}from"./chunk-B553FNEQ.js";import"./chunk-6QKWDR6X.js";import"./chunk-S2GMXONU.js";import{a as C}from"./chunk-7XFZKU6W.js";import"./chunk-ZPDRUAGN.js";import"./chunk-WCH23YYN.js";import"./chunk-NZZFB6IS.js";import"./chunk-35PGDXR7.js";import"./chunk-PUO23DIP.js";import"./chunk-O2J764NL.js";import"./chunk-CDLW656Z.js";import"./chunk-3K3KMGWB.js";import"./chunk-5EZVDCYS.js";import"./chunk-475E6NBR.js";import"./chunk-RC5IAFKK.js";import"./chunk-4VLUHY4K.js";import"./chunk-IHPHPUUG.js";import"./chunk-ZEWK7OGU.js";import"./chunk-QVA4WXOQ.js";import"./chunk-EX22SDGB.js";import"./chunk-4RARGC4D.js";import"./chunk-OQOFXHGC.js";import"./chunk-3QA2SYRR.js";import"./chunk-3SC55VQ2.js";import{e as q,g as te}from"./chunk-VTLNAOHG.js";import"./chunk-Y7YPG2EJ.js";import"./chunk-7R67VE77.js";import"./chunk-NHGZUGLZ.js";import"./chunk-G5LEAVCY.js";import"./chunk-ACHWU2H6.js";import"./chunk-ZPFBKNRM.js";import"./chunk-7DP5LYUM.js";import"./chunk-BVXKJJ4A.js";import"./chunk-TBBE7OKY.js";import"./chunk-7HJDVUH5.js";import"./chunk-ADKEXOTG.js";import"./chunk-H7DITLB3.js";import"./chunk-DY54SY5O.js";import"./chunk-VQBK6IHT.js";import"./chunk-CTT7GD4C.js";import"./chunk-LQAOHG2H.js";import"./chunk-WNQ6F6VV.js";import"./chunk-LEADLFDQ.js";import"./chunk-DGK7TBBE.js";import"./chunk-6Y7ULJF6.js";import"./chunk-3YH3AGVS.js";import"./chunk-3LB7TUPB.js";import"./chunk-TK6JYPIW.js";import"./chunk-OS6E6KVM.js";import"./chunk-GZRBUDXF.js";import"./chunk-WY46TT4P.js";import"./chunk-MTMUCMTY.js";import"./chunk-S6N4IJX7.js";import"./chunk-ZD4EJWX6.js";import"./chunk-WGCZSWYA.js";import"./chunk-IINHHLHP.js";import"./chunk-DY2YURLY.js";import"./chunk-KXZSXP3G.js";import"./chunk-6HXVFU7V.js";import"./chunk-D5FMQLJG.js";import"./chunk-3I7UBQEQ.js";import"./chunk-DXRBY5MU.js";import"./chunk-6FR2UIE7.js";import"./chunk-5GMHHIH5.js";import"./chunk-7KCWBFQ2.js";import"./chunk-QLUP7GYN.js";import"./chunk-7Y44NCE5.js";import"./chunk-BKPOG6ZD.js";import"./chunk-OZMVWMFO.js";import"./chunk-KTO7CPX7.js";import"./chunk-P3XTPXPO.js";import"./chunk-S6TPD26J.js";import"./chunk-4IY6P5HR.js";import"./chunk-FQWGOLDH.js";import"./chunk-QEPBNPHF.js";import"./chunk-3JLS3TGD.js";import"./chunk-KDP5Z4RF.js";import"./chunk-W234FNSM.js";import"./chunk-DDO6HXRN.js";import"./chunk-CLWWTOKP.js";import"./chunk-KZ2PCELG.js";import"./chunk-C7ZG4INB.js";import"./chunk-J5ANWCEO.js";import"./chunk-VMO2INN3.js";import"./chunk-J4TF3RT7.js";import"./chunk-6FOZGMAL.js";import"./chunk-2MV3WEYP.js";import{y as _e}from"./chunk-HPXM6RSK.js";import{W as $,aa as b}from"./chunk-IUIJ46C3.js";import"./chunk-KZ3ZU675.js";import"./chunk-NJ5CWPUY.js";import{l as ee,p as ye}from"./chunk-UMJMJOW4.js";import"./chunk-YTJBYVBO.js";import"./chunk-QO3243S4.js";import"./chunk-O5JCC6KG.js";import{d as Z,f as Ie}from"./chunk-MAIAJ7GD.js";import"./chunk-4PGNX6E2.js";import"./chunk-DBHB6SUD.js";import"./chunk-I56VJWE4.js";import"./chunk-PS3S6BG3.js";import"./chunk-RT4Y2U5N.js";import"./chunk-2VHH444P.js";import"./chunk-RIMU4JTV.js";import"./chunk-MGLVPWSV.js";import"./chunk-TXKWPME2.js";import"./chunk-4D3M2I6W.js";import"./chunk-AMVK42SC.js";import"./chunk-D6RIE45O.js";import"./chunk-XCAARJ7Q.js";import"./chunk-JXCCIV3J.js";import"./chunk-AOA7NX2Y.js";import"./chunk-HXZH2DHB.js";import"./chunk-MZG4RHXJ.js";import"./chunk-VTST2UXT.js";import{Kb as Ee,m as we,qb as K,ra as N,za as X}from"./chunk-X7YMANPZ.js";import"./chunk-IRITFTWC.js";import{G as Y}from"./chunk-SOHTSUTI.js";import{I as Q,w as M}from"./chunk-RPZQDAIQ.js";import"./chunk-LDRI4AYU.js";import"./chunk-E24EBHFY.js";import"./chunk-V4F2JFTP.js";import{a as J}from"./chunk-6DDC4Y2S.js";import"./chunk-TEY24VZN.js";import"./chunk-RKHQOOTU.js";import"./chunk-KJOC4LFM.js";import"./chunk-6FDO4Y56.js";import"./chunk-NNZ5SU5W.js";import"./chunk-F4JTGWJH.js";import"./chunk-YUXYCITH.js";import"./chunk-RMV3AS5X.js";import"./chunk-SF2LTPAC.js";import"./chunk-TEKDZ77C.js";import"./chunk-NC54RUAI.js";import"./chunk-YR74Q3QD.js";import{f as k,m as l,o as d}from"./chunk-EQYVU4XP.js";l();d();var j=k(J());l();d();var p=k(J()),pe=k(_e());Q();ye();Ie();X();l();d();Ee();Q();var E=k(J());var V=k(we());var Se=({coinId:e,unapproved:F,paramsInfo:s})=>{let{coin:f,toAdr:a,fromAddr:t,walletId:o,messages:m,network:r,validUntil:R}=s,{chainId:g,localType:I}=f||{},{coinAmountInt:_}=te(e,s?.walletId)||{},D=O(),y=(0,E.useRef)(null),[T,w]=(0,E.useState)(!0),[i,S]=(0,E.useState)({}),[u,L]=(0,E.useState)({}),U=({code:A,data:n,error_message:c,error:P})=>{if(A!==0||!n||n.queryGasLimitErrorUseDefault||P)return{fee:0,feeError:!0,feeErrorMsg:c};let{gasLimit:h="0"}=n;return{...n,fee:h,feeError:!1,feeErrorMsg:""}};(0,E.useEffect)(()=>{try{(async()=>{if(w(!0),I&&e&&t&&o&&m){let n=await D({coinId:e,address:t,toAddr:a,fromAddr:t}),c=await fe({nonce:n?.nonce,localType:I,fromAddr:t,walletId:o,messages:m,network:r,validUntil:R});L({signInfo:n,sequence:n?.nonce,inputData:JSON.stringify(c?.stringInputParams),transactionParams:c?.transactionParams})}})()}catch(A){S({feeError:!0,feeErrorMsg:A?.message||M("wallet_extension_alert_estimate_unavailable_error")})}},[I,e,t,o,m]),(0,E.useEffect)(()=>((()=>{let{inputData:n}=u;w(!0);try{if(n){let c=async()=>{let h=await me({fromAddr:t,chainId:g,coinId:e,inputData:n}),ge=U(h);w(!1),S(ge)};(()=>{clearInterval(y.current),c(),y.current=setInterval(c,7e3)})()}}catch(c){w(!1),S({feeError:!0,feeErrorMsg:c.message})}})(),()=>{clearInterval(y.current)}),[u.inputData,g,t,e]);let G=(0,V.isNil)(_)||K(_,i?.fee),W=(0,V.isNil)(_)||K(_,0),B;return i?.feeError&&i?.feeErrorMsg&&(B=M("wallet_extension_alert_estimate_unavailable_error",{errorMsg:i.feeErrorMsg})),{networkFeeProps:{coinId:e,loading:T,estimateFailed:i?.feeError,estimateFailedMsg:B,networkFee:i?.fee},isSufficientGas:G,isSufficientBalance:W,extParams:{coinId:e,coinAmount:0,inputData:u?.inputData,fromAdr:t,toAdr:a,serviceCharge:i?.fee,extJson:JSON.stringify({nonce:u?.sequence}),txSource:2,accountId:F?.walletId,walletType:2,transactionParams:u?.transactionParams}}},ue=Se;l();d();X();function xe(e){let F=q(N)||{},{address:s,walletId:f}=C(e),a=e?.params?.transaction||{},t=a?.messages||[],o=a?.network||1,m=t?.valid_until||Math.floor(Date.now()/1e3)+600,{address:r}=t[0]||{};return{toAdr:r,coin:F,fromAddr:s,walletId:f,messages:t,validUntil:m,network:o}}var le=xe;l();d();var x=k(J());var Fe=({origin:e,walletId:F,localType:s})=>{let f=re(),[a,t]=(0,x.useState)(!0),{host:o}=se({origin:e}),m=C({walletId:F,localType:s}),[r,R]=(0,x.useState)({}),g=(0,x.useCallback)(async(D,y,T)=>{let w="";try{w=JSON.stringify(T)}catch{}let{coinId:i,chainId:S}=D,u=await f({coinId:i,checkTypes:[b.KYS,b.VERIFY_GAS_LIMIT],amount:0,from:m.address,to:"",txType:3,domain:o,tokenAddress:"",inputData:y,chainId:S,additionalData:{tonSignData:w}});R(u),t(!1)},[o,f,m.address]),I=(0,x.useMemo)(()=>({loading:a,...r[b.KYS]||{}}),[a,r]),_=(0,x.useMemo)(()=>r[b.VERIFY_GAS_LIMIT]||{},[r]);return{kysRet:I,loading:a,preExecute:g,preExecuteRet:r,verifyGasLimitRet:_}},de=Fe;var Ae=(0,p.memo)(({unapproved:e})=>{let F=(0,pe.useDispatch)(),s=q(N)||{},f=s?.coinId||N,{walletId:a}=C(e),t=oe(a),o=le(e),[m,r]=(0,p.useState)(!1),R=O(),{networkFeeProps:g,isSufficientGas:I,estimateFailed:_,estimateFailedMsg:D,isSufficientBalance:y,extParams:T}=ue({coinId:f,unapproved:e,paramsInfo:o}),{origin:w,localType:i}=e,S=de({origin:w,walletId:a,localType:i}),{inputData:u}=T,L=(0,p.useRef)(),{preExecute:U,kysRet:G,verifyGasLimitRet:W}=S,B=e?.params?.transaction||{};(0,p.useEffect)(()=>{s?.coinId&&!g?.loading&&!L.current&&(L.current=!0,U(s,u,B))},[s?.coinId,g?.loading,u]);let H=ce({kysRet:G,baseCoin:s,estimateFailed:_,estimateFailedMsg:D,isSufficientGas:I,isSufficientBalance:y,verifyGasLimitRet:W}),A=async()=>{r(!0),t({trade:"contract_interaction",all_confirmation:"confirm",network:e.localType,dapp_url:e.origin});try{let P=await R({coinId:f,address:o?.fromAddr,toAddr:o?.toAdr,fromAddr:o?.fromAddr}),h=await Z().approveDappRequest(e?.id,{...T,extJson:JSON.stringify({nonce:P?.nonce})});if(h.code===10009){Y.error(h?.msg||M("wallet_extension_failure_subtitle_fail_resend")),r(!1);return}await ee(F),r(!1)}catch(P){r(!1),Y.error(P?.msg||M("wallet_extension_failure_subtitle_fail_resend"))}},{buttonGroup:n,handleCancel:c}=ie({coinId:f,unapproved:e,preExecuteRet:S,feeLoading:g?.loading||m,isSufficientGas:I,isSufficientBalance:y,onConfirm:A});return ne({kysRet:G,handleCancel:c}),p.default.createElement(ae,{kysRet:G,unapproved:e,tipMessage:H,buttonGroup:n,networkFee:g})}),z=Ae;var pt=({unapproved:e})=>{switch(e.method){case $.SEND_TRANSACTION:return j.default.createElement(z,{unapproved:e});default:return j.default.createElement(z,{unapproved:e})}};export{pt as default};

window.inOKXExtension = true;
window.ASSETS_BUILD_TYPE = "prepub";

//# sourceMappingURL=Ton-ZUPKC42E.js.map
