import{a as ue,b as de}from"./chunk-AEQXVQW6.js";import{b as me}from"./chunk-W22RY77F.js";import{b as ee,f as oe,h as se,k as re,l as ne,p as ae,q as ie}from"./chunk-HTDEED7X.js";import{a as Qt}from"./chunk-JXXKPVB7.js";import{d as Xt}from"./chunk-3LOAATWV.js";import{a as ce}from"./chunk-ERRJFVON.js";import{c as le,d as tt,e as et,g as B}from"./chunk-SFY37WOS.js";import{a as $t,e as Y}from"./chunk-JFCE4WMN.js";import{b as te}from"./chunk-TCY2QN26.js";import{e as Q}from"./chunk-Z7MVEL6Q.js";import{c as Jt}from"./chunk-BSJ5U7SB.js";import{i as Gt,l as Zt,m as qt}from"./chunk-JZYFGUUR.js";import{f as gt}from"./chunk-GEYEJT2N.js";import{b as yt}from"./chunk-LWWOGE47.js";import{q as Tt,r as Kt}from"./chunk-OL5PZGTP.js";import{d as _t}from"./chunk-W3BHXSAD.js";import{b as pt}from"./chunk-ZQ5A3KPQ.js";import{a as Vt}from"./chunk-BGUY7SH3.js";import{w as b}from"./chunk-MJYAUOKI.js";import{l as Rt,o as Ht,y as zt}from"./chunk-FCCCJLF6.js";import{a as X}from"./chunk-4Z4GXCHB.js";import{y as ve}from"./chunk-FK3ETA6I.js";import{X as K,b as $,fa as jt}from"./chunk-QZDHFNHK.js";import{a as Ye}from"./chunk-EJQOS3F4.js";import{c as w}from"./chunk-4QSQKIBZ.js";import{b as Z,c as Mt}from"./chunk-OXVQDEZW.js";import{j as G,m as Wt}from"./chunk-X3G52GGX.js";import{Jc as vt,Tc as J,Zc as Yt,a as St,b as Ue,m as We,q as Ut,uc as q,za as Me}from"./chunk-QG673PNL.js";import{F as Dt,c as kt,n as Ot}from"./chunk-6MTHEPGF.js";import{I as V,m as P,w as d}from"./chunk-ZQQ7HNWV.js";import{a as W}from"./chunk-ADZWCU3Q.js";import{f as C,m as i,o as l}from"./chunk-REC7XVZY.js";i();l();var t=C(W()),we=C(ve()),Ee=C(Ye());var Fe=C(We());V();i();l();var x=C(W());V();i();l();var fe={list:"_list_shbob_1"};var je=({coinId:e,value:n,visible:c,onToggleVisible:p,options:o,onChange:m})=>{let A=Q(e),y=f=>{let{addressType:E,address:N,canTransferAmount:_}=f;return x.default.createElement(_t.Card,{selected:n?.address===N,onClick:()=>{p?.(),m?.(f)}},x.default.createElement(w.Box,{style:{width:"100%"}},x.default.createElement(w.FlexBox,{justify:"space-between",align:w.ALIGN.center},x.default.createElement(b.Text,{strong:!0},d(q[E])),x.default.createElement(b.DisplayAmount,{strong:!0,mode:b.CRYPTO,decimals:A?.decimals},_)),x.default.createElement(w.FlexBox,{justify:"space-between",align:w.ALIGN.center},x.default.createElement(b.Address,{address:N,desensitize:!0,copyable:!1,size:b.SIZE.sm,type:b.TYPE.secondary}),x.default.createElement(b.Text,{type:b.TYPE.secondary,size:b.SIZE.xs},d("nftmarket_general_wallet_label_available")||"Available BTC"))))};return x.default.createElement(Ot,{visible:c,alignBottom:!0,noTopRadius:!1,windowStyle:{width:"100%"},title:d("btcnft_gas_title_pay_gas_with"),onClose:p},x.default.createElement(_t,{space:16,dataSource:o,renderItem:y,className:fe.list}))},pe=je;i();l();Ue();var ye=C(W()),Re=()=>(0,ye.useCallback)(({value:e,message:n,reportParams:c})=>{try{St.captureEvent({message:n,contexts:{report:{info:JSON.stringify(c)}},exception:{values:[{type:"BIZ_ERROR_btcPayWalletAddress",value:e}]},level:"warn"})}catch(p){console.log(p)}},[]),_e=Re;i();l();var j=C(W());Wt();Mt();function He(e,n,c){let[p,o]=(0,j.useState)(c),[m,A]=(0,j.useState)([]);return(0,j.useEffect)(()=>{(async()=>{try{if(!c)return;let f=await G(Z.checkDustForBtcTx,{inscriptionIds:n,targetAddress:e,scene:24});A(f?.data?.dustInscriptionIds||[])}finally{o(!1)}})()},[c,e,n]),{isDustLoading:p,dustError:m.length>0}}var Te=He;i();l();var ge=C(W());V();var ze=({isMpcWallet:e,isHardware:n,feeError:c,isSufficientGas:p,dustError:o,transferReminder:m})=>({tipMessageProps:(0,ge.useMemo)(()=>e?{type:B.TIP_TYPE.COMMON_ERROR,message:d("extension_wallet_contractual_interaction_wallet_unavailable")}:n?{type:B.TIP_TYPE.COMMON_ERROR,message:d("wallet_extension_top_toast_dapp_comingsoon")}:c?{type:B.TIP_TYPE.FEE_ERROR}:p?o?{type:B.TIP_TYPE.COMMON_ERROR,message:d("wallet_info_dialog_dust_limit_individually")}:{type:kt.TYPE.warn,message:m}:{type:jt.FEE_BALANCE_INSUFFICIENT},[c,e,n,p,o,m])}),xe=ze;i();l();Wt();Mt();var Ve=e=>{let{loading:n,data:c}=Rt(async()=>(await G(Z.batchBtcNftDetail,{inscriptionIdProtocols:Array.isArray(e)?e:[e]}))?.data?.details||[]);return[n,c||[]]},Ae=Ve;i();l();var xt=C(W());V();Me();var Ge=7*1e3,Ze=({walletId:e,coinId:n,satBytes:c,needFilteredUtxo:p})=>{let o=Gt(e),m=(0,xt.useMemo)(()=>o?.addressType?.[Ut]||[],[o?.walletId]),[A,y]=re({coinId:n,walletId:e,satBytes:c,addressList:m?.map(({address:E})=>E),needFilteredUtxo:p},{pollingInterval:Ge,ready:!!p?.length&&!!c}),f=(0,xt.useMemo)(()=>m.map((N,_)=>({...N,canTransferAmount:y[_]}))?.sort((N,_)=>{let ot=P.sub(_.canTransferAmount,N.canTransferAmount);return Number(ot)}),[y,m]);return[A,f]},Ie=Ze;i();l();var At={"nft-transfer__extend":"_nft-transfer__extend_1bjoo_1",nftTransferExtend:"_nft-transfer__extend_1bjoo_1","nft-transfer__icon":"_nft-transfer__icon_1bjoo_4",nftTransferIcon:"_nft-transfer__icon_1bjoo_4"};var be={Ordinals:"Ordinals",Atomicals:"Atomicals"},Ne=2,Ce="NFT",Ls=({unapproved:e})=>{let n=e?.walletId,c=e?.localType,o=Jt({localType:c})?.coinId,m=Q(o),A=qt(n),y=e.params.transfer.from,f=e.params.transfer.to,{feeRate:E}=e.params.transfer.options||{},N=_e(),[,_]=Qt({coinId:o,address:y,chainId:m?.chainId}),ot=_?.transferReminder,[It,R]=zt({payWallet:!1,networkFee:!1}),[F,bt]=(0,t.useState)(E&&typeof E=="number"?{satBytes:E,level:K.CUSTOM}:{satBytes:_?.normal,level:K.STANDARD});(0,t.useEffect)(()=>{!F?.satBytes&&_?.normal&&bt({satBytes:_?.normal,level:K.STANDARD})},[_,F]);let H=e.params.transfer.data,S=Array.isArray(H)&&H.length>1,{isDustLoading:Nt,dustError:st}=Te(f,H,S),[,a]=Ae(H),M=(0,t.useMemo)(()=>{if(!Array.isArray(a)||!a?.length)return;let[{protocol:r}]=a||[];if(r===be.Atomicals)return J.ARC_20},[a]),rt=(0,t.useMemo)(()=>a.map(r=>`${r.btcNftUtxoDetail?.txId}-${r.btcNftUtxoDetail?.outputIndex}`),[a]),[Ct,k]=Ie({coinId:o,walletId:n,needFilteredUtxo:rt,satBytes:F?.satBytes}),[s,nt]=(0,t.useState)({}),[at,{toggle:he}]=Ht(!1);(0,t.useEffect)(()=>{let r=k?.[0];if((0,Fe.isEmpty)(s)&&!!r&&r?.canTransferAmount&&nt(r),k&&s.address&&s?.canTransferAmount){let u=k.find(({address:T})=>T===s?.address);u||N({value:u,reportParams:{payWallet:s,payWallets:k},message:`payWallet address get ${u}`}),u&&nt(u)}},[N,s,k]);let v=(0,t.useMemo)(()=>a.map(r=>{let{tokenId:u,protocol:T}=r,{txId:D,outputIndex:U,outputValue:De}=r?.btcNftUtxoDetail||{},Bt={txHash:D,nftId:r.tokenId,status:1,address:y,vout:Number(U),coinAmount:Number(De),resourceUrl:r?.resourceUrl};return T===be.Atomicals&&Object.assign(Bt,{data:[{atomicalId:u,type:Ce,amount:1}]}),Bt}),[y,a]),wt=(0,t.useMemo)(()=>a.map(r=>{let u=r?.tokenId,{outputValue:T}=r?.btcNftUtxoDetail||{},D=Number(T);S||(D=P.lt(T,546)?546:Number(T));let U={amount:D,address:f};return M===J.ARC_20&&Object.assign(U,{data:[{atomicalId:u,type:Ce,amount:1}]}),U}),[S,a,M,f]),it=(0,t.useMemo)(()=>{if(!S){let{outputValue:r=0}=a?.[0]?.btcNftUtxoDetail||{};if(r<546)return P.sub(546,r)}return 0},[S,a]),[lt,g,z]=ae({coinId:o,protocolId:M,toAddr:f,coinAmount:it,fromAddr:s?.address,satBytes:F?.satBytes,utxoParams:{satBytes:F?.satBytes,needFilteredUtxo:rt},canTransferAmount:s?.canTransferAmount,inputs:v,outputs:wt},{ready:!!v?.length}),ct=S?$.BTC_NFT_BULK_SEND:$.SEND_NFT,Et=ie({coinId:o,walletId:n,protocolId:M,coinAmount:0,toAddr:f,fromAddr:y,changeAddr:s?.address,localType:m?.localType,dustSize:M===J.ARC_20?void 0:_?.minOutput,networkFee:g,satBytes:F.satBytes,inputs:v,outputs:wt}),mt=a.map(({tokenId:r})=>r),Le=JSON.stringify({nftIds:mt,from:y,to:f,serviceCharge:g,gasFrom:s?.address}),Ft=Xt({coinId:o,txType:ct,walletId:n,coinAmount:0,fromAddr:y,toAddr:f,networkFee:g,localType:m?.localType,extJson:Le,txSource:vt.NFT}),ht=se({coinId:o,walletId:n,address:s.address,utxoType:ee.TRANSFER,satBytes:F?.satBytes,needFilteredUtxo:rt}),I=(0,we.useDispatch)(),L=(0,Ee.useHistory)(),Lt=ne({coinId:o,txType:$.SEND_NFT,protocolId:Yt(m?.chainId),address:s.address}),ut=a?.length,Pe=(0,t.useMemo)(()=>(a?.slice(0,at?ut:Ne)).map(({resourceUrl:u,name:T})=>({title:T,icon:{src:u}})),[a,at,ut]),O=(0,t.useMemo)(()=>!(s?.canTransferAmount&&P.lt(s?.canTransferAmount,P.add(g,it))),[g,it,s?.canTransferAmount]),Be=Zt(n),[Se,dt]=(0,t.useState)(!1),ft=(0,t.useCallback)(async()=>{e.id?(await I(Tt(e.id)),await I(yt()),L.push(X)):(I(gt()),O?L.goBack():L.replace(X)),dt(!1)},[I,L,O,e.id]),{tipMessageProps:ke}=xe({isHardware:A,feeError:z,isSufficientGas:O,dustError:st,transferReminder:ot}),Pt=(0,t.useCallback)(async()=>{if(!await te({walletId:n,callback:async()=>{await I(Tt(e.id))}}))return;let u=await ht(0,g);await Lt([...v,...u],ft),dt(!0);let T=await Et({utxoList:[],utxos:[{address:s.address,inputs:oe(u)}]}),D=await $t(m?.localType,T);try{e.id?(await I(Kt(e.id,{txHash:D,signedTx:T,serviceCharge:g,gasFrom:s.address,txType:ct,nftIds:mt})),await I(yt())):(await Ft(T),I(gt()),Dt.success({title:d("wallet_transfer_notif_transaction_submit")})),L.push(X)}catch(U){console.log(U)}finally{dt(!1)}},[ft,Lt,m?.localType,I,g,ht,L,O,mt,s.address,Ft,Et,v,ct,e.id]),Oe=(0,t.useMemo)(()=>{let r={actionType:Y.ACTION_TYPE.CANCEL,btnText:d("wallet_dapp_connection_btn_reject"),onClick:ft},u={disabled:Ct||lt||z||A||!Number(g)||!a?.length||Nt||st,actionType:Y.ACTION_TYPE.CONFIRM,onClick:Pt};return O||(u={coinId:o,walletId:n,address:s?.address,actionType:Y.ACTION_TYPE.FILL_UP}),[r,u]},[Ct,lt,z,A,g,a?.length,Pt,O,e.id,I,L,o,n,s?.address,Nt,st]);return t.default.createElement(w.Box,null,t.default.createElement(tt,null,t.default.createElement(le,{space:24,title:d("wallet_extension_send_colored_send"),summaryList:Pe}),ut>Ne&&t.default.createElement(w.FlexBox,{justify:"center",className:At["nft-transfer__extend"],onClick:he},t.default.createElement(pt,{size:pt.SIZE.xs,className:At["nft-transfer__icon"],icon:at?"okds-arrow-chevron-up-md":"okx-wallet-plugin-add-arrow-chevrons"}))),t.default.createElement(tt,null,t.default.createElement(et,{walletId:n,address:y,title:d("extension_send_mid_text_from")}),t.default.createElement(et,{address:f,title:d("extension_send_mid_text_to")})),t.default.createElement(tt,null,t.default.createElement(ce,{coinId:o,loading:lt,estimateFailed:z,networkFee:g,onClick:()=>{R({networkFee:!0})}}),t.default.createElement(et,{copyable:!1,address:s?.address,addressType:s?.addressType,title:d("btcnft_gas_label_pay_gas_with"),tags:[d(q[s?.addressType])],onClick:()=>{R({payWallet:!0})}},t.default.createElement(ue,{coinBalance:s.canTransferAmount,coinId:o}))),t.default.createElement(pe,{coinId:o,value:s,options:k,visible:It.payWallet,onChange:nt,onToggleVisible:()=>{R({payWallet:!1})}}),t.default.createElement(Vt,{offsetBottom:0,placeholder:!0,borderTop:!0},t.default.createElement(B,{coinId:o,...ke}),t.default.createElement(Y,{buttonGroup:Oe})),t.default.createElement(me,{coinId:o,signInfo:_,visible:It?.networkFee,value:F,estimatedFee:g,onChange:bt,onToggleVisible:()=>{R({networkFee:!1})}}),t.default.createElement(de,{visible:Be&&Se}))};export{Ls as a};

window.inOKXExtension = true;
window.ASSETS_BUILD_TYPE = "prepub";

//# sourceMappingURL=chunk-QTGHH5WR.js.map
