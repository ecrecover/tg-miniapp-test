import{a as Mt}from"./chunk-BITK2ZRS.js";import{a as Z}from"./chunk-PCT6WF3F.js";import"./chunk-7G3IOU2S.js";import"./chunk-FSSAJWUE.js";import"./chunk-EYUJFPID.js";import"./chunk-QXSGLFJ4.js";import"./chunk-RQ4URFJV.js";import"./chunk-A7QDOMG2.js";import"./chunk-PCN4TJH3.js";import"./chunk-UV4CBWDM.js";import{i as Ot}from"./chunk-JZYFGUUR.js";import"./chunk-ITV6J4J2.js";import"./chunk-E4R5GU2A.js";import{a as Q}from"./chunk-LM5IFABF.js";import{k as Pt}from"./chunk-XJYYUVAC.js";import{a as wt,b as kt,c as vt}from"./chunk-LQ6EG3M7.js";import"./chunk-X6MJ7FAJ.js";import{p as j}from"./chunk-OL5PZGTP.js";import"./chunk-T6BAWHSV.js";import{c as k,d as ht,f as Nt}from"./chunk-NZFRZUU7.js";import"./chunk-IY5XPXLD.js";import"./chunk-N6T7YZKN.js";import"./chunk-CE2I3GSK.js";import"./chunk-SPMBQ3GG.js";import"./chunk-WWF4GAYE.js";import"./chunk-YITM3H6Z.js";import"./chunk-IQFXZKFW.js";import"./chunk-7BFUGHAL.js";import{h as Ct}from"./chunk-JVN7YJ6W.js";import"./chunk-VSX7BSN7.js";import{a as yt}from"./chunk-V4V6C6NY.js";import"./chunk-ZQ5A3KPQ.js";import{a as W}from"./chunk-BGUY7SH3.js";import{w as u}from"./chunk-MJYAUOKI.js";import"./chunk-LI3NFLG3.js";import"./chunk-FCCCJLF6.js";import{C as At,b as F}from"./chunk-4Z4GXCHB.js";import{Ib as St,Jb as z,db as V,y as lt}from"./chunk-FK3ETA6I.js";import"./chunk-QZDHFNHK.js";import"./chunk-6KPQELH2.js";import{a as Et}from"./chunk-EJQOS3F4.js";import"./chunk-LHHZ5TAA.js";import"./chunk-PI6QLVMS.js";import"./chunk-QY4HIIR3.js";import"./chunk-XFWUEPSK.js";import{d as g,f as K}from"./chunk-MNNY2ODL.js";import"./chunk-VCAWL4NW.js";import{a as zt}from"./chunk-SZQYZ4EU.js";import"./chunk-T2OWRX3Y.js";import"./chunk-C3FJ2D4V.js";import"./chunk-C5ZJZEPI.js";import"./chunk-LGHM3MOC.js";import{g as xt}from"./chunk-2FULUWWG.js";import{a as Y}from"./chunk-SLEUZTBQ.js";import"./chunk-4X6ZAX3L.js";import{c as w}from"./chunk-4QSQKIBZ.js";import"./chunk-OXVQDEZW.js";import"./chunk-X3G52GGX.js";import"./chunk-WUKT6J7S.js";import"./chunk-FTJCOLFJ.js";import{Hc as It}from"./chunk-QG673PNL.js";import"./chunk-ZUFARSFM.js";import{F as ct,I as q,d as gt,n as at}from"./chunk-6MTHEPGF.js";import{I as it,w as n}from"./chunk-ZQQ7HNWV.js";import"./chunk-Y62GSKHT.js";import"./chunk-2BXFMFMK.js";import"./chunk-N3DB7H6L.js";import"./chunk-YVYBAMPE.js";import{S as U,Y as T}from"./chunk-ZOQTSYT4.js";import{a as A}from"./chunk-ADZWCU3Q.js";import"./chunk-FDI7TLXH.js";import"./chunk-L4HTIIR6.js";import"./chunk-733NI6T7.js";import"./chunk-EYWGNJVY.js";import"./chunk-EZI7EDH6.js";import"./chunk-BDEVQ2S7.js";import"./chunk-EWYZZSY3.js";import"./chunk-7K7BCLRD.js";import"./chunk-WELSRPTB.js";import"./chunk-7TSJ7C24.js";import"./chunk-DW2DZMT3.js";import"./chunk-C672KFBI.js";import"./chunk-YSXN7JDZ.js";import"./chunk-TBVIGR5T.js";import"./chunk-FHQVMQUK.js";import"./chunk-XNS2NFYY.js";import{f as d,m as o,o as r}from"./chunk-REC7XVZY.js";o();r();var Wt=d(Et()),c=d(A()),nt=d(lt());K();it();o();r();var $={container:"_container_1on3b_1",main:"_main_1on3b_7",title:"_title_1on3b_10",subTitle:"_subTitle_1on3b_17",qrCode:"_qrCode_1on3b_23",scanImg:"_scanImg_1on3b_27",scanTip:"_scanTip_1on3b_31",notHaveWalletImg:"_notHaveWalletImg_1on3b_35",notHaveWalletTitle:"_notHaveWalletTitle_1on3b_40",notHaveWalletSubTitle:"_notHaveWalletSubTitle_1on3b_47",scanStatusTip:"_scanStatusTip_1on3b_50",loadingContainer:"_loadingContainer_1on3b_54"};o();r();var X=d(A());K();var mt=d(lt());o();r();K();var G=d(A()),M=()=>{let[t,i]=(0,G.useState)(null);return(0,G.useEffect)(()=>{(async()=>{let a=await g().getMpcToken();i(a)})()},[]),t};var p={IMPORTED:"IMPORTED",NOT_CREATE:"NOT_CREATE",NOT_IMPORTED:"NOT_IMPORTED",TOKEN_EXPIRED:"TOKEN_EXPIRED",ACCOUNT_MISMATCH:"ACCOUNT_MISMATCH",VERIFY_PASS:"VERIFY_PASS",RECOVER:"RECOVER"},bt=()=>{let t=M(),i=(0,mt.useSelector)(St),a=(0,mt.useSelector)(z),[l,e]=(0,X.useState)(null);return(0,X.useEffect)(()=>{!t||(async()=>{try{let{data:m}=await kt({},{headers:{Authorization:t}}),{mpcId:_}=m;switch(i){case k.VERIFY:{let f=await g().getMpcIdByWalletId(a);e({...m,accountStatus:f!==_?p.ACCOUNT_MISMATCH:p.VERIFY_PASS});break}case k.RECOVER:{if(_)try{await g().checkMpcIdIsImported(_),e({...m,accountStatus:p.RECOVER})}catch{e({...m,accountStatus:p.IMPORTED})}else e({...m,accountStatus:p.NOT_CREATE});break}case k.IMPORT:case k.NO_ACTION:{if(_)try{await g().checkMpcIdIsImported(_),e({...m,accountStatus:p.NOT_IMPORTED})}catch{e({...m,accountStatus:p.IMPORTED})}else e({...m,accountStatus:p.NOT_CREATE});break}default:break}}catch{e({accountStatus:p.TOKEN_EXPIRED})}})()},[t]),{accountInfo:l}};o();r();var P=d(A());o();r();var J={img:"_img_18f4s_1",title:"_title_18f4s_6",text:"_text_18f4s_13"};var tt=({text:t,title:i,footer:a})=>{let l=xt({dark:"/cdn/assets/imgs/246/3CD5B03CE6E2FC68.png",light:"/cdn/assets/imgs/246/F1105B2119166F9E.png"});return P.default.createElement(P.default.Fragment,null,P.default.createElement("img",{className:J.img,src:l,alt:"not-have-wallet"}),P.default.createElement(u.Text,{className:J.title,align:u.ALIGN.center},i),P.default.createElement(u.Text,{size:u.SIZE.sm,align:u.ALIGN.center,className:J.text},t),a)};o();r();var b=d(A());it();o();r();var _t={main:"_main_1on04_1",title:"_title_1on04_5"};var Lt=()=>{let t=Y(),i=Q(),a=Z(),l=()=>{globalThis.open(a.download||`https://${i}/download`)};return b.default.createElement(W,{offsetBottom:0},b.default.createElement(w.FlexBox,{className:_t.main,align:w.ALIGN.center},b.default.createElement(gt,{width:32,height:32,alt:"",src:`${t}/cdn/assets/imgs/237/A229988567261685.png`}),b.default.createElement(u.Text,{size:u.SIZE.md,className:_t.title},n("extension_wallet_qr_title_app_download")),b.default.createElement(T,{type:T.TYPE.highlight,size:T.SIZE.xs,onClick:l},n("extension_wallet_qr_btn_download"))))};o();r();var s=d(A()),B=d(lt()),Rt=d(Et());it();var ot=d(zt());K();o();r();var C=d(A());var Yt=3e3,S={SCAN_NOT:-1,SCAN_SUCCESS:0,SCAN_FAIL:1,SHARE2_UPLOADED:2,SHARE2_UPLOAD_FAIL:3,NET_WORK_ERROR:"NET_WORK_ERROR"},Dt=(t,i)=>{let[a,l]=(0,C.useState)({status:S.SCAN_NOT}),e=M(),m=(0,C.useRef)(null),_=()=>{m.current&&clearInterval(m.current),l({status:S.SCAN_NOT})},f=(0,C.useCallback)(async()=>{try{let{data:I}=await wt({pubKey:t},{headers:{Authorization:e}}),{status:y,cipherText:O,mpcId:h}=I;l({status:y,cipherText:O,mpcId:h})}catch{l({status:S.NET_WORK_ERROR})}},[t,e]);return(0,C.useEffect)(()=>!t||!i?.mpcId?()=>{_()}:(f(),m.current=setInterval(async()=>{await f()},Yt),()=>{_()}),[t,e,i?.mpcId]),{scanInfo:a,clear:_}};o();r();var x=d(A());o();r();var et={scanImg:"_scanImg_r7slg_1",scanStatusTip:"_scanStatusTip_r7slg_5",loadingTip:"_loadingTip_r7slg_9"};var L=({onClick:t=()=>{},imgSrc:i,text:a,loading:l=!1})=>{let e=Y();return x.default.createElement(w.FlexBox,{onClick:t,direction:w.DIRECTION.vertical,align:w.ALIGN.center},l?x.default.createElement(x.default.Fragment,null,x.default.createElement(U.Circle,{size:U.SIZE.lg}),x.default.createElement(u.Text,{className:et.loadingTip,size:u.SIZE.sm},a)):x.default.createElement(x.default.Fragment,null,x.default.createElement("img",{className:et.scanImg,src:`${e}${i}`,alt:"scan-status"}),x.default.createElement(u.Text,{className:et.scanStatusTip,size:u.SIZE.sm},a)))};o();r();var v={container:"_container_7ejxx_1",main:"_main_7ejxx_7",title:"_title_7ejxx_10",subTitle:"_subTitle_7ejxx_17",qrCode:"_qrCode_7ejxx_23",scanImg:"_scanImg_7ejxx_28",scanTip:"_scanTip_7ejxx_32",scanStatusTip:"_scanStatusTip_7ejxx_36"};var Qt="okx_mpc:",Zt=({accountInfo:t,userInfo:i})=>{let a=(0,Rt.useHistory)(),l=(0,B.useDispatch)(),[e,m]=(0,s.useState)(!1),[_,f]=(0,s.useState)({}),[I,y]=(0,s.useState)(!1),O=(0,B.useSelector)(V),h=(0,B.useSelector)(z),st=Ot(h),{scanInfo:D,clear:pt}=Dt(_.publicKey,t),Bt=i?.email||"",ut=async()=>{m(!0),y(!1);let R=Mt();try{let N=await R.exec("genRsaPair");f(N)}catch{y(!0)}finally{m(!1)}};(0,s.useEffect)(()=>{ut()},[]);let Ht=(0,s.useMemo)(()=>{if(_.publicKey&&i.uuid){let R={publicKey:_.publicKey,time:Date.now(),uId:i.uuid},N=(0,ot.AesEncodeQRCodeInfo)(JSON.stringify(R),i.uuid);return`${Qt}${N}`}return""},[_,i.uuid]),H=async()=>{pt(),ut()},qt=(0,s.useCallback)(()=>{if(I)return s.default.createElement(L,{onClick:H,imgSrc:"/cdn/assets/imgs/237/C31554E48A2A20D8.png",text:n("extension_wallet_qr_text_refresh_qr_code")});if(e)return s.default.createElement(L,{loading:!0,onClick:H,text:n("extension_wallet_qr_text_loading")});switch(D.status){case S.SCAN_SUCCESS:return s.default.createElement(L,{imgSrc:"/cdn/assets/imgs/237/0929F8643613BD4F.png",text:n("extension_wallet_qr_text_confirm_mobile")});case S.SCAN_FAIL:case S.SHARE2_UPLOAD_FAIL:return s.default.createElement(L,{onClick:H,imgSrc:"/cdn/assets/imgs/237/C31554E48A2A20D8.png",text:n("extension_wallet_qr_text_sync_failed")});case S.NET_WORK_ERROR:return s.default.createElement(L,{onClick:H,imgSrc:"/cdn/assets/imgs/237/C31554E48A2A20D8.png",text:n("extension_wallet_qr_text_network_failed")});case S.SHARE2_UPLOADED:default:return null}},[D,I,e]);return(0,s.useEffect)(()=>{(async()=>{let{status:R,cipherText:N,mpcId:ft}=D;if(R===S.SHARE2_UPLOADED){let{phone:Kt="",approvedPetname:dt=""}=i,Tt={approvedPetname:dt,phone:Kt,email:Bt,walletName:dt};if(l(j.setKeepOpen({show:!0})),O){let Vt=await(0,ot.RSADecodeQRCodeInfo)(N,_.privateKey);await g().importMpcWallet({share2:Vt,mpcId:ft,userInfo:Tt}),t.accountStatus===p.RECOVER&&st?.status?.mpcStatus===Nt.RECOVER&&st?.keyringIdentityType===It.MPC&&(console.log("recover wallet:",h,st),await l(Ct(h))),a.push(F)}else await l(Pt({cipherText:N,privateKey:_.privateKey,mpcId:ft,userInfo:Tt})),a.push(At);pt()}})()},[D,_]),s.default.createElement(s.default.Fragment,null,s.default.createElement(q,{className:v.qrCode,level:q.LEVEL.Q,text:Ht,type:q.TYPE.svg,size:232,cornersDotOptions:{type:"dot"},cornersSquareOptions:{type:"dot"},dotsOptions:{type:"dots"},mask:D.status!==S.SCAN_NOT||I||e,renderMaskCon:qt}))},jt=({accountInfo:t,userInfo:i={},accountName:a})=>s.default.createElement("div",{className:v.container},s.default.createElement("div",{className:v.main},s.default.createElement("div",{className:v.title},n("extension_wallet_qr_title_sync_wallet")),s.default.createElement("div",{className:v.subTitle},n("extension_wallet_qr_subtitle_scan_confirm",{acctname:a})),s.default.createElement(Zt,{accountInfo:t,userInfo:i}),s.default.createElement(u.Text,{className:v.scanTip,size:u.SIZE.sm,align:u.ALIGN.center},n("extension_wallet_qr_text_operational_tips")))),Ut=jt;o();r();var rt=d(A());var Ft=()=>{let t=M(),[i,a]=(0,rt.useState)({userInfo:null});return(0,rt.useEffect)(()=>{!t||(async()=>{try{let{data:l,code:e}=await vt({},{headers:{Authorization:t}});a({userInfo:l,code:e})}catch{a({userInfo:{}})}})()},[t]),i};var $t=()=>{let t=(0,Wt.useHistory)(),i=Q(),a=Z(),l=(0,nt.useDispatch)(),{userInfo:e,code:m}=Ft(),_=(0,nt.useSelector)(V),{accountInfo:f}=bt(),I=(0,c.useMemo)(()=>e?.phone||e?.email||"",[e]);(0,c.useEffect)(()=>{f&&e&&(f?.accountStatus===p.VERIFY_PASS?(ct.success({title:n("extension_wallet_error_toast_verification_successful")}),l(j.setKeepOpen({show:!0})),g().setMpcAction("",""),t.push(F)):m===0&&ct.success({title:n("extension_wallet_qr_toast_login_successful",{acctname:I})}))},[f,e,I,m]);let y=async()=>{g().setMpcAction("","")};if((0,c.useEffect)(()=>(window.addEventListener("beforeunload",y),()=>{window.removeEventListener("beforeunload",y)}),[]),!f||!e)return c.default.createElement("div",{className:$.loadingContainer},c.default.createElement(U.Circle,null));let O=()=>{g().setMpcAction("",""),t.push(F)},h=()=>{switch(f.accountStatus){case p.IMPORTED:return c.default.createElement(tt,{title:n("extension_wallet_verification_title_account_duplicate",{acctname:I}),text:n("extension_wallet_verification_text_account_duplicate1"),footer:c.default.createElement(W.FooterActions,{placeholder:!1},c.default.createElement(T,{type:T.TYPE.highlight,size:T.SIZE.lg,block:!0,onClick:O},n("extension_wallet_verification_btn_return")))});case p.NOT_CREATE:return c.default.createElement(tt,{title:n("extension_wallet_login_title_not_created",{acctname:I}),text:n("extension_wallet_login_text_not_created1"),footer:c.default.createElement(Lt,null)});case p.ACCOUNT_MISMATCH:return c.default.createElement(tt,{title:n("extension_wallet_verification_title_account_mismatch"),text:n("extension_wallet_verification_text_account_mismatch1"),footer:c.default.createElement(W.FooterActions,{placeholder:!1},c.default.createElement(T,{type:T.TYPE.highlight,size:T.SIZE.lg,block:!0,onClick:O},n("extension_wallet_verification_btn_return")))});case p.NOT_IMPORTED:case p.RECOVER:return c.default.createElement(Ut,{accountInfo:f,userInfo:e,accountName:I});default:return null}};return c.default.createElement("div",{className:$.container},c.default.createElement(yt,{onBack:O,closeable:!1,bordered:!1}),c.default.createElement("div",{className:$.main},h()),c.default.createElement(at,{visible:f.accountStatus===p.TOKEN_EXPIRED||m!==0,title:n("extension_wallet_error_toast_title_verify_again"),text:n("extension_wallet_error_toast_text_verify_again1"),infoType:at.Prompt.INFO_TYPE.warn,hideCloseBtn:!0,alignBottom:!1,footer:c.default.createElement(T,{category:T.CATEGORY.fill,type:T.TYPE.highlight,size:T.SIZE.md,block:!0,onClick:async()=>{await g().setMpcAction(k.VERIFY,_),globalThis.open(a?.mpcLogin||`https://${i}${ht}`),window.close()}},n("extension_wallet_error_toast_btn_verification"))}))},sr=$t;export{sr as default};

window.inOKXExtension = true;
window.ASSETS_BUILD_TYPE = "prepub";

//# sourceMappingURL=Import-E3GXXZE5.js.map
