import{c as oe,d as ie,f as le}from"./chunk-TBBE7OKY.js";import{a as de,b as ue}from"./chunk-W234FNSM.js";import{t as v}from"./chunk-6FOZGMAL.js";import{p as ee,q as re,r as b}from"./chunk-2MV3WEYP.js";import{Fa as Y,db as J,gb as Z,y as Ve}from"./chunk-HPXM6RSK.js";import{a as Ge}from"./chunk-NJ5CWPUY.js";import{k as W,p as Qe}from"./chunk-UMJMJOW4.js";import{c as N,d as I,f as qe}from"./chunk-MAIAJ7GD.js";import{a as te,b as ne,c as ae,d as se,e as ce}from"./chunk-4PGNX6E2.js";import{c as M,e as h}from"./chunk-XCAARJ7Q.js";import{b as X,c as He}from"./chunk-AOA7NX2Y.js";import{j as z,m as Ke}from"./chunk-HXZH2DHB.js";import{Hc as A,m as Pe,o as S,q as K,r as H,s as q,t as V,tc as k,w as G,za as Q}from"./chunk-X7YMANPZ.js";import{G as C}from"./chunk-SOHTSUTI.js";import{I as Ue,w as T}from"./chunk-RPZQDAIQ.js";import{a as Le}from"./chunk-6DDC4Y2S.js";import{c as E,f as F,m as d,o as u}from"./chunk-EQYVU4XP.js";var pe=E((yr,fe)=>{"use strict";d();u();fe.exports=e=>encodeURIComponent(e).replace(/[!'()*]/g,r=>`%${r.charCodeAt(0).toString(16).toUpperCase()}`)});var Ie=E((Ir,we)=>{"use strict";d();u();var ge="%[a-f0-9]{2}",me=new RegExp(ge,"gi"),ye=new RegExp("("+ge+")+","gi");function $(e,r){try{return decodeURIComponent(e.join(""))}catch{}if(e.length===1)return e;r=r||1;var t=e.slice(0,r),n=e.slice(r);return Array.prototype.concat.call([],$(t),$(n))}function ze(e){try{return decodeURIComponent(e)}catch{for(var r=e.match(me),t=1;t<r.length;t++)e=$(r,t).join(""),r=e.match(me);return e}}function Xe(e){for(var r={"%FE%FF":"\uFFFD\uFFFD","%FF%FE":"\uFFFD\uFFFD"},t=ye.exec(e);t;){try{r[t[0]]=decodeURIComponent(t[0])}catch{var n=ze(t[0]);n!==t[0]&&(r[t[0]]=n)}t=ye.exec(e)}r["%C2"]="\uFFFD";for(var a=Object.keys(r),c=0;c<a.length;c++){var s=a[c];e=e.replace(new RegExp(s,"g"),r[s])}return e}we.exports=function(e){if(typeof e!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch{return Xe(e)}}});var We=E((hr,Ae)=>{"use strict";d();u();Ae.exports=(e,r)=>{if(!(typeof e=="string"&&typeof r=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(r==="")return[e];let t=e.indexOf(r);return t===-1?[e]:[e.slice(0,t),e.slice(t+r.length)]}});var xe=E((Fr,he)=>{"use strict";d();u();he.exports=function(e,r){for(var t={},n=Object.keys(e),a=Array.isArray(r),c=0;c<n.length;c++){var s=n[c],o=e[s];(a?r.indexOf(s)!==-1:r(s,o,e))&&(t[s]=o)}return t}});var Se=E(f=>{"use strict";d();u();var Ye=pe(),Je=Ie(),Fe=We(),Ze=xe(),ve=e=>e==null,R=Symbol("encodeFragmentIdentifier");function er(e){switch(e.arrayFormat){case"index":return r=>(t,n)=>{let a=t.length;return n===void 0||e.skipNull&&n===null||e.skipEmptyString&&n===""?t:n===null?[...t,[l(r,e),"[",a,"]"].join("")]:[...t,[l(r,e),"[",l(a,e),"]=",l(n,e)].join("")]};case"bracket":return r=>(t,n)=>n===void 0||e.skipNull&&n===null||e.skipEmptyString&&n===""?t:n===null?[...t,[l(r,e),"[]"].join("")]:[...t,[l(r,e),"[]=",l(n,e)].join("")];case"colon-list-separator":return r=>(t,n)=>n===void 0||e.skipNull&&n===null||e.skipEmptyString&&n===""?t:n===null?[...t,[l(r,e),":list="].join("")]:[...t,[l(r,e),":list=",l(n,e)].join("")];case"comma":case"separator":case"bracket-separator":{let r=e.arrayFormat==="bracket-separator"?"[]=":"=";return t=>(n,a)=>a===void 0||e.skipNull&&a===null||e.skipEmptyString&&a===""?n:(a=a===null?"":a,n.length===0?[[l(t,e),r,l(a,e)].join("")]:[[n,l(a,e)].join(e.arrayFormatSeparator)])}default:return r=>(t,n)=>n===void 0||e.skipNull&&n===null||e.skipEmptyString&&n===""?t:n===null?[...t,l(r,e)]:[...t,[l(r,e),"=",l(n,e)].join("")]}}function rr(e){let r;switch(e.arrayFormat){case"index":return(t,n,a)=>{if(r=/\[(\d*)\]$/.exec(t),t=t.replace(/\[\d*\]$/,""),!r){a[t]=n;return}a[t]===void 0&&(a[t]={}),a[t][r[1]]=n};case"bracket":return(t,n,a)=>{if(r=/(\[\])$/.exec(t),t=t.replace(/\[\]$/,""),!r){a[t]=n;return}if(a[t]===void 0){a[t]=[n];return}a[t]=[].concat(a[t],n)};case"colon-list-separator":return(t,n,a)=>{if(r=/(:list)$/.exec(t),t=t.replace(/:list$/,""),!r){a[t]=n;return}if(a[t]===void 0){a[t]=[n];return}a[t]=[].concat(a[t],n)};case"comma":case"separator":return(t,n,a)=>{let c=typeof n=="string"&&n.includes(e.arrayFormatSeparator),s=typeof n=="string"&&!c&&y(n,e).includes(e.arrayFormatSeparator);n=s?y(n,e):n;let o=c||s?n.split(e.arrayFormatSeparator).map(g=>y(g,e)):n===null?n:y(n,e);a[t]=o};case"bracket-separator":return(t,n,a)=>{let c=/(\[\])$/.test(t);if(t=t.replace(/\[\]$/,""),!c){a[t]=n&&y(n,e);return}let s=n===null?[]:n.split(e.arrayFormatSeparator).map(o=>y(o,e));if(a[t]===void 0){a[t]=s;return}a[t]=[].concat(a[t],s)};default:return(t,n,a)=>{if(a[t]===void 0){a[t]=n;return}a[t]=[].concat(a[t],n)}}}function Te(e){if(typeof e!="string"||e.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function l(e,r){return r.encode?r.strict?Ye(e):encodeURIComponent(e):e}function y(e,r){return r.decode?Je(e):e}function Ce(e){return Array.isArray(e)?e.sort():typeof e=="object"?Ce(Object.keys(e)).sort((r,t)=>Number(r)-Number(t)).map(r=>e[r]):e}function be(e){let r=e.indexOf("#");return r!==-1&&(e=e.slice(0,r)),e}function tr(e){let r="",t=e.indexOf("#");return t!==-1&&(r=e.slice(t)),r}function Me(e){e=be(e);let r=e.indexOf("?");return r===-1?"":e.slice(r+1)}function Ee(e,r){return r.parseNumbers&&!Number.isNaN(Number(e))&&typeof e=="string"&&e.trim()!==""?e=Number(e):r.parseBooleans&&e!==null&&(e.toLowerCase()==="true"||e.toLowerCase()==="false")&&(e=e.toLowerCase()==="true"),e}function Oe(e,r){r=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},r),Te(r.arrayFormatSeparator);let t=rr(r),n=Object.create(null);if(typeof e!="string"||(e=e.trim().replace(/^[?#&]/,""),!e))return n;for(let a of e.split("&")){if(a==="")continue;let[c,s]=Fe(r.decode?a.replace(/\+/g," "):a,"=");s=s===void 0?null:["comma","separator","bracket-separator"].includes(r.arrayFormat)?s:y(s,r),t(y(c,r),s,n)}for(let a of Object.keys(n)){let c=n[a];if(typeof c=="object"&&c!==null)for(let s of Object.keys(c))c[s]=Ee(c[s],r);else n[a]=Ee(c,r)}return r.sort===!1?n:(r.sort===!0?Object.keys(n).sort():Object.keys(n).sort(r.sort)).reduce((a,c)=>{let s=n[c];return Boolean(s)&&typeof s=="object"&&!Array.isArray(s)?a[c]=Ce(s):a[c]=s,a},Object.create(null))}f.extract=Me;f.parse=Oe;f.stringify=(e,r)=>{if(!e)return"";r=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},r),Te(r.arrayFormatSeparator);let t=s=>r.skipNull&&ve(e[s])||r.skipEmptyString&&e[s]==="",n=er(r),a={};for(let s of Object.keys(e))t(s)||(a[s]=e[s]);let c=Object.keys(a);return r.sort!==!1&&c.sort(r.sort),c.map(s=>{let o=e[s];return o===void 0?"":o===null?l(s,r):Array.isArray(o)?o.length===0&&r.arrayFormat==="bracket-separator"?l(s,r)+"[]":o.reduce(n(s),[]).join("&"):l(s,r)+"="+l(o,r)}).filter(s=>s.length>0).join("&")};f.parseUrl=(e,r)=>{r=Object.assign({decode:!0},r);let[t,n]=Fe(e,"#");return Object.assign({url:t.split("?")[0]||"",query:Oe(Me(e),r)},r&&r.parseFragmentIdentifier&&n?{fragmentIdentifier:y(n,r)}:{})};f.stringifyUrl=(e,r)=>{r=Object.assign({encode:!0,strict:!0,[R]:!0},r);let t=be(e.url).split("?")[0]||"",n=f.extract(e.url),a=f.parse(n,{sort:!1}),c=Object.assign(a,e.query),s=f.stringify(c,r);s&&(s=`?${s}`);let o=tr(e.url);return e.fragmentIdentifier&&(o=`#${r[R]?l(e.fragmentIdentifier,r):e.fragmentIdentifier}`),`${t}${s}${o}`};f.pick=(e,r,t)=>{t=Object.assign({parseFragmentIdentifier:!0,[R]:!1},t);let{url:n,query:a,fragmentIdentifier:c}=f.parseUrl(e,t);return f.stringifyUrl({url:n,query:Ze(a,r),fragmentIdentifier:c},t)};f.exclude=(e,r,t)=>{let n=Array.isArray(r)?a=>!r.includes(a):(a,c)=>!r(a,c);return f.pick(e,n,t)}});d();u();var x=F(Se()),i=F(Le()),p=F(Ve()),L=F(Ge());Qe();Ue();qe();d();u();var Ne=()=>!!(window.navigator&&window.navigator.hid);Q();d();u();var O=F(Pe());Q();var nr=(e=[],r)=>{let t={};return e.forEach(n=>{t[n[r]]=n}),t},_e=(e,r)=>{if(!e||!Array.isArray(e))return[];let{hasBackup:t,keyringType:n}=r||{};return e.filter(({hasBackup:a,keyringIdentityType:c})=>{let s=!0;return typeof t=="boolean"&&(s=t===a),n&&(s=(typeof n=="string"?[n]:n)?.includes(c)),s})},je=e=>e?.reduce((r,{walletIdentities:t,...n})=>[...r,...t.map((a={})=>({...n,...a}))],[]),Be=e=>e.map(r=>{let{walletIdentities:t}=r;return{...r,hasBackup:!t?.[0]?.backupData?.length}}),ar=(e={},r)=>{let t=[k.SEGWIT_NESTED,k.SEGWIT_NESTED_49],n={};return Object.keys(e).forEach(c=>{let s=r[c],o=t.find(m=>m!==s),g=Object.entries(e[c]).map(([m,B])=>({addressType:m,...B}));n[c]=g.filter(({addressType:m})=>m!==o)}),n},ke=(e=[],r=[])=>{let t=nr(r,"walletId");return e.map(n=>{let{walletIdentities:a}=n;return{...n,walletIdentities:a.map(c=>{let{walletId:s,accountsMap:o,addressType:g,...m}=c;if(!t[s])return{walletId:s,addressType:{},...m};let{addressType:B,segwitAddressType:De}=t[s];return{walletId:s,selectedAddressType:B,addressType:ar(c?.accountsMap,De),...m}})}})};var sr=[K,G,H,q,V],$r=(e,r=S,t)=>{if(sr.includes(r)&&t){let a=e?.addressType?.[r]||[];return(0,O.find)(a,c=>c.addressType===t)?.address}return e?.account?.[r]};d();u();He();Ke();var $e=()=>({syncMpcWallet:async r=>{let t=r?.walletIdentities?.length||0,n=r?.mpcId||"",{data:a}=await z(X.syncMpcwallet,{mpcId:n,deriveIndex:t});return a}});var cr="syncMpcWalletErrorCode",dt=()=>(0,p.useSelector)(Z),or=Y(({metamask:e})=>{let{wallets:r,keyringIdentities:t}=e;return{wallets:r,keyringIdentities:t}},({wallets:e,keyringIdentities:r})=>ke(r,e)),U=e=>{let r=(0,p.useSelector)(or);return(0,i.useMemo)(()=>{let n=Be(r);return e?_e(n,e):n},[e,r])},_=e=>{let r=U(e);return(0,i.useMemo)(()=>je(r||[]),[r])},ir=()=>(0,p.useSelector)(J),P=(e,r=!0)=>{let t=ir(),n=e||t,a=_();return(0,i.useMemo)(()=>r===!1&&!e?null:a.find(c=>c?.walletId===n),[a,n,r,e])},ut=(e,r)=>{let t=_(r);return(0,i.useMemo)(()=>Array.isArray(e)?t.filter(({walletId:n})=>e.includes(n)):t,[e,t])},ft=()=>{let e=_();return(0,i.useCallback)(r=>e?.find(t=>t.walletId===r),[e])},pt=e=>P(e)?.keyringIdentityType===A.MPC,mt=e=>{let r=P(e);return ce(r?.initialType)},yt=e=>{let r=U(),{keyringId:t}=P()||{},n=e||t;return(0,i.useMemo)(()=>r?.find(a=>a.keyringId===n),[r,n])},j=()=>{let e=U();return(0,i.useCallback)(r=>e?.find(t=>t.keyringId===r),[e])};var Re=()=>{let e=(0,p.useDispatch)();return(0,i.useCallback)(async r=>{try{let{walletId:t}=await I().addNewWallet(r);return await W(e),C.success({title:T("wallet_addacount_toast_account_created")}),t}catch(t){return t.message===de&&C.error(T("wallet_home_toast_network_error")),t.message===ue&&C.error(T("extension_wallet_addwallet_toast_wallets_added",{amount:500})),""}},[])},lr=()=>{let e=(0,L.useHistory)();return(0,i.useCallback)(async r=>{let t=r?.walletIdentities?.[0]?.walletId;if(!Ne()){e.push(`${b}/${M.ledger}?${x.default.stringify({baseChain:S,type:h.addAccount,walletId:t})}`);return}let n=`${re}?${x.default.stringify({type:h.addAccount,walletId:t})}`;await le.hasConnectedLedger()?e.push(n):ie.openModal(oe.hardWareNotConnected,{walletName:r.keyringName,onButtonClick:()=>{globalThis.platform.openExtensionInBrowser(ee)},onExtButtonClick:()=>{globalThis.platform.openExtensionInBrowser(`${n}&hideBack=1`)}})},[])},dr=()=>{let e=(0,L.useHistory)(),r=lr(),t=_()?.length;return(0,i.useCallback)(async n=>{if(t===500){C.error(T("extension_wallet_addwallet_toast_wallets_added",{amount:500}));return}let{initialType:a}=n,c=n?.walletIdentities?.[0]?.walletId;switch(!0){case te(a):{r(n);break}case ne(a):{globalThis.platform.openExtensionInBrowser(`${b}/${M.trezor}?${x.default.stringify({type:h.addAccount,walletId:c,hideBack:1})}`);break}case ae(a):{e.push(`${b}/${M.keystone}?${x.default.stringify({walletId:c,type:h.addAccount})}`);break}case se(a):{let{onekeyInfo:s}=n,{firstEvmAddress:o,connectId:g}=s;e.push(`${b}/${M.onekey}?${x.default.stringify({firstEvmAddress:o,connectId:g,type:h.addAccount})}`);break}default:break}},[])},gt=()=>{let e=j(),r=Re(),t=dr(),n=Re(),{syncMpcWallet:a}=$e();return(0,i.useCallback)(async c=>{if(c&&typeof c=="string"){let s=e(c),o=s?.walletIdentities?.[0]?.walletId;if(s?.keyringIdentityType===A.MNEMONIC)return await r(o);if(s?.keyringIdentityType===A.HARDWARE)return t(s);if(s?.keyringIdentityType===A.MPC){try{await a(s)}catch{return Promise.reject(new Error(cr))}return await n(o)}return Promise.reject()}return Promise.reject()},[e,r,t,n,a])},ur=()=>{let e=j();return(0,i.useCallback)(r=>new Promise((t,n)=>{let a=e(r);N().getMnemonicByWalletId(a?.walletIdentities?.[0]?.walletId,(c,s)=>{if(c){n(c);return}t(s)})}),[])},wt=(e,r=!0)=>{let t=ur(),[n,a]=(0,i.useState)(null);return(0,i.useEffect)(()=>{(async()=>{if(e){let c=await t(e);a(c)}})()},[e]),r?n?.split(" "):n},fr=()=>(0,i.useCallback)((e,r={})=>new Promise((t,n)=>{N().getBackupPrivateKeys(e,(a,c)=>{if(a){n(a);return}let s=c;Array.isArray(r?.exclude)&&(s=s?.filter(({coinId:o})=>!r?.exclude?.includes(o))),t(s)})}),[]),It=(e,r={})=>{let[t,n]=(0,i.useState)([]),a=fr();return v(()=>{(async()=>{if(e){let c=await a(e,r);n(c)}})()},[e,r]),t},pr=()=>{let e=j();return(0,i.useCallback)(r=>new Promise((t,n)=>{let a=e(r);N().getBackupData(a?.walletIdentities?.[0]?.walletId,(c,s)=>{if(c){n(c);return}t(s)})}),[])},At=e=>{let[r,t]=(0,i.useState)([]),n=pr();return(0,i.useEffect)(()=>{(async()=>{if(e){let a=await n(e);t(a)}})()},[e]),r},Wt=()=>{let e=(0,p.useDispatch)(),r=j();return(0,i.useCallback)(async t=>{let n=r(t);await I().backupMnemonic(n?.walletIdentities?.[0]?.walletId),await W(e)},[])},ht=()=>{let e=(0,p.useDispatch)();return(0,i.useCallback)(async(r,t)=>{await I().updateKeyringIdentityName(r,t),await W(e)},[])},xt=()=>{let e=(0,p.useDispatch)();return(0,i.useCallback)(async(r,t)=>{await I().updateWalletIdentityName(r,t),await W(e)},[])},Et=()=>{let e=(0,p.useDispatch)();return(0,i.useCallback)(async r=>{await I().updateAllKeyringIdentities(r),await W(e)},[e])};export{Se as a,Ne as b,$r as c,cr as d,dt as e,U as f,_ as g,ir as h,P as i,ut as j,ft as k,pt as l,mt as m,yt as n,j as o,gt as p,wt as q,fr as r,It as s,At as t,Wt as u,ht as v,xt as w,Et as x};

window.inOKXExtension = true;
window.ASSETS_BUILD_TYPE = "prepub";

//# sourceMappingURL=chunk-7DP5LYUM.js.map
