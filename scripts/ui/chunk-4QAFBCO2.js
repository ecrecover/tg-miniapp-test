import{a as q}from"./chunk-CDLW656Z.js";import{a as Z}from"./chunk-4VLUHY4K.js";import{h as z,i as W,l as Y}from"./chunk-7DP5LYUM.js";import{d as K}from"./chunk-3LB7TUPB.js";import{d as D}from"./chunk-TK6JYPIW.js";import{b as U}from"./chunk-OS6E6KVM.js";import{c as $,d as j,e as w,f as T}from"./chunk-WGCZSWYA.js";import{c as H}from"./chunk-7KCWBFQ2.js";import{a as v,l as k}from"./chunk-6FOZGMAL.js";import{$ as B,U as b}from"./chunk-2MV3WEYP.js";import{z as A}from"./chunk-IUIJ46C3.js";import{a as ct}from"./chunk-NJ5CWPUY.js";import{d as g,f as N}from"./chunk-MAIAJ7GD.js";import{u as G}from"./chunk-XCAARJ7Q.js";import{b as R,c as it}from"./chunk-AOA7NX2Y.js";import{j as O,m as at}from"./chunk-HXZH2DHB.js";import{Jc as F,a as M,b as rt,m as st}from"./chunk-X7YMANPZ.js";import{n as P}from"./chunk-SOHTSUTI.js";import{I as nt,w as s}from"./chunk-RPZQDAIQ.js";import{Y as S}from"./chunk-V4F2JFTP.js";import{a as ot}from"./chunk-6DDC4Y2S.js";import{f as h,m as E,o as C}from"./chunk-EQYVU4XP.js";E();C();var f=h(ot()),X=h(ct());nt();rt();N();it();at();E();C();N();var L=h(st()),V=async e=>{try{return await g().getMpcIdByWalletId(e)}catch{return null}},J=async e=>{try{return await g().accountCheck(e)}catch{return!1}},Q=async e=>{try{let{data:t}=await K([{mpcId:e}]);return{mpcStatus:(0,L.get)(t,"[0].mpcStatus"),accountStatus:(0,L.get)(t,"[0].accountStatus")}}catch{return{mpcStatus:T.ESCAPE,accountStatus:w.FROZEN}}};var ut=()=>v(async e=>{let{coinId:t,address:r,...o}=e||{};if(!r||!t)return{};try{let i={coinId:t,address:r},{data:n}=await H(i,{...o}),{info:c,...l}=n||{};return{...l,...c||{}}}catch(i){return Promise.reject(i)}},[]),_t=7e3,Yt=({coinId:e,address:t,...r},o={})=>{let i=ut(),[n,c]=(0,f.useState)({}),{ready:l=!0,pollingInterval:u,...a}=o||{},m={ready:!!e&&!!t&&!!l,pollingInterval:u||_t,...a};return k(async()=>await i({coinId:e,address:t,...r}),{...m,onSuccess:_=>{c(_),m?.onSuccess?.(_)}}),n};var mt=({fromAddr:e,localType:t})=>(0,f.useCallback)(({params:r,isSignError:o})=>{M.captureEvent({message:`signTxError: ${e}`,contexts:{report:{info:JSON.stringify({params:r,isSignError:o,localType:t})}},exception:{values:[{type:"BIZ_ERROR_signTxError",value:e}]},level:"error"})},[e,t]),Zt=({fromAddr:e,localType:t,walletId:r})=>{let o=W(r),i=mt({fromAddr:e,localType:t});return(0,f.useCallback)(async({params:n={},fromAddr:c,needCapture:l=!1,...u})=>{try{let a=c||e;return U(o?.initialType)?await D({walletInfo:o,txParams:n,baseChain:t}):await g().signTransaction(n,a,t,r,u)}catch(a){throw l&&i({params:n,isSignError:a?.message===A}),a?.message===G?a:new Error(A)}},[e,t,o,r])},$t=({coinId:e,txType:t,walletId:r,coinAmount:o,fromAddr:i,toAddr:n,localType:c,networkFee:l,extJson:u,...a})=>{let m=W(r),_=m?.walletId;return(0,f.useCallback)(async(I,p={})=>{let d=p?.walletId||_,x=p?.txHash||await q(c,I),y={coinId:e,txHash:x,txType:t,extJson:u,signedTx:I,coinAmount:o,toAdr:n,fromAdr:i,serviceCharge:l,accountId:d,walletType:m?.serverWalletType,txSource:F.NORMAL,...a,...p},tt=await g().getRequestHeaders({needSign:!0,currency:"usd",walletId:d}),{data:et}=await O(R.postTx,y,{headers:tt});return et},[c,e,t,u,o,n,i,l,_,m?.serverWalletType,a])},jt=(e,t)=>{let r=(0,f.useRef)(),o=(0,X.useHistory)(),i=z(),n=e||i,c=Y(n),l=Z();return(0,f.useCallback)(async()=>{if(!c)return Promise.resolve();let u=await V(n);if(!u)return Promise.resolve();let a=await J(u),{mpcStatus:m,accountStatus:_}=await Q(u);if(_===w.NORMAL&&m!==T.ESCAPE&&a)return Promise.resolve();let p={},d=()=>{t?.(),o.replace(B),r.current?.destroy()},x=window.location.pathname.includes(b);return a?_===w.DELETE?p={title:s("extension_wallet_error_toast_modatitle_deleteacct"),text:s("extension_wallet_error_toast_modaldesc_deleteacct"),confirmText:s("extension_wallet_error_toast_btn_switch_wallet"),onConfirm:d}:_===w.FROZEN?p={title:s("extension_wallet_error_toast_title_freeze_account"),text:s("extension_wallet_error_toast_text_freeze_desc"),confirmText:s("extension_wallet_error_toast_btn_switch_wallet"),onConfirm:d}:m===T.ESCAPE&&(p={title:s("extension_wallet_error_toast_modaltitle_wallet_escaped"),text:s("extension_wallet_error_toast_modaldesc_wallet_escapeddesc"),confirmText:s("extension_wallet_error_toast_btn_switch_wallet"),onConfirm:d}):p={text:s("extension_wallet_error_toast_text_verify_again1"),title:s("extension_wallet_error_toast_title_verify_again"),confirmText:s("extension_wallet_error_toast_btn_verification"),onConfirm:async()=>{t?.(),r.current?.destroy();let y=s("wallet_common_okx_link");await g().setMpcAction($.VERIFY,n),globalThis.open(l?.mpcLogin||`https://${y}${j}`),window.close()},cancelText:x?void 0:s("extension_wallet_error_toast_btn_switch_wallet"),cancelBtnProps:x?void 0:{category:S.CATEGORY.outline,size:S.SIZE.lg},onCancel:x?void 0:d},r.current=P.prompt({visible:!0,hideCloseBtn:!0,infoType:P.Prompt.INFO_TYPE.warn,alignBottom:!1,maskClosable:!1,confirmBtnProps:{type:S.TYPE.highlight,size:S.SIZE.lg},...p}),Promise.reject()},[o,c,n,t])};export{ut as a,Yt as b,Zt as c,$t as d,jt as e};

window.inOKXExtension = true;
window.ASSETS_BUILD_TYPE = "prepub";

//# sourceMappingURL=chunk-4QAFBCO2.js.map
