import{a as st}from"./chunk-JXXKPVB7.js";import{c as be,d as Re}from"./chunk-3LOAATWV.js";import{a as re}from"./chunk-BITK2ZRS.js";import{b as at}from"./chunk-NWBT27VI.js";import{Y as Be}from"./chunk-7GRBMPLB.js";import{e as M,h as Pe,j as rt}from"./chunk-Z7MVEL6Q.js";import{h as oe,k as Ae,l as Ee,r as Ie,s as ot}from"./chunk-JZYFGUUR.js";import{G as nt}from"./chunk-ILYGYWTN.js";import{a as wt}from"./chunk-EDYYUNM2.js";import{b as ne}from"./chunk-ZQ5A3KPQ.js";import{h as Ne,r as Ze,s as $e,w as D}from"./chunk-MJYAUOKI.js";import{a as j,j as et,l as q,o as _e,t as tt}from"./chunk-FCCCJLF6.js";import{Va as ze,qb as Qe,y as Bt}from"./chunk-FK3ETA6I.js";import{V as Ue,b as Se}from"./chunk-QZDHFNHK.js";import{d as me,f as Rt}from"./chunk-MNNY2ODL.js";import{c as P}from"./chunk-4QSQKIBZ.js";import{b as ee,c as bt}from"./chunk-OXVQDEZW.js";import{j as Q,m as Pt}from"./chunk-X3G52GGX.js";import{Kb as Fe,Ta as Xe,Tc as f,ab as Ye,ba as We,hb as He,ib as Ge,jb as Ve,kb as qe,lc as te,m as At,pc as le,q as he,rb as Je,za as It}from"./chunk-QG673PNL.js";import{G as Ke,c as Ce,n as ue,q as Me}from"./chunk-6MTHEPGF.js";import{I as ye,m as W,w as y}from"./chunk-ZQQ7HNWV.js";import{Y as z,c as De}from"./chunk-ZOQTSYT4.js";import{a as ce}from"./chunk-ADZWCU3Q.js";import{a as Et}from"./chunk-TBVIGR5T.js";import{f as k,m as A,n as w,o as E}from"./chunk-REC7XVZY.js";A();E();var F=k(ce()),Tt=k(Bt()),O=k(Et());var gt=k(At()),yt=k(wt());ye();Rt();He();It();bt();Pt();Fe();A();E();var X=k(ce());A();E();He();Fe();function Dt(e,t,r,n,o=4){return j(async(s,c)=>{let i=0;for(let a=0;a<o;a++){let m=await e(s,void 0,{tempFeeRate:Number(c.expectedFeeRate)});if(!m.length)return[];i=m.reduce((l,p)=>l+p.coinAmount,0);let u=await t({inputs:m,outputs:[{address:r,amount:n}],dustSize:i});if(i-(u+Number(c.increaseFee))>n)return[!0,!1,m,u];if(i>n&&a===o-1)return u=i-n,[!1,!0,m,u]}return[]})}function it(e){let[t,r]=(0,X.useState)({}),[n,o]=(0,X.useState)(0),[s,c]=(0,X.useState)([]),[i,a]=(0,X.useState)(void 0),{mainCoinId:m,address:u,btcSpeedUpInfo:_,txHash:l,canAccelerateBtcTx:p}=e,d=m,x=M(d),T=(0,X.useMemo)(()=>_?.cpfpSpeedUpUtxo?.map(R=>`${R.txHash}-${R.vout}`),[_]),[,N]=st({coinId:d,address:u,chainId:x?.chainId},{pollingInterval:20*1e3,ready:p}),h=N?.minOutput||0,g=xe({coinId:d,fromAddr:u,output:[{to:u,value:h}],satBytes:t?.expectedFeeRate}),C=de({coinId:d,address:u,utxoType:J.ACCELERATE_BTC_TX_UTXO,speedUpNeedUtxo:T}),{cancel:b}=q(async()=>{if(d===Ye){let R=await nt({address:u,coinId:d,txHash:l});r(R);let B=await C(0,void 0,{tempFeeRate:t.expectedFeeRate});c(B),a(void 0)}},{pollingInterval:20*1e3,ready:p,onError:R=>{a(R),b()}});if(t?.expectedFeeRate&&s.length){let R=s.reduce((B,G)=>B+G.coinAmount,0);g({inputs:s,outputs:[{address:u,amount:h}],satBytes:t.expectedFeeRate,dustSize:R}).then(B=>{let G=qe(B,Number(t.increaseFee),h);o(G)}).catch(B=>{throw B})}let L=Dt(C,g,u,h);return[n,t,h,L,i]}A();E();var I=k(ce());var pt=k(De());ye();A();E();var S=k(ce());var fe=k(De());ye();Fe();A();E();var U={root:"_root_rjjjg_1",subTitle:"_subTitle_rjjjg_4",utxo:"_utxo_rjjjg_9",coin:"_coin_rjjjg_17",coinDetail:"_coinDetail_rjjjg_23",coinSymbol:"_coinSymbol_rjjjg_29",nftImage:"_nftImage_rjjjg_35",coinAmount:"_coinAmount_rjjjg_38",coinValue:"_coinValue_rjjjg_43",assetList:"_assetList_rjjjg_51",unresolvedTip:"_unresolvedTip_rjjjg_51",list:"_list_rjjjg_58",paddingTop:"_paddingTop_rjjjg_61",asset:"_asset_rjjjg_51",assetDetail:"_assetDetail_rjjjg_71",assetValue:"_assetValue_rjjjg_72",foldSwitch:"_foldSwitch_rjjjg_86",fold:"_fold_rjjjg_86"};var Z=e=>[f.ARC_NFT,f.BRC_NFT,f.FRACTAL_ORDINAL,f.DRC_NFT,f.SRC_NFT].includes(e),lt=e=>Z(e?.protocolId)?`${e.collectionName||""} ${e.inscriptionNumber||e.nftId||""}`:$e(e.tokenAmount||"",{symbol:e.tokenSymbol||""}),_t=({asset:e,selectedCurrency:t,className:r})=>S.default.createElement(D.Text,{ellipsis:{tooltip:!0},className:r},Je(e.usdAmount,0)?y("extension_defi_card_text_unknown_value"):Ze(W.mul(e.usdAmount,t.usdToThisRate),{symbol:t.symbol,useApproximate:!1})),Mt=({assetList:e,assetUnknown:t,selectedCurrency:r})=>{let n=e.length>3,[o,{toggle:s}]=_e(n),c=o?e.slice(0,3):e,i=!!t?.length;return S.default.createElement(P.Box,{className:U.assetList},i&&S.default.createElement(D.Text,{className:U.unresolvedTip},y("extension_defi_mid_alert_utxo_not_decode",{asset:t.join(y("extension_wallet_text_punctuation_mark"))})),c?.length?S.default.createElement(P.Box,{className:(0,fe.default)(U.list,{[U.paddingTop]:!i})},c.map(a=>S.default.createElement(P.Box,{className:U.asset},S.default.createElement(D.Text,{ellipsis:{tooltip:!0},className:U.assetDetail},lt(a)),S.default.createElement(_t,{asset:a,className:U.assetValue,selectedCurrency:r})))):null,!!n&&S.default.createElement(P.Box,{align:P.ALIGN.center,className:(0,fe.default)(U.foldSwitch,{[U.fold]:o}),onClick:s},S.default.createElement(P.Box,null,y(o?"extension_defi_card_textbtn_view_all":"extension_defi_card_textbtn_view_less")),S.default.createElement(ne,{className:"okx-wallet-plugin-add-arrow-chevrons"})))},Kt=({title:e,utxoList:t,selectedCurrency:r})=>S.default.createElement(P.Box,{className:U.root},S.default.createElement(D.Text,{className:U.subTitle},e),t.map(n=>{let{mainAsset:o,protocolAssetList:s,assetUnknown:c}=n;return S.default.createElement(P.Box,{className:U.utxo},S.default.createElement(P.Box,{className:U.coin},S.default.createElement(P.Box,{className:U.coinDetail},S.default.createElement(ne,{className:(0,fe.default)(U.coinSymbol,{[U.nftImage]:Z(o.protocolId)}),radius:!1,size:Z(o.protocolId)?Ne.sm:Ne.xs,src:o.image,text:o.tokenSymbol}),S.default.createElement(D.Text,{ellipsis:{tooltip:!0},className:U.coinAmount},lt(o))),S.default.createElement(_t,{className:U.coinValue,asset:o,selectedCurrency:r})),S.default.createElement(Mt,{assetList:s,assetUnknown:c,selectedCurrency:r}))})),ve=Kt;A();E();var v={root:"_root_v0mp8_1",header:"_header_v0mp8_7",back:"_back_v0mp8_14",main:"_main_v0mp8_17",title:"_title_v0mp8_23",text:"_text_v0mp8_29",checkBox:"_checkBox_v0mp8_34",footerWrap:"_footerWrap_v0mp8_37",tipMessage:"_tipMessage_v0mp8_43",submitButton:"_submitButton_v0mp8_47"};var Wt=({conflictAssetUtxo:e,unlockFeeUtxo:t,selectedCurrency:r,protocolId:n,onConfirm:o,onCancel:s,coin:c,psbtTitle:i=""})=>{let[a,m]=(0,I.useState)(!1),u=(0,I.useRef)(),[_,l]=(0,I.useState)(!1);return et(()=>{l(at(u.current,"vertical"))}),I.default.createElement(P.Box,{className:v.root},I.default.createElement(P.Box,{className:v.header},I.default.createElement(ne,{className:(0,pt.default)(v.back,"okds-arrow-chevron-left-centered-md"),onClick:s})),I.default.createElement(P.Box,{ref:u,className:v.main},I.default.createElement(P.Box,{className:v.title},I.default.createElement(D.Text,{className:v.text},y("extension_defi_top_title_confirm_use_utxo"))),!!e.length&&I.default.createElement(ve,{title:Z(n)?y("extension_defi_top_subtitle_utxo_lose_all_assets_nft"):y("extension_defi_top_subtitle_utxo_lose_all_assets",{token:c.symbol}),utxoList:e,selectedCurrency:r}),!!t.length&&I.default.createElement(ve,{title:i||([f.ARC_20,f.RUNES,f.BRC_20,f.FRACTAL_BRC20,f.RUNEMAIN,f.FRACTAL_RUNES].includes(n)||Z(n)?y("extension_defi_mid_subtitle_utxo_cover_fee_icu",{chainName:c?.chainName}):y("extension_defi_top_subtitle_use_utxo_lose_assets",{chainName:c?.chainName})),utxoList:t,selectedCurrency:r}),I.default.createElement(Me,{className:v.checkBox,onChange:p=>{let d=p?.target?.checked;m(d)},checked:a},y("extension_defi_bot_checkbox_label_confirm_use_utxo"))),I.default.createElement(P.Box,{className:v.footerWrap},!a&&I.default.createElement(Ce,{desc:y(_?"extension_defi_bot_tips_slide_check_box":"extension_defi_bot_tips_confirm_check_box"),type:Ce.TYPE.info,closable:!1,className:v.tipMessage}),I.default.createElement(z,{block:!0,className:v.submitButton,disabled:!a,category:z.CATEGORY.fill,size:z.SIZE.lg,type:z.TYPE.highlight,onClick:o},y("extension_defi_bot_btn_continue"))))},dt=Wt;A();E();A();E();var J={TRANSFER:1,TRANSFER_NFT:2,COMPLETE:3,BRC20_CONVERTIBLE:4,NFT_REMOVAL:5,PSBT_DUMMY_OCCUPIED:6,EXPEND_ABLE:7,EXPEND_UNABLE:8,INSCRIPTION:9,BRC20S_CONVERTIBLE:4,NEW_INSCRIPTION:11,SPLIT_UTXO:13,INSCRIPTION_USE_NFT_UTXO:14,ACCELERATE_BTC_TX_UTXO:15},Y={CAL_FEE:1,CONFIRM:2},K=546,H={INSCRIBE:1,PSBT:2,PSBT_MPC_UNSIGNED_LIST:21,PSBT_MPC_SIGNED_LIST:22,PSBT_MPC_UNSIGNED_BUY:23,PSBT_MPC_SIGNED_BUY:24,PSBT_MPC_UNSIGNED:25,PSBT_KEY_SCRIPT_PATH:3,PSBT_KEY_SCRIPT_PATH_BATCH:4,SRC20:101,RUNES:102,RUNEMAIN:103,ARC20:114},$={TRANSFER:1,PSBT:2,ACCELERATE:3};var Xt={BRC20:1,SRC20:101},Le=e=>{if(e===f.SRC_20)return H.SRC20;if(e===f.ARC_20)return H.ARC20;if(e===f.RUNES)return H.RUNES;if(e===f.RUNEMAIN||e===f.FRACTAL_RUNES)return H.RUNEMAIN},Yt=({data:e,nftLocaltionVOs:t},r)=>Array.isArray(e)&&e?.length?{data:e}:!r||!t?.[0]?.nftId||!Array.isArray(t)?{}:r===f.ARC_20?{data:t.map(({nftId:n,tokenType:o,value:s})=>({atomicalId:n,type:o,amount:s}))}:r===f.RUNES?{data:t.map(({nftId:n,value:o})=>({id:n,amount:o}))}:r===f.RUNEMAIN||r===f.FRACTAL_RUNES?{data:t.map(({nftId:n,value:o})=>({id:n,amount:o}))}:{},se=(e,t={},r)=>Array.isArray(e)?e.map(({txHash:n,vout:o,coinAmount:s,rawTransaction:c,...i})=>({vOut:o,amount:s,txId:n,rawTransaction:c,...Yt(i,r),...t})):[],xt=(e={},t,r)=>{let n=r===Xt.BRC20?"text/plain;charset=utf-8":"stamp:",o=e?.revealAddr,s=e?.contentType;return s||(s=n),o||(o=t),{...e,revealAddr:o,contentType:s}},ft=({type:e,toAddr:t,fromAddr:r,satBytes:n,utxoList:o,privateKey:s,inscriptionData:c,inscriptionDataList:i,revealOutValue:a=K})=>({type:e,revealOutValue:a,changeAddress:r,commitFeeRate:n,revealFeeRate:n,commitTxPrevOutputList:se(o,{privateKey:s,address:r}),inscriptionData:xt(c,t||r,e),inscriptionDataList:i?.length?i.map(m=>xt(m,t||r,e)):void 0}),Ht=({changeAddr:e,toAddr:t,satBytes:r,utxoList:n=[],coinAmount:o,inputs:s,outputs:c,...i})=>({address:e,feePerB:r,inputs:se([...s||[],...n]),outputs:c||[{address:t,amount:o}],...i}),Gt=({changeAddr:e,toAddr:t,satBytes:r,utxoList:n=[],coinAmount:o,inputs:s,outputs:c,protocolId:i,fromAddr:a,...m})=>{let u={feePerB:r,address:e,inputs:se([...s||[],...n],{address:a||e},i),outputs:c||[{address:t,amount:o}],...m};return i===f.RUNES&&Object.assign(u,{runeData:{etching:null,burn:!1}}),(i===f.RUNEMAIN||i===f.FRACTAL_RUNES)&&Object.assign(u,{runeData:{etching:null,burn:!1,useDefaultOutput:!1,defaultOutput:0}}),u},Vt=e=>[f.SRC_20,f.ARC_20,f.RUNES,f.RUNEMAIN,f.FRACTAL_RUNES].includes(e),pe=({toAddr:e,changeAddr:t,satBytes:r,utxoList:n=[],coinAmount:o,inputs:s,outputs:c,protocolId:i,...a})=>Vt(i)?Gt({toAddr:e,changeAddr:t,satBytes:r,utxoList:n,coinAmount:o,inputs:s,outputs:c,protocolId:i,...a}):Ht({toAddr:e,changeAddr:t,satBytes:r,utxoList:n,coinAmount:o,inputs:s,outputs:c,...a});var de=e=>{let{coinId:t,address:r,walletId:n,utxoType:o,satBytes:s,utxoRequests:c=[],...i}=e,a=M(t),m=a?.baseCoinId||a?.coinId;return j(async(u,_,l={})=>{let p=await me().getRequestHeaders({walletId:n,needSign:!0,currency:"usd"}),d={coinId:m,utxoRequests:[{address:r,coinAmount:u,serviceCharge:_,utxoType:o||J.TRANSFER,...i,...l},...c]};try{let{data:x}=await Q(ee?.getBTCUTXO,d,{headers:p}),{utxoList:T}=x?.[0]||{};return T}catch(x){return Promise.reject(x)}},[m,r,n,o,i])},qt=[],ct=(e,t)=>{let{ready:r=!0,refreshDeps:n=[],...o}=t||{},{coinAmount:s="0",networkFee:c="0",...i}=e||{},a=de(i),m={debounceWait:500,ready:r&&i?.address&&i?.walletId,refreshDeps:[s,c,a,...n],...o},{error:u,loading:_,data:l}=q(async()=>await a(s,c),m);return[_,l||qt,u]},we=()=>j(async({coinId:e,baseCoinId:t,satBytes:r,addressList:n,walletId:o,utxoType:s,...c})=>{let i=await me().getRequestHeaders({walletId:o,needSign:!0,currency:"usd"}),a=Array.isArray(n)?n:[n],m={coinId:t,utxoRequests:a.map(u=>({address:u,coinAmount:0,serviceCharge:0,utxoType:s||J.TRANSFER,...c}))};try{let{data:u}=await Q(ee?.getBTCUTXO,m,{headers:i});return a.map(_=>{let{canTransferAmount:l}=u.find(p=>p.address===_);return l})}catch(u){return Promise.reject(u)}}),vt=(e={},t)=>{let{address:r,coinId:n,...o}=e,{ready:s=!0,...c}=t||{},i=we(),a=M(n),{loading:m,data:u,error:_}=q(async()=>{try{return(await i({addressList:[r],baseCoinId:a.baseCoinId||n,coinId:n,...o}))?.[0]||"0"}catch{return"0"}},{ready:!!r&&s&&a?.baseCoinId!==void 0,...c});return[m,u,_]},Lt=(e={},t)=>{let{addressList:r,coinId:n,...o}=e,{ready:s=!0,...c}=t||{},i=we(),a=M(n),{loading:m,data:u,error:_}=q(async()=>await i({addressList:r,baseCoinId:a.baseCoinId||n,coinId:n,...o}),{ready:Array.isArray(r)&&r?.length&&s&&a?.baseCoinId!==void 0,...c});return[m,u||[],_]},Jt=0,ut=()=>j((e,t)=>(e||[]).some(n=>n.status===Jt)?new Promise((n,o)=>{let s=ue.warn({alignBottom:!1,title:y("extension_wallet_transaction_title_low_tradingfee"),text:y("extension_wallet_transaction_subtitle_low_tradingfee"),confirmText:y("wallet_extension_address_popup_btn_continue"),cancelText:y("wallet_extension_btn_general_cancel"),onCancel:()=>{s.destroy(),o(),t?.()},onConfirm:()=>{s.destroy(),n()}})}):Promise.resolve(),[]),Zt=(e,t)=>{let[,r]=Pe(t);return j(async n=>{if(r?.coinId!==We)return Promise.resolve();let{data:o}=await Q(ee.checkWalletCommonPending,{address:e,coinId:t});return o?new Promise((s,c)=>{let i=ue.warn({alignBottom:!1,title:y("extension_defi_mid_title_reminder"),text:y("extension_defi_mid_subtitle_reminder_submit"),confirmText:y("extension_defi_mid_btn_cancel"),onConfirm:()=>{i.destroy(),c(),n?.()},cancelText:y("extension_defi_mid_btn_continue_submit"),onCancel:()=>{i.destroy(),s()}})}):Promise.resolve()})},$t=({address:e,coinId:t,protocolId:r,txType:n=Se.TRANS_OUT,doubleConfirmSource:o=$.TRANSFER})=>{let[s,c]=Pe(t,{withPrice:!0});s=s||{},c=c||{};let i=(0,Tt.useSelector)(Qe),{currencyId:a}=i,m=rt({currencyId:a});return j(async u=>{let _={};return u.forEach(({txHash:l,resourceUrl:p})=>{_[l]=p}),new Promise((l,p)=>{(async()=>{try{let{data:{conflictAssetUtxo:d,unlockFeeUtxo:x}}=await Q(ee.doubleCheckUtxo,{utxoList:u.map(g=>{let C=(0,gt.pick)(g,["vout","nftId","txHash","status","coinAmount"]);return o!==$.PSBT?C.unlockUtxo=g?.utxoStatusType===1:C.unlockUtxo=!0,C}),address:e,txType:n,coinId:t});if(!d?.length&&!x?.length){l();return}let T=d?.map(g=>{let[C,...b]=g.protocolAssetList;return C.image=_[g.txHash]||s.image,{...g,mainAsset:C,protocolAssetList:b}})||[],N=x?.map(g=>{let C=Ve(g.coinAmount,W.pow(10,c.decimals||0));return g.mainAsset={tokenSymbol:c.symbol,tokenAmount:C,usdAmount:Ge(C,c.usdPrice||0),image:c.image},g})||[],h=ue.action({windowStyle:{width:"100%",height:"100%",maxHeight:"none"},alignBottom:!0,hideCloseBtn:!0,noContentPadding:!0,children:F.default.createElement(dt,{coin:s,selectedCurrency:i,coinToCurrencyFn:m,protocolId:r,conflictAssetUtxo:T,unlockFeeUtxo:N,txType:n,onConfirm:()=>{l(),h.destroy()},onCancel:()=>{p(new Error(Be)),h.destroy()},psbtTitle:o=$.PSBT?y("extension_defi_top_toast_all_spent"):""})})}catch(d){console.log(d),Ke.error(y("extension_defi_toast_textarea_create_order_fail")),p(new Error(Be))}})()})})},kt=({address:e,coinId:t,currencyId:r,txType:n=Se.TRANS_OUT,protocolId:o,doubleConfirmSource:s=$.TRANSFER})=>{let c=$t({address:e,coinId:t,protocolId:o,txType:n,currencyId:r,doubleConfirmSource:s}),i=Zt(e,t),a=ut();return j(async(m,u=yt.default)=>{try{return s===$.TRANSFER&&(await i(u),await a(m,u)),await c(m),Promise.resolve()}catch(_){return Promise.reject(_)}})};function Ct(e){return JSON.stringify({ecdsaShare2:ze(e)})}async function ht(e,t,{share:r,pShare:n,mpcId:o,deriveIndex:s}){let{networks:c}=await le(),i=re(),a=await i.exec("inscribeForMPCUnsigned",[t,c.bitcoin]),{commitTx:m,signHashList:u}=a;t.commitTx=m;let _={currency:O.Currency.BTC,baseChain:he,share:r,pShare:n,mpcId:o,signHashList:u,deriveIndex:s},l=await me().mpcSignTransaction(e,he,_),p=JSON.parse(l).signatures;t.signatureList=p;let d=await i.exec("inscribeForMPCSigned",[t,c.bitcoin]);return delete d.signHashList,d}var Mo=e=>{let t=Ee(),r=Ie(),n=Ae(),o=(0,F.useCallback)((a,m,u="text/plain;charset=utf-8")=>{let _=[];return a.forEach(l=>{let p={...l};p.contentType||(p.contentType=u),p.revealAddr||(p.revealAddr=m),_.push(p)}),_},[]),s=(0,F.useCallback)(a=>{let m=n(a),{share:u,pShare:_,mpcId:l,publicKey:p,deriveIndex:d}=m?.addressType?.bitcoin?.find(x=>x?.addressType===m?.selectedAddressType?.bitcoin)||{};return{publicKey:p,share:u,pShare:_,mpcId:l,deriveIndex:d}},[]),c=(0,F.useCallback)(async(a,m)=>{let _=(await r(a))?.find(l=>l.address===m)?.privateKey;if(t){let{getRandomPrivateKey:l,getMidKey:p}=await te(),{networks:d,private2Wif:x}=await le();if(e===Y.CAL_FEE)return await l(O.Currency.BTC);if(e===Y.CONFIRM){let{share:T}=s(a),N=await p(Ct(T),O.Currency.BTC);return x(w.Buffer.from(N),d.bitcoin)}}return _},[]);return(0,F.useCallback)(async({walletId:a,address:m,tx:u={},privateKey:_})=>{let l=_;l||(l=await c(a,m));let{publicKey:p}=s(a),d=re(),{commitTxPrevOutputList:x,commitFeeRate:T,revealFeeRate:N,inscriptionData:h,inscriptionDataList:g,revealOutValue:C=546,changeAddress:b=m,toAddr:L}=u,B={commitTxPrevOutputList:x.map(V=>({...V,privateKey:l,publicKey:p,address:m})),commitFeeRate:T,revealFeeRate:N||T,inscriptionData:h,inscriptionDataList:o(g,L||m),revealOutValue:C,changeAddress:b,type:1};if(e===Y.CONFIRM&&t){let V=s(a);return await ht(a,B,V)}return await d.exec("signTransaction",[O.Currency.BTC,{data:B}])},[c,s,o,t,e])},Ko=e=>{let t=Ee(),r=Ie(),n=Ae(),o=(0,F.useCallback)(i=>{let a=n(i),{share:m,pShare:u,mpcId:_,publicKey:l,deriveIndex:p}=a?.addressType?.bitcoin?.find(d=>d?.addressType===a?.selectedAddressType?.bitcoin)||{};return{publicKey:l,share:m,pShare:u,mpcId:_,deriveIndex:p}},[]),s=(0,F.useCallback)(async(i,a)=>{let u=(await r(i))?.find(_=>_.address===a)?.privateKey;if(t){let{getRandomPrivateKey:_,getMidKey:l}=await te(),{networks:p,private2Wif:d}=await le();if(e===Y.CAL_FEE)return await _(O.Currency.BTC);if(e===Y.CONFIRM){let{share:x}=o(i),T=await l(Ct(x),O.Currency.BTC);return d(w.Buffer.from(T),p.bitcoin)}}return u},[]);return(0,F.useCallback)(async({walletId:i,address:a,tx:m={},privateKey:u,mintType:_=Ue.parallel})=>{let l=u;l||(l=await s(i,a));let{publicKey:p}=o(i),d=re(),{input:x,outValue:T,inscriptions:N}=m,h=x.map(R=>({...R,privateKey:l,publicKey:p,address:a})),g={type:H.RUNEMAIN,inputs:h,outputs:[{address:a,amount:T,data:N[0]}],runeData:{etching:null,useDefaultOutput:!1,defaultOutput:0,burn:!1,mint:!0,mintNum:N.length,serialMint:_===Ue.serial},...m},{estimateFee:C}=await te(),b=await C(O.Currency.BTC,{data:g});if(N.length===1&&(b=[b]),e===Y.CONFIRM&&t){let R=o(i),B=await ht(i,g,R);return{commitTx:B[0],revealTxs:B.slice(1),commitAddrs:[],commitTxFee:b[0],revealTxFees:b.slice(1)}}let L=await d.exec("signTransaction",[O.Currency.BTC,{data:g,privateKey:l}]);return N.length===1&&(L=[L]),{commitTx:L[0],revealTxs:L.slice(1),commitAddrs:[],commitTxFee:b[0],revealTxFees:b.slice(1)}},[s,o,t,e])},Ft=({type:e,toAddr:t,fromAddr:r,walletId:n,satBytes:o,inscriptionData:s,inscriptionDataList:c,revealOutValue:i=790})=>{let a=oe(),u=ot(n||a),_=(0,F.useMemo)(()=>(u||[]).find(({address:l})=>l===r)?.privateKey,[r,u]);return(0,F.useCallback)(async({utxoList:l})=>{let p=ft({type:e,toAddr:t,satBytes:o,fromAddr:r,utxoList:l,privateKey:_,revealOutValue:i,inscriptionData:s,inscriptionDataList:c});try{return await re().exec("signTransaction",[O.Currency.BTC,{data:p}])}catch{throw Error("sign error")}},[e,t,o,r,_,i,s,c])},zt=({type:e,toAddr:t,fromAddr:r,walletId:n,satBytes:o,inscriptionData:s,inscriptionDataList:c,revealOutValue:i=K,onlyCommitTxFee:a})=>{let m=Ft({type:e,toAddr:t,fromAddr:r,walletId:n,satBytes:o,revealOutValue:i,inscriptionData:s,inscriptionDataList:c});return(0,F.useCallback)(async({utxoList:u,..._})=>{let{commitTxFee:l,revealTxFees:p=[]}=await m({utxoList:u,..._});return a?l:{commitTxFee:l,totalRevealTxFee:(p||[]).reduce((d,x)=>W.add(d,x),0)}},[a,m])},Qt=({type:e,coinId:t,fromAddr:r,toAddr:n,satBytes:o,coinAmount:s,protocolId:c})=>{let a=M(t)?.baseCoinId||t;return(0,F.useCallback)(async({utxoList:m,...u})=>{if(!Number(o))return Promise.reject();let{estimateFee:_}=await te(),l=pe({type:e,toAddr:n,utxoList:m,satBytes:o,coinAmount:s,protocolId:c,changeAddr:r,...u}),d=Xe({coinId:+a})?.coinType;try{return await _(d,{data:l})}catch(x){return Promise.reject(x)}},[a,s,r,c,o,n,e])},xe=({coinId:e,fromAddr:t,toAddr:r,satBytes:n,coinAmount:o,protocolId:s,revealOutValue:c,inscriptionData:i,inscriptionDataList:a,...m})=>{let u=Le(s),_=Qt({coinId:e,satBytes:n,fromAddr:t,toAddr:r,coinAmount:o,protocolId:s,type:u,...m}),l=zt({coinId:e,toAddr:r,fromAddr:t,satBytes:n,coinAmount:o,protocolId:s,revealOutValue:c,inscriptionData:i,inscriptionDataList:a,type:u,onlyCommitTxFee:!0,...m});return s===f.SRC_20?l:_},Ot=(e,t)=>{let{coinId:r,walletId:n,toAddr:o,fromAddr:s,satBytes:c,networkFee:i,coinAmount:a,canTransferAmount:m,utxoParams:u={},inscriptionData:_,protocolId:l,inscriptionDataList:p,revealOutValue:d=K,inputs:x,...T}=e,N=M(r),h=N?.baseCoinId===0,g=l||N?.protocolId,{ready:C=!0,refreshDeps:b}=t||{},[L,{setTrue:R,setFalse:B}]=_e(!1),[G,V]=(0,F.useState)(),ke=oe(),Nt=n||ke,[Te,St]=(0,F.useState)(i),Oe=xe({coinId:r,fromAddr:s,toAddr:o,satBytes:c,coinAmount:a,protocolId:g,revealOutValue:d,inscriptionData:_,inscriptionDataList:p}),je={coinAmount:a,networkFee:Te||"0"};h&&m&&W.gt(W.add(a,Te),m)&&(je={coinAmount:m,networkFee:0});let[Ut,ae]=ct({coinId:r,address:s,walletId:Nt,...je,...u},{refreshDeps:b,ready:h&&!!m&&C||!h&&C}),ge=(0,F.useMemo)(()=>[...x||[],...ae||[]],[x,ae]);return tt(()=>{!Array.isArray(ge)||!ge?.length||(R(),Oe({utxoList:ge,...T}).then(ie=>{V(!1),St(ie),t?.onSuccess?.(ie,ae)}).catch(ie=>{V(!0),t?.onError?.(ie)}).finally(()=>{B()}))},[ae,T,Oe]),[L||Ut,Te,G]},en=({type:e,coinId:t,toAddr:r,walletId:n,fromAddr:o,changeAddr:s,satBytes:c,localType:i,coinAmount:a,networkFee:m,protocolId:u,dustSize:_=K,...l})=>{let p=oe(),x=be({fromAddr:o,localType:i,walletId:n||p});return(0,F.useCallback)(async({utxoList:T,...N})=>{let h=pe({toAddr:r,satBytes:c,type:e,changeAddr:s||o,dustSize:_,coinAmount:a,utxoList:T,protocolId:u,...l});return await x({params:h,...N})},[s,a,_,o,u,l,c,x,r,e])},mt=({coinId:e,toAddr:t,walletId:r,protocolId:n,fromAddr:o,changeAddr:s,satBytes:c,localType:i,coinAmount:a,networkFee:m,inscriptionData:u,inscriptionDataList:_,dustSize:l=K,...p})=>{let d=Le(n),x=en({coinId:e,toAddr:t,walletId:r,fromAddr:o,changeAddr:s,satBytes:c,localType:i,coinAmount:a,networkFee:m,dustSize:l,protocolId:n,type:d,...p}),T=Ft({toAddr:t,fromAddr:o,walletId:r,satBytes:c,protocolId:n,inscriptionData:u,inscriptionDataList:_,type:d,...p});return n===f.SRC_20?T:x},jt=({coinId:e,toAddr:t,txType:r,fromAddr:n,satBytes:o,walletId:s,localType:c,networkFee:i,coinAmount:a,protocolId:m,dustSize:u=K,extraPublishParams:_={},...l})=>{let p=oe(),d=s||p,x=mt({coinId:e,toAddr:t,walletId:s,fromAddr:n,satBytes:o,localType:c,coinAmount:a,networkFee:i,dustSize:u,protocolId:m,...l}),T=Re({coinId:e,txType:r,coinAmount:a,fromAddr:n,toAddr:t,localType:c,networkFee:i,walletId:d,extJson:JSON.stringify({protocolId:m}),..._});return(0,F.useCallback)(async({utxoList:N,...h})=>{let g=await x({utxoList:N,...h}),C=g;return m===f.SRC_20&&(C=g?.commitTx),await T(C)},[m,T,x])};export{it as a,J as b,Y as c,$ as d,Yt as e,se as f,Vt as g,de as h,ct as i,vt as j,Lt as k,kt as l,Mo as m,Ko as n,xe as o,Ot as p,mt as q,jt as r};

window.inOKXExtension = true;
window.ASSETS_BUILD_TYPE = "prepub";

//# sourceMappingURL=chunk-HTDEED7X.js.map
