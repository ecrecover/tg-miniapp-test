import{a as ee}from"./chunk-7ECDMU27.js";import{c as L,d as O,f as F}from"./chunk-ITV6J4J2.js";import"./chunk-E4R5GU2A.js";import{f as P,t as M}from"./chunk-UX2SYDH6.js";import"./chunk-MNKHROKM.js";import{a as re}from"./chunk-F2C2DYTN.js";import"./chunk-2FULUWWG.js";import"./chunk-SLEUZTBQ.js";import{l as U}from"./chunk-4X6ZAX3L.js";import"./chunk-4QSQKIBZ.js";import{b as R,c as Z}from"./chunk-OXVQDEZW.js";import{j as C,m as J}from"./chunk-X3G52GGX.js";import"./chunk-WUKT6J7S.js";import"./chunk-FTJCOLFJ.js";import{lc as w,m as Q,u as S,za as $}from"./chunk-QG673PNL.js";import"./chunk-ZUFARSFM.js";import"./chunk-6MTHEPGF.js";import"./chunk-ZQQ7HNWV.js";import"./chunk-Y62GSKHT.js";import"./chunk-ZOQTSYT4.js";import"./chunk-ADZWCU3Q.js";import"./chunk-LJMQYMIY.js";import"./chunk-KLGATC6G.js";import{a as X}from"./chunk-TBVIGR5T.js";import"./chunk-FHQVMQUK.js";import"./chunk-XNS2NFYY.js";import{f as T,m as f,n as l,o as x}from"./chunk-REC7XVZY.js";f();x();var y=T(re()),j=T(Q());f();x();f();x();f();x();var te=function(){var a=function(o,r){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,t){i.__proto__=t}||function(i,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n])},a(o,r)};return function(o,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");a(o,r);function i(){this.constructor=o}o.prototype=r===null?Object.create(r):(i.prototype=r.prototype,new i)}}();var ne={},ae={},_=function(a,o){ae[a]=o},e=function(a){var o=function(r){te(i,r);function i(t,n,s){var u=r.call(this,t||a,s)||this;if(Object.setPrototypeOf(u,i.prototype),u.name=a,n)for(var d in n)u[d]=n[d];if(s&&oe(s)&&"cause"in s&&!("cause"in u)){var c=s.cause;u.cause=c,"stack"in c&&(u.stack=u.stack+`
CAUSE: `+c.stack)}return u}return i}(Error);return ne[a]=o,o};function oe(a){return typeof a=="object"}var b=function(){var a=function(o,r){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,t){i.__proto__=t}||function(i,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n])},a(o,r)};return function(o,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");a(o,r);function i(){this.constructor=o}o.prototype=r===null?Object.create(r):(i.prototype=r.prototype,new i)}}();var Te=e("AccountNameRequired"),Ae=e("AccountNotSupported"),De=e("AmountRequired"),Ne=e("BluetoothRequired"),Se=e("BtcUnmatchedApp"),Oe=e("CantOpenDevice"),_e=e("CashAddrNotSupported"),Ie=e("CurrencyNotSupported"),ye=e("DeviceAppVerifyNotSupported"),me=e("DeviceGenuineSocketEarlyClose"),Ce=e("DeviceNotGenuine"),Re=e("DeviceOnDashboardExpected"),we=e("DeviceOnDashboardUnexpected"),Ue=e("DeviceInOSUExpected"),Le=e("DeviceHalted"),Fe=e("DeviceNameInvalid"),Pe=e("DeviceSocketFail"),Me=e("DeviceSocketNoBulkStatus"),ie=e("LockedDeviceError"),Be=e("DisconnectedDevice"),be=e("DisconnectedDeviceDuringOperation"),ke=e("DeviceExtractOnboardingStateError"),Ge=e("DeviceOnboardingStatePollingError"),He=e("EnpointConfig"),ze=e("EthAppPleaseEnableContractData"),We=e("FeeEstimationFailed"),qe=e("FirmwareNotRecognized"),Ve=e("HardResetFail"),je=e("InvalidXRPTag"),Ke=e("InvalidAddress"),Ye=e("InvalidAddressBecauseDestinationIsAlsoSource"),Qe=e("LatestMCUInstalledError"),Xe=e("UnknownMCU"),$e=e("LedgerAPIError"),Je=e("LedgerAPIErrorWithMessage"),Ze=e("LedgerAPINotAvailable"),er=e("ManagerAppAlreadyInstalled"),rr=e("ManagerAppRelyOnBTC"),tr=e("ManagerAppDepInstallRequired"),nr=e("ManagerAppDepUninstallRequired"),ar=e("ManagerDeviceLocked"),or=e("ManagerFirmwareNotEnoughSpace"),ir=e("ManagerNotEnoughSpace"),sr=e("ManagerUninstallBTCDep"),cr=e("NetworkDown"),ur=e("NoAddressesFound"),pr=e("NotEnoughBalance"),dr=e("NotEnoughBalanceToDelegate"),lr=e("NotEnoughBalanceInParentAccount"),vr=e("NotEnoughSpendableBalance"),fr=e("NotEnoughBalanceBecauseDestinationNotCreated"),xr=e("NoAccessToCamera"),hr=e("NotEnoughGas"),Er=e("NotSupportedLegacyAddress"),gr=e("GasLessThanEstimate"),Tr=e("PriorityFeeTooLow"),Ar=e("PriorityFeeTooHigh"),Dr=e("PriorityFeeHigherThanMaxFee"),Nr=e("MaxFeeTooLow"),Sr=e("PasswordsDontMatch"),Or=e("PasswordIncorrect"),_r=e("RecommendSubAccountsToEmpty"),Ir=e("RecommendUndelegation"),yr=e("TimeoutTagged"),mr=e("UnexpectedBootloader"),Cr=e("MCUNotGenuineToDashboard"),Rr=e("RecipientRequired"),wr=e("UnavailableTezosOriginatedAccountReceive"),Ur=e("UnavailableTezosOriginatedAccountSend"),Lr=e("UpdateFetchFileFail"),Fr=e("UpdateIncorrectHash"),Pr=e("UpdateIncorrectSig"),Mr=e("UpdateYourApp"),Br=e("UserRefusedDeviceNameChange"),br=e("UserRefusedAddress"),kr=e("UserRefusedFirmwareUpdate"),Gr=e("UserRefusedAllowManager"),Hr=e("UserRefusedOnDevice"),zr=e("TransportOpenUserCancelled"),Wr=e("TransportInterfaceNotAvailable"),qr=e("TransportRaceCondition"),Vr=e("TransportWebUSBGestureRequired"),jr=e("DeviceShouldStayInApp"),Kr=e("WebsocketConnectionError"),Yr=e("WebsocketConnectionFailed"),Qr=e("WrongDeviceForAccount"),Xr=e("WrongAppForCurrency"),$r=e("ETHAddressNonEIP"),Jr=e("CantScanQRCode"),Zr=e("FeeNotLoaded"),et=e("FeeRequired"),rt=e("FeeTooHigh"),tt=e("PendingOperation"),nt=e("SyncError"),at=e("PairingFailed"),ot=e("GenuineCheckFailed"),it=e("LedgerAPI4xx"),st=e("LedgerAPI5xx"),ct=e("FirmwareOrAppUpdateRequired"),ut=e("OpReturnSizeLimit"),pt=e("DustLimit"),dt=e("LanguageNotFound"),lt=e("NoDBPathGiven"),vt=e("DBWrongPassword"),ft=e("DBNotReset"),B;(function(a){a.Unknown="Unknown",a.LocationServicesDisabled="LocationServicesDisabled",a.LocationServicesUnauthorized="LocationServicesUnauthorized",a.BluetoothScanStartFailed="BluetoothScanStartFailed"})(B||(B={}));var xt=function(a){b(o,a);function o(r,i){var t=a.call(this,i)||this;return t.name="HwTransportError",t.type=r,Object.setPrototypeOf(t,o.prototype),t}return o}(Error);var se=function(a){b(o,a);function o(r,i){var t=this,n="TransportError";return t=a.call(this,r||n)||this,t.name=n,t.message=r,t.stack=new Error().stack,t.id=i,t}return o}(Error);_("TransportError",function(a){return new se(a.message,a.id)});var h={ACCESS_CONDITION_NOT_FULFILLED:38916,ALGORITHM_NOT_SUPPORTED:38020,CLA_NOT_SUPPORTED:28160,CODE_BLOCKED:38976,CODE_NOT_INITIALIZED:38914,COMMAND_INCOMPATIBLE_FILE_STRUCTURE:27009,CONDITIONS_OF_USE_NOT_SATISFIED:27013,CONTRADICTION_INVALIDATION:38928,CONTRADICTION_SECRET_CODE_STATUS:38920,CUSTOM_IMAGE_BOOTLOADER:26159,CUSTOM_IMAGE_EMPTY:26158,FILE_ALREADY_EXISTS:27273,FILE_NOT_FOUND:37892,GP_AUTH_FAILED:25344,HALTED:28586,INCONSISTENT_FILE:37896,INCORRECT_DATA:27264,INCORRECT_LENGTH:26368,INCORRECT_P1_P2:27392,INS_NOT_SUPPORTED:27904,DEVICE_NOT_ONBOARDED:27911,DEVICE_NOT_ONBOARDED_2:26129,INVALID_KCV:38021,INVALID_OFFSET:37890,LICENSING:28482,LOCKED_DEVICE:21781,MAX_VALUE_REACHED:38992,MEMORY_PROBLEM:37440,MISSING_CRITICAL_PARAMETER:26624,NO_EF_SELECTED:37888,NOT_ENOUGH_MEMORY_SPACE:27268,OK:36864,PIN_REMAINING_ATTEMPTS:25536,REFERENCED_DATA_NOT_FOUND:27272,SECURITY_STATUS_NOT_SATISFIED:27010,TECHNICAL_PROBLEM:28416,UNKNOWN_APDU:27906,USER_REFUSED_ON_DEVICE:21761,NOT_ENOUGH_SPACE:20738};function ce(a){switch(a){case 26368:return"Incorrect length";case 26624:return"Missing critical parameter";case 27010:return"Security not satisfied (dongle locked or have invalid access rights)";case 27013:return"Condition of use not satisfied (denied by the user?)";case 27264:return"Invalid data received";case 27392:return"Invalid parameter received";case 21781:return"Locked device"}if(28416<=a&&a<=28671)return"Internal error, please report"}function k(a){var o=Object.keys(h).find(function(n){return h[n]===a})||"UNKNOWN_ERROR",r=ce(a)||o,i=a.toString(16),t="Ledger device: ".concat(r," (0x").concat(i,")");if(a===h.LOCKED_DEVICE)throw new ie(t);this.name="TransportStatusError",this.message=t,this.stack=new Error().stack,this.statusCode=a,this.statusText=o}k.prototype=new Error;_("TransportStatusError",function(a){return new k(a.statusCode)});var q=T(ee()),E=function(a,o,r,i){function t(n){return n instanceof r?n:new r(function(s){s(n)})}return new(r||(r=Promise))(function(n,s){function u(p){try{c(i.next(p))}catch(v){s(v)}}function d(p){try{c(i.throw(p))}catch(v){s(v)}}function c(p){p.done?n(p.value):t(p.value).then(u,d)}c((i=i.apply(a,o||[])).next())})},g=function(a,o){var r={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,t,n,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(c){return function(p){return d([c,p])}}function d(c){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,t&&(n=c[0]&2?t.return:c[0]?t.throw||((n=t.return)&&n.call(t),0):t.next)&&!(n=n.call(t,c[1])).done)return n;switch(t=0,n&&(c=[c[0]&2,n.value]),c[0]){case 0:case 1:n=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,t=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(n=r.trys,!(n=n.length>0&&n[n.length-1])&&(c[0]===6||c[0]===2)){r=0;continue}if(c[0]===3&&(!n||c[1]>n[0]&&c[1]<n[3])){r.label=c[1];break}if(c[0]===6&&r.label<n[1]){r.label=n[1],n=c;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(c);break}n[2]&&r.ops.pop(),r.trys.pop();continue}c=o.call(a,r)}catch(p){c=[6,p],t=0}finally{i=n=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},G=function(a,o){var r=typeof Symbol=="function"&&a[Symbol.iterator];if(!r)return a;var i=r.call(a),t,n=[],s;try{for(;(o===void 0||o-- >0)&&!(t=i.next()).done;)n.push(t.value)}catch(u){s={error:u}}finally{try{t&&!t.done&&(r=i.return)&&r.call(i)}finally{if(s)throw s.error}}return n},ue=function(a){var o=typeof Symbol=="function"&&Symbol.iterator,r=o&&a[o],i=0;if(r)return r.call(a);if(a&&typeof a.length=="number")return{next:function(){return a&&i>=a.length&&(a=void 0),{value:a&&a[i++],done:!a}}};throw new TypeError(o?"Object is not iterable.":"Symbol.iterator is not defined.")},H=0,I=1,pe=1,de=2,A=255,z=224,D={GET_VERSION:4,GET_ADDR:5,SIGN:6,SIGN_OFFCHAIN:7},N;(function(a){a[a.BLIND_SIGNATURE_REQUIRED=26632]="BLIND_SIGNATURE_REQUIRED"})(N||(N={}));var le=function(){function a(o,r){r===void 0&&(r="solana_default_scramble_key"),this.transport=o,this.transport.decorateAppAPIMethods(this,["getAddress","signTransaction","getAppConfiguration"],r)}return a.prototype.getAddress=function(o,r){return r===void 0&&(r=!1),E(this,void 0,void 0,function(){var i,t;return g(this,function(n){switch(n.label){case 0:return i=this.pathToBuffer(o),[4,this.sendToDevice(D.GET_ADDR,r?I:H,i)];case 1:return t=n.sent(),[2,{address:t}]}})})},a.prototype.signTransaction=function(o,r){return E(this,void 0,void 0,function(){var i,t,n,s;return g(this,function(u){switch(u.label){case 0:return i=this.pathToBuffer(o),t=l.Buffer.alloc(1),t.writeUInt8(1,0),n=l.Buffer.concat([t,i,r]),[4,this.sendToDevice(D.SIGN,I,n)];case 1:return s=u.sent(),[2,{signature:s}]}})})},a.prototype.signOffchainMessage=function(o,r){return E(this,void 0,void 0,function(){var i,t,n,s;return g(this,function(u){switch(u.label){case 0:return i=this.pathToBuffer(o),t=l.Buffer.alloc(1),t.writeUInt8(1,0),n=l.Buffer.concat([t,i,r]),[4,this.sendToDevice(D.SIGN_OFFCHAIN,I,n)];case 1:return s=u.sent(),[2,{signature:s}]}})})},a.prototype.getAppConfiguration=function(){return E(this,void 0,void 0,function(){var o,r,i,t,n,s;return g(this,function(u){switch(u.label){case 0:return[4,this.sendToDevice(D.GET_VERSION,H,l.Buffer.alloc(0))];case 1:return o=G.apply(void 0,[u.sent(),5]),r=o[0],i=o[1],t=o[2],n=o[3],s=o[4],[2,{blindSigningEnabled:Boolean(r),pubKeyDisplayMode:i,version:"".concat(t,".").concat(n,".").concat(s)}]}})})},a.prototype.pathToBuffer=function(o){var r=o.split("/").map(function(t){return t.endsWith("'")||t.endsWith("h")?t:t+"'"}).join("/"),i=q.default.fromString(r).toPathArray();return this.serializePath(i)},a.prototype.serializePath=function(o){var r,i,t=l.Buffer.alloc(1+o.length*4);t.writeUInt8(o.length,0);try{for(var n=ue(o.entries()),s=n.next();!s.done;s=n.next()){var u=G(s.value,2),d=u[0],c=u[1];t.writeUInt32BE(c,1+d*4)}}catch(p){r={error:p}}finally{try{s&&!s.done&&(i=n.return)&&i.call(n)}finally{if(r)throw r.error}}return t},a.prototype.sendToDevice=function(o,r,i){return E(this,void 0,void 0,function(){var t,n,s,u,d,c,p;return g(this,function(v){switch(v.label){case 0:if(t=[h.OK,N.BLIND_SIGNATURE_REQUIRED],n=0,s=0,!(i.length>A))return[3,3];v.label=1;case 1:return i.length-s>A?(u=i.slice(s,s+A),s+=A,[4,this.transport.send(z,o,r,n|de,u,t)]):[3,3];case 2:return d=v.sent(),this.throwOnFailure(d),n|=pe,[3,1];case 3:return c=i.slice(s),[4,this.transport.send(z,o,r,n,c,t)];case 4:return p=v.sent(),this.throwOnFailure(p),[2,p.slice(0,p.length-2)]}})})},a.prototype.throwOnFailure=function(o){var r=o.readUInt16BE(o.length-2);switch(r){case N.BLIND_SIGNATURE_REQUIRED:throw new Error("Missing a parameter. Try enabling blind signature in the app");default:return}},a}(),V=le,W;(function(a){a[a.LONG=0]="LONG",a[a.SHORT=1]="SHORT"})(W||(W={}));Z();J();var K=T(X());$();var m=class extends F{async makeApp(){await this.initLedgerTransPorter(),this.app||(this.app=new V(this.ledgerTransPorter))}async getAddressPromise(o,r){await this.makeApp();let i=[];for(let t=o*5;t<(o+1)*5;t++){let n=`44'/501'/${t}'/0'`;r===U&&(n=`44'/501'/${t}'`);let{address:s}=await this.app.getAddress(n,!1);i.push({address:y.default.encode(s),index:t,path:n})}return i}async getAddress(o=0,r){return await Promise.race([this.getAddressPromise(o,r),this.throwTimeoutError()])}async getTokens(o,r){let i=o.map(({address:t})=>t);try{let t=await C(R.getChainToken,{addressList:i,coinId:r});if(t?.code===0){let{data:n}=t;n.forEach(({address:s,coinAmount:u})=>{let d=(0,j.find)(o,{address:s});d.coinAmount=u})}}catch(t){console.log(t)}return o}async signTransaction(o,r){try{O.openModal(L.confirm);let i=o.hdPathMap[S];await this.checkLedgerConnection();let{payer:t}=r,{getHardWareRawTransaction:n}=await w(),s=await n(K.Currency.SOL,{data:r}),u=l.Buffer.from(s,"hex"),d=M.from(u),c=d.serializeMessage(),{signature:p}=await this.app.signTransaction(i,c),v=new P(t);d.signatures&&(d.signatures=[]),d.addSignature(v,p);let Y=d.serialize();return O.closeModal(),y.default.encode(Y)}catch(i){return this.handleErrors(i,S)}}},Ut=new m;export{Ut as default};

window.inOKXExtension = true;
window.ASSETS_BUILD_TYPE = "prepub";

//# sourceMappingURL=solanaAdapter-T4WKE3C6.js.map
