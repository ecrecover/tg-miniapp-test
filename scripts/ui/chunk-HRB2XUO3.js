import{a as te}from"./chunk-KLGATC6G.js";import{a as fe}from"./chunk-BDEVQ2S7.js";import{d as Z}from"./chunk-EWYZZSY3.js";import{c as B,m as p,n as m,o as h}from"./chunk-REC7XVZY.js";var se=B(q=>{"use strict";p();h();Object.defineProperty(q,"__esModule",{value:!0});q.Assignable=q.Enum=void 0;var re=class{constructor(e){if(Object.keys(e).length!==1)throw new Error("Enum can only take single value");Object.keys(e).map(r=>{this[r]=e[r],this.enum=r})}};q.Enum=re;var ne=class{constructor(e){Object.keys(e).map(r=>{this[r]=e[r]})}};q.Assignable=ne});var ie=B(b=>{"use strict";p();h();Object.defineProperty(b,"__esModule",{value:!0});b.BinaryReader=b.BinaryWriter=b.BorshError=b.deserialize=b.serialize=b.base_decode=b.base_encode=void 0;var T=te();Object.defineProperty(b,"base_encode",{enumerable:!0,get:function(){return T.baseEncode}});Object.defineProperty(b,"base_decode",{enumerable:!0,get:function(){return T.baseDecode}});Object.defineProperty(b,"serialize",{enumerable:!0,get:function(){return T.serialize}});Object.defineProperty(b,"deserialize",{enumerable:!0,get:function(){return T.deserialize}});Object.defineProperty(b,"BorshError",{enumerable:!0,get:function(){return T.BorshError}});Object.defineProperty(b,"BinaryWriter",{enumerable:!0,get:function(){return T.BinaryWriter}});Object.defineProperty(b,"BinaryReader",{enumerable:!0,get:function(){return T.BinaryReader}})});var oe=B(E=>{"use strict";p();h();Object.defineProperty(E,"__esModule",{value:!0});E.PublicKey=E.KeyType=void 0;var xe=se(),ae=ie(),Ae=Z(),z;(function(t){t[t.ED25519=0]="ED25519"})(z=E.KeyType||(E.KeyType={}));function Pe(t){switch(t){case z.ED25519:return"ed25519";default:throw new Error(`Unknown key type ${t}`)}}function _e(t){switch(t.toLowerCase()){case"ed25519":return z.ED25519;default:throw new Error(`Unknown key type ${t}`)}}var _=class extends xe.Assignable{static fromRaw(e){return new _({keyType:z.ED25519,data:e})}static from(e){return typeof e=="string"?_.fromString(e):e}static fromString(e){let r=e.split(":");if(r.length===1)return new _({keyType:z.ED25519,data:(0,ae.base_decode)(r[0])});if(r.length===2)return new _({keyType:_e(r[0]),data:(0,ae.base_decode)(r[1])});throw new Error("Invalid encoded key format, must be <curve>:<encoded key>")}toString(){return`${Pe(this.keyType)}:${(0,ae.base_encode)(this.data)}`}verify(e,r){switch(this.keyType){case z.ED25519:return Ae.signUtil.ed25519.verify(e,r,this.data);default:throw new Error(`Unknown key type ${this.keyType}`)}}};E.PublicKey=_});var le=B(ee=>{"use strict";p();h();Object.defineProperty(ee,"__esModule",{value:!0});ee.MessagePayload=void 0;var ce=class{constructor(e){this.tag=2147484061,this.message=e.message,this.nonce=e.nonce,this.recipient=e.recipient,e.callbackUrl&&(this.callbackUrl=e.callbackUrl)}};ee.MessagePayload=ce});var pe=B(s=>{"use strict";p();h();Object.defineProperty(s,"__esModule",{value:!0});s.functionCallAccessKey=s.fullAccessKey=s.signTransaction=s.createTransaction=s.SCHEMA=s.SignedTransaction=s.Signature=s.Action=s.Transaction=s.deleteAccount=s.deleteKey=s.addKey=s.stake=s.transfer=s.functionCall=s.stringifyJsonOrBytes=s.deployContract=s.createAccount=s.DeleteAccount=s.DeleteKey=s.AddKey=s.Stake=s.Transfer=s.FunctionCall=s.DeployContract=s.CreateAccount=s.IAction=s.AccessKey=s.AccessKeyPermission=s.FullAccessPermission=s.FunctionCallPermission=void 0;var C=oe(),A=se(),Q=te(),H=Z(),Be=ie(),Te=le(),U=class extends A.Assignable{};s.FunctionCallPermission=U;var F=class extends A.Assignable{};s.FullAccessPermission=F;var S=class extends A.Enum{};s.AccessKeyPermission=S;var j=class extends A.Assignable{};s.AccessKey=j;var w=class extends A.Assignable{};s.IAction=w;var I=class extends w{};s.CreateAccount=I;var W=class extends w{};s.DeployContract=W;var O=class extends w{};s.FunctionCall=O;var R=class extends w{};s.Transfer=R;var $=class extends w{};s.Stake=$;var V=class extends w{};s.AddKey=V;var G=class extends w{};s.DeleteKey=G;var J=class extends w{};s.DeleteAccount=J;function Ee(){return new v({createAccount:new I({})})}s.createAccount=Ee;function Ce(t){return new v({deployContract:new W({code:t})})}s.deployContract=Ce;function be(t){return t.byteLength!==void 0&&t.byteLength===t.length?t:m.Buffer.from(JSON.stringify(t))}s.stringifyJsonOrBytes=be;function He(t,e,r=new H.BN(0),a=new H.BN(0),c=be,l=!1){return l?new v({functionCall:new O({methodName:t,args:e,gas:r,deposit:a})}):new v({functionCall:new O({methodName:t,args:c(e),gas:r,deposit:a})})}s.functionCall=He;function Se(t){return new v({transfer:new R({deposit:t})})}s.transfer=Se;function je(t,e){return new v({stake:new $({stake:t,publicKey:e})})}s.stake=je;function Oe(t,e){return new v({addKey:new V({publicKey:t,accessKey:e})})}s.addKey=Oe;function De(t){return new v({deleteKey:new G({publicKey:t})})}s.deleteKey=De;function Ne(t){return new v({deleteAccount:new J({beneficiaryId:t})})}s.deleteAccount=Ne;var x=class extends A.Assignable{encode(){return(0,Q.serialize)(s.SCHEMA,this)}static decode(e){return(0,Q.deserialize)(s.SCHEMA,x,e)}};s.Transaction=x;var v=class extends A.Enum{};s.Action=v;var X=class extends A.Assignable{};s.Signature=X;var D=class extends A.Assignable{encode(){return(0,Q.serialize)(s.SCHEMA,this)}static decode(e){return(0,Q.deserialize)(s.SCHEMA,D,e)}};s.SignedTransaction=D;s.SCHEMA=new Map([[Te.MessagePayload,{kind:"struct",fields:[["tag","u32"],["message","string"],["nonce",[32]],["recipient","string"],["callbackUrl",{kind:"option",type:"string"}]]}],[X,{kind:"struct",fields:[["keyType","u8"],["data",[64]]]}],[D,{kind:"struct",fields:[["transaction",x],["signature",X]]}],[x,{kind:"struct",fields:[["signerId","string"],["publicKey",C.PublicKey],["nonce","u64"],["receiverId","string"],["blockHash",[32]],["actions",[v]]]}],[C.PublicKey,{kind:"struct",fields:[["keyType","u8"],["data",[32]]]}],[j,{kind:"struct",fields:[["nonce","u64"],["permission",S]]}],[S,{kind:"enum",field:"enum",values:[["functionCall",U],["fullAccess",F]]}],[U,{kind:"struct",fields:[["allowance",{kind:"option",type:"u128"}],["receiverId","string"],["methodNames",["string"]]]}],[F,{kind:"struct",fields:[]}],[v,{kind:"enum",field:"enum",values:[["createAccount",I],["deployContract",W],["functionCall",O],["transfer",R],["stake",$],["addKey",V],["deleteKey",G],["deleteAccount",J]]}],[I,{kind:"struct",fields:[]}],[W,{kind:"struct",fields:[["code",["u8"]]]}],[O,{kind:"struct",fields:[["methodName","string"],["args",["u8"]],["gas","u64"],["deposit","u128"]]}],[R,{kind:"struct",fields:[["deposit","u128"]]}],[$,{kind:"struct",fields:[["stake","u128"],["publicKey",C.PublicKey]]}],[V,{kind:"struct",fields:[["publicKey",C.PublicKey],["accessKey",j]]}],[G,{kind:"struct",fields:[["publicKey",C.PublicKey]]}],[J,{kind:"struct",fields:[["beneficiaryId","string"]]}]]);function ge(t,e,r,a,c,l){return new x({signerId:t,publicKey:e,nonce:a,receiverId:r,actions:c,blockHash:l})}s.createTransaction=ge;async function ye(t,e){let r=(0,Q.serialize)(s.SCHEMA,t),a=H.base.sha256(r),c=H.base.fromHex(e),l=H.signUtil.ed25519.sign(a,c),n=new D({transaction:t,signature:new X({keyType:C.KeyType.ED25519,data:l})});return[a,n]}async function Me(...t){if(t[0].constructor===x){let[e,r]=t;return ye(e,r)}else{let[e,r,a,c,l,n]=t,d=H.signUtil.ed25519.publicKeyCreate(H.base.fromHex(l)),g=C.PublicKey.from((0,Be.base_encode)(d)),y=ge(n,g,e,r,a,c);return ye(y,l)}}s.signTransaction=Me;function qe(){return new j({nonce:0,permission:new S({fullAccess:new F({})})})}s.fullAccessKey=qe;function ze(t,e,r){return new j({nonce:0,permission:new S({functionCall:new U({receiverId:t,allowance:r,methodNames:e})})})}s.functionCallAccessKey=ze});var he=B(M=>{"use strict";p();h();Object.defineProperty(M,"__esModule",{value:!0});M.NearWallet=M.NearTypes=void 0;var f=fe(),i=Z(),o=ve(),Ue=le(),Fe=te(),N;(function(t){t[t.TransferNear=0]="TransferNear",t[t.TransferToken=1]="TransferToken",t[t.DAppTx=2]="DAppTx",t[t.DAppTxs=3]="DAppTxs",t[t.AddKey=4]="AddKey",t[t.DelKey=5]="DelKey"})(N=M.NearTypes||(M.NearTypes={}));var de=class extends f.BaseWallet{async getDerivedPath(e){return`m/44'/397'/${e.index}'`}async getRandomPrivateKey(){try{let e=(0,f.ed25519_getRandomPrivateKey)(!1,"hex"),r=i.base.toHex(i.signUtil.ed25519.publicKeyCreate(i.base.fromHex(e)),!1);return Promise.resolve("ed25519:"+i.base.toBase58(i.base.fromHex(e+r)))}catch{return Promise.reject(f.GenPrivateKeyError)}}async getDerivedPrivateKey(e){try{let r=await(0,f.ed25519_getDerivedPrivateKey)(e,!1,"hex"),a=i.base.toHex(i.signUtil.ed25519.publicKeyCreate(i.base.fromHex(r)));return Promise.resolve("ed25519:"+i.base.toBase58(i.base.fromHex(r+a)))}catch{return Promise.reject(f.GenPrivateKeyError)}}async getNewAddress(e){try{if(!e.privateKey)throw f.NewAddressError;if(e.privateKey.startsWith("0x")||e.privateKey.startsWith("0X")){let n=e.privateKey.substring(2);if(i.base.isHexString("0x"+n))return Promise.resolve({address:(0,o.getAddress)(e.privateKey),publicKey:(0,o.getPubkey)(e.privateKey)})}if(!e.privateKey.startsWith("0x")&&!e.privateKey.startsWith("0X")&&i.base.isHexString("0x"+e.privateKey))return Promise.resolve({address:(0,o.getAddress)(e.privateKey),publicKey:(0,o.getPubkey)(e.privateKey)});let r=e.privateKey.split(":");if(r.length!=2||r[0]!="ed25519")throw f.NewAddressError;let a=i.base.fromBase58(r[1]),c=i.base.toHex(a.slice(0,32)),l=(0,o.getAddress)(c);return Promise.resolve({address:l,publicKey:(0,o.getPubkey)(c)})}catch{return Promise.reject(f.NewAddressError)}}async validPrivateKey(e){let r=e.privateKey.startsWith("0x")?e.privateKey:"0x"+e.privateKey,a;if(i.base.isHexString(r))a=(0,o.checkPrivateKey)(e.privateKey);else{let l=e.privateKey.split(":");if(l.length!=2||l[0]!="ed25519")a=!1;else{let n=i.base.fromBase58(l[1]),d=i.base.toHex(n.slice(0,32));a=(0,o.checkPrivateKey)(d)}}let c={isValid:a,privateKey:e.privateKey};return Promise.resolve(c)}getBase58Address(e){let r=e.split(":");if(r.length!=2||r[0]!="ed25519")throw f.NewAddressError;let a=i.base.fromBase58(r[1]),c=i.base.toHex(a.slice(0,32));return(0,o.getAddress)(c)}getPrvFromBase58(e){let r=e.split(":");if(r.length!=2||r[0]!="ed25519")throw f.NewAddressError;let a=i.base.fromBase58(r[1]);return i.base.toHex(a)}getBase58Pubkey(e){let r=e.split(":");if(r.length!=2||r[0]!="ed25519")throw f.NewAddressError;let a=i.base.fromBase58(r[1]),c=i.base.toHex(a.slice(0,32));return(0,o.publicKeyFromSeed)(c)}async signMessage(e){try{let r=e.data,{message:a,nonce:c,recipient:l,callbackUrl:n,state:d}=r,g=m.Buffer.from(c);if(g.length!==32)throw Error("Expected nonce to be a 32 bytes buffer");let y=new Ue.MessagePayload({message:a,nonce:g,recipient:l,callbackUrl:n}),k=(0,Fe.serialize)(o.SCHEMA,y),Y=i.base.sha256(k),L=this.getPrvFromBase58(e.privateKey),P=i.base.fromHex(L),ke=i.signUtil.ed25519.sign(Y,P);return Promise.resolve(m.Buffer.from(ke).toString("base64"))}catch{return Promise.reject(f.SignMsgError)}}async signTransaction(e){try{let r=e.data.type||0,a=this.getBase58Address(e.privateKey),c=this.getBase58Pubkey(e.privateKey),l=this.getPrvFromBase58(e.privateKey);if(r===N.TransferNear){let n=e.data,d=(0,o.createTransaction)(n.from==null||null||n.from==""?a:n.from,c,n.receiverId,n.nonce,[],i.base.fromBase58(n.blockHash));d.actions.push((0,o.transfer)(new i.BN(n.amount)));let[g,y]=await(0,o.signTransaction)(d,l);return Promise.resolve(i.base.toBase64(y.encode()))}else if(r===N.AddKey){let n=e.data;if(n.publicKey==null||null||n.accessKey==null)return Promise.reject(f.SignTxError);let d=(0,o.createTransaction)(n.from==null||null||n.from==""?a:n.from,c,n.receiverId,n.nonce,[],i.base.fromBase58(n.blockHash));d.actions.push((0,o.addKey)((0,o.publicKeyFromBase58)(n.publicKey),n.accessKey));let[g,y]=await(0,o.signTransaction)(d,l);return Promise.resolve(i.base.toBase64(y.encode()))}else if(r===N.DelKey){let n=e.data;if(n.publicKey==null)return Promise.reject(f.SignTxError);let d=(0,o.createTransaction)(n.from==null||null||n.from==""?a:n.from,c,n.receiverId,n.nonce,[],i.base.fromBase58(n.blockHash));d.actions.push((0,o.deleteKey)((0,o.publicKeyFromBase58)(n.publicKey)));let[g,y]=await(0,o.signTransaction)(d,l);return Promise.resolve(i.base.toBase64(y.encode()))}else if(r===N.TransferToken){let n=e.data,d=(0,o.createTransaction)(n.from==null||null||n.from==""?a:n.from,c,n.contract,n.nonce,[],i.base.fromBase58(n.blockHash));if(n.shouldDeposit){let L={account_id:n.receiverId},P=(0,o.functionCall)("storage_deposit",L,new i.BN(n.depositGas),new i.BN(n.depositValue));d.actions.push(P)}let g={amount:n.amount,receiver_id:n.receiverId},y=(0,o.functionCall)("ft_transfer",g,new i.BN(n.transferGas),new i.BN(n.minTransferTokenValue));d.actions.push(y);let[k,Y]=await(0,o.signTransaction)(d,l);return Promise.resolve(i.base.toBase64(Y.encode()))}else if(r===N.DAppTx){let n=e.data;if(n.actions==null||n.actions==null||n.actions.length==0)return Promise.reject(f.SignTxError);let d=n.actions.map(k=>(0,o.functionCall)(k.methodName,k.args,new i.BN(k.gas),new i.BN(k.deposit))),[g,y]=await(0,o.signTransaction)(n.receiverId,n.nonce,d,i.base.fromBase58(n.blockHash),l,n.from==null||null||n.from==""?a:n.from);return Promise.resolve(i.base.toBase64(y.encode()))}else if(r===N.DAppTxs){let n=e.data;if(n.transactions==null||n.transactions==null||n.transactions.length==0)return Promise.reject(f.SignTxError);let d=[];for(let g=0;g<n.transactions.length;g++){let y=n.transactions[g],k=y.actions.map(P=>(0,o.functionCall)(P.methodName,P.args,new i.BN(P.gas),new i.BN(P.deposit))),[Y,L]=await(0,o.signTransaction)(y.receiverId,new i.BN(n.nonce).add(new i.BN(g)).toNumber(),k,i.base.fromBase58(n.blockHash),l,n.from==null||null||n.from==""?a:n.from);d.push(i.base.toBase64(L.encode()))}return Promise.resolve(d)}else return Promise.reject(f.SignTxError)}catch{return Promise.reject(f.SignTxError)}}async validAddress(e){let r=!1;try{r=(0,o.validateAddress)(e.address)}catch{}let a={isValid:r,address:e.address};return Promise.resolve(a)}async calcTxHash(e){try{let r=o.SignedTransaction.decode(m.Buffer.from(i.base.fromBase64(e.data))),a=i.base.toBase58(i.base.sha256(r.transaction.encode()));return Promise.resolve(a)}catch{throw f.CalcTxHashError}}};M.NearWallet=de});var ve=B(u=>{p();h();var Ie=u&&u.__createBinding||(Object.create?function(t,e,r,a){a===void 0&&(a=r);var c=Object.getOwnPropertyDescriptor(e,r);(!c||("get"in c?!e.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,a,c)}:function(t,e,r,a){a===void 0&&(a=r),t[a]=e[r]}),Ke=u&&u.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Ie(e,t,r)};Object.defineProperty(u,"__esModule",{value:!0});u.publicKeyFromBase58=u.publicKeyFromSeed=u.checkName=u.validateAddress=u.getPubkey=u.checkPrivateKey=u.getAddress=void 0;var me=oe(),K=Z(),We=fe();Ke(pe(),u);Ke(he(),u);function Re(t){if(!ue(t))throw new Error("invalid key");let r=t;(t.startsWith("0x")||t.startsWith("0X"))&&(r=t.substring(2));let a=K.signUtil.ed25519.publicKeyCreate(K.base.fromHex(r));return K.base.toHex(a)}u.getAddress=Re;function ue(t){if(!t)throw new Error("invalid key");let e="";if(t.startsWith("0x")||t.startsWith("0X")){if(e=t.substring(2),!K.base.isHexString("0x"+e))throw new Error("invalid key");if(t.length!=130&&t.length!=66)throw new Error("invalid key")}else{if(!K.base.isHexString("0x"+t))throw new Error("invalid key");if(t.length!=128&&t.length!=64)throw new Error("invalid key");e=t}let r=K.base.fromHex(e);if(r.length!=64&&r.length!=32)throw new Error("invalid key");return!0}u.checkPrivateKey=ue;function $e(t){ue(t);let e=K.signUtil.ed25519.publicKeyCreate(K.base.fromHex(t));return"ed25519:"+K.base.toBase58(e)}u.getPubkey=$e;function Ve(t){return t.length>=2&&t.length<=64&&we(t)}u.validateAddress=Ve;function we(t){return new RegExp("^(([a-z\\d]+[\\-_])*[a-z\\d]+\\.)*([a-z\\d]+[\\-_])*[a-z\\d]+$").test(t)}u.checkName=we;function Ge(t){let e=K.signUtil.ed25519.publicKeyCreate(K.base.fromHex(t));return me.PublicKey.fromRaw(e)}u.publicKeyFromSeed=Ge;function Je(t){let e=t.split(":");if(e.length!=2||e[0]!="ed25519")throw We.SignTxError;return me.PublicKey.fromRaw(K.base.fromBase58(e[1]))}u.publicKeyFromBase58=Je});export{ve as a};

window.inOKXExtension = true;
window.ASSETS_BUILD_TYPE = "prepub";

//# sourceMappingURL=chunk-HRB2XUO3.js.map
